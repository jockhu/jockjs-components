(function(){var l=l||{version:"20080809",emptyFn:function(){}};(function(){l._log=[];var i=0;var aU={};l.BaseClass=function(aV){aU[(this.hashCode=(aV||l.BaseClass.guid()))]=this};l.BaseClass.guid=function(){return"mz_"+(i++).toString(36)};l.BaseClass.create=function(){var aV=new l.BaseClass();aV.decontrol();return aV};var e=l.instance=l.I=function(aV){return aU[aV]};l.BaseClass.prototype.dispose=function(){if(this.hashCode){delete aU[this.hashCode]}for(var aV in this){if(typeof this[aV]!="function"){delete this[aV]}}};l.BaseClass.prototype.getHashCode=function(){if(!this.hashCode){aU[(this.hashCode=l.BaseClass.guid())]=this}return this.hashCode};l.BaseClass.prototype.decontrol=function(){delete aU[this.hashCode]};l.BaseClass.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"};l.BaseClass.prototype._wlog=function(aW,aX){var aV=l._log;if(aV.length>100){aV.reverse().length=50;aV.reverse()}aV[aV.length]="["+aW+"]["+(this._className||"Object")+" "+this.hashCode+"] "+aX}})();Function.prototype.inherits=function(aV,aU){var e,aW,aY=this.prototype,aX=function(){};aX.prototype=aV.prototype;aW=this.prototype=new aX();if(typeof(aU)=="string"){aW._className=aU}for(e in aY){aW[e]=aY[e]}this.prototype.constructor=aY.constructor;aY=aX=null;return aW};l.BaseEvent=function(e,i){this.type=e;this.returnValue=true;this.target=i||null;this.currentTarget=this.srcElement=null;this.cancelBubble=false;this.domEvent=null};l.BaseClass.prototype.addEventListener=function(aV,aU,i){if(typeof aU!="function"){return this._wlog("error","addEventListener:"+aU+" is not a function")}if(!this._listeners){this._listeners={}}var e=this._listeners,aW;if(typeof i=="string"&&i){if(/[^\w\-]/.test(i)){this._wlog("warning","nonstandard key:"+i)}else{aU.hashCode=i;aW=i}}if(aV.indexOf("on")!=0){aV="on"+aV}if(typeof e[aV]!="object"){e[aV]={}}aW=aW||l.BaseClass.guid();aU.hashCode=aW;if(e[aV][aW]){this._wlog("warning","repeat key:"+aW)}e[aV][aW]=aU};l.BaseClass.prototype.removeEventListener=function(aU,i){if(typeof i=="function"){i=i.hashCode}else{if(typeof i!="string"){return}}if(!this._listeners){this._listeners={}}if(aU.indexOf("on")!=0){aU="on"+aU}var e=this._listeners;if(!e[aU]){return}if(e[aU][i]){delete e[aU][i]}};l.BaseClass.prototype.dispatchEvent=function(aV){if(!this._listeners){this._listeners={}}var aU,e=this._listeners,aW=aV.type;aV.target=aV.srcElement=aV.target||aV.srcElement||this;aV.currentTarget=this;if(typeof this[aW]=="function"){this[aW](aV)}if(typeof e[aW]=="object"){for(aU in e[aW]){if(typeof e[aW][aU]=="function"){e[aW][aU].call(this,aV)}}}return aV.returnValue};l.BaseEvent.prototype.inherit=function(aW){var aV=this;this.domEvent=aW=window.event||aW;aV.clientX=aW.clientX||aW.pageX;aV.clientY=aW.clientY||aW.pageY;aV.offsetX=aW.offsetX||aW.layerX;aV.offsetY=aW.offsetY||aW.layerY;aV.screenX=aW.screenX;aV.screenY=aW.screenY;aV.ctrlKey=aW.ctrlKey||aW.metaKey;aV.shiftKey=aW.shiftKey;aV.altKey=aW.altKey;if(aW.touches){aV.touches=[];for(var aU=0;aU<aW.touches.length;aU++){aV.touches.push({clientX:aW.touches[aU].clientX,clientY:aW.touches[aU].clientY,screenX:aW.touches[aU].screenX,screenY:aW.touches[aU].screenY,pageX:aW.touches[aU].pageX,pageY:aW.touches[aU].pageY,target:aW.touches[aU].target,identifier:aW.touches[aU].identifier})}}if(aW.changedTouches){aV.changedTouches=[];for(var aU=0;aU<aW.changedTouches.length;aU++){aV.changedTouches.push({clientX:aW.changedTouches[aU].clientX,clientY:aW.changedTouches[aU].clientY,screenX:aW.changedTouches[aU].screenX,screenY:aW.changedTouches[aU].screenY,pageX:aW.changedTouches[aU].pageX,pageY:aW.changedTouches[aU].pageY,target:aW.changedTouches[aU].target,identifier:aW.changedTouches[aU].identifier})}}if(aW.targetTouches){aV.targetTouches=[];for(var aU=0;aU<aW.targetTouches.length;aU++){aV.targetTouches.push({clientX:aW.targetTouches[aU].clientX,clientY:aW.targetTouches[aU].clientY,screenX:aW.targetTouches[aU].screenX,screenY:aW.targetTouches[aU].screenY,pageX:aW.targetTouches[aU].pageX,pageY:aW.targetTouches[aU].pageY,target:aW.targetTouches[aU].target,identifier:aW.targetTouches[aU].identifier})}}aV.rotation=aW.rotation;aV.scale=aW.scale;return aV};l.Browser=(function(){var aU=navigator.userAgent;var e=0,aW=0,i=0,aZ=0,aX=0;var a0=0,aV=0,aY=0;if(typeof(window.opera)=="object"&&/Opera(\s|\/)(\d+(\.\d+)?)/.test(aU)){aW=parseFloat(RegExp.$2)}else{if(/MSIE (\d+(\.\d+)?)/.test(aU)){e=parseFloat(RegExp.$1)}else{if(/Firefox(\s|\/)(\d+(\.\d+)?)/.test(aU)){aZ=parseFloat(RegExp.$2)}else{if(navigator.vendor=="Netscape"&&/Netscape(\s|\/)(\d+(\.\d+)?)/.test(aU)){aY=parseFloat(RegExp.$2)}else{if(aU.indexOf("Safari")>-1&&/Version\/(\d+(\.\d+)?)/.test(aU)){i=parseFloat(RegExp.$1)}}}}}if(aU.indexOf("Gecko")>-1&&aU.indexOf("KHTML")==-1&&/rv\:(\d+(\.\d+)?)/.test(aU)){aV=parseFloat(RegExp.$1)}if(/chrome\/(\d+\.\d)/i.test(aU)){aX=parseFloat(RegExp["\x241"])}return{ie:e,firefox:aZ,gecko:aV,netscape:aY,opera:aW,safari:i,chrome:aX}})();window.FeBrowser=l.Browser;l.Dom={};l.Dom.createDom=function(i,e){if(l.isIE&&e&&e.name){i="<"+i+' name="'+l.String.escapeHTML(e.name)+'">'}var aU=document.createElement(i);if(e){l.Dom.setProperties(aU,e)}return aU};l.Dom.getOffset=function(aV){var aY=l.Dom.getOwnerDocument(aV);var aX=l.isGecko>0&&aY.getBoxObjectFor&&l.Dom.getStyle(aV,"position")=="absolute"&&(aV.style.top===""||aV.style.left==="");var aZ={left:0,top:0};var i=(l.isIE&&!l.isStrict)?aY.body:aY.documentElement;if(aV==i){return aZ}var aU=null;var aW;if(aV.getBoundingClientRect){aW=aV.getBoundingClientRect();aZ.left=aW.left+Math.max(aY.documentElement.scrollLeft,aY.body.scrollLeft);aZ.top=aW.top+Math.max(aY.documentElement.scrollTop,aY.body.scrollTop);aZ.left-=aY.documentElement.clientLeft;aZ.top-=aY.documentElement.clientTop;if(l.isIE&&!l.isStrict){aZ.left-=2;aZ.top-=2}}else{if(aY.getBoxObjectFor&&!aX){aW=aY.getBoxObjectFor(aV);var e=aY.getBoxObjectFor(i);aZ.left=aW.screenX-e.screenX;aZ.top=aW.screenY-e.screenY}else{aU=aV;do{aZ.left+=aU.offsetLeft;aZ.top+=aU.offsetTop;if(l.isWebkit>0&&l.Dom.getStyle(aU,"position")=="fixed"){aZ.left+=aY.body.scrollLeft;aZ.top+=aY.body.scrollTop;break}aU=aU.offsetParent}while(aU&&aU!=aV);if(l.isOpera>0||(l.isWebkit>0&&l.Dom.getStyle(aV,"position")=="absolute")){aZ.top-=aY.body.offsetTop}aU=aV.offsetParent;while(aU&&aU!=aY.body){aZ.left-=aU.scrollLeft;if(!l.isOpera||aU.tagName!="TR"){aZ.top-=aU.scrollTop}aU=aU.offsetParent}}}return aZ};l.Dom.getOwnerDocument=function(e){return e.nodeType==9?e:e.ownerDocument||e.document};l.Dom.setProperties=function(i,e){l.each(e,function(aV,aU){l.Dom._setProperty(i,aU,aV)})};l.Dom._setProperty=function(i,e,aU){if(e=="style"){i.style.cssText=aU}else{if(e=="class"){i.className=aU}else{if(e=="for"){i.htmlFor=aU}else{if(e in l.Dom._DIRECT_ATTRIBUTE_MAP){i.setAttribute(l.Dom._DIRECT_ATTRIBUTE_MAP[e],aU)}else{i[e]=aU}}}}};l.Dom._DIRECT_ATTRIBUTE_MAP={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",height:"height",width:"width",usemap:"useMap",frameborder:"frameBorder"};l.G=function(){for(var aU=[],aV=arguments.length-1;aV>-1;aV--){var aW=arguments[aV];aU[aV]=null;if(typeof aW=="object"&&aW&&aW.dom){aU[aV]=aW.dom}else{if((typeof aW=="object"&&aW&&aW.tagName)||aW==window||aW==document){aU[aV]=aW}else{if(typeof aW=="string"&&(aW=document.getElementById(aW))){aU[aV]=aW}}}}return aU.length<2?aU[0]:aU};l.ac=function(e,i){if(!(e=this.G(e))){return}i=this.trim(i);if(!new RegExp("(^| )"+i.replace(/(\W)/g,"\\$1")+"( |$)").test(e.className)){e.className=e.className.split(/\s+/).concat(i).join(" ")}};l.addClassName=l.ac;l.each=function(aX,e){if(typeof e!="function"){return aX}if(aX){if(aX.length===undefined){for(var aU in aX){e.call(aX[aU],aX[aU],aU)}}else{for(var aV=0,aW=aX.length;aV<aW;aV++){e.call(aX[aV],aX[aV],aV)}}}return aX};l.extend=function(aX,aV){if(aX&&aV&&typeof(aV)=="object"){for(var aW in aV){aX[aW]=aV[aW]}var aU=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];for(var e=0,i;e<aU.length;e++){i=aU[e];if(Object.prototype.hasOwnProperty.call(aV,i)){aX[i]=aV[i]}}}return aX};l.hide=function(){l.each(arguments,function(e){if(e=l.G(e)){e.style.display="none"}})};l.inherit=function(aZ,aV,aU){var aY=aZ.prototype;var aX=function(){};aX.prototype=aV.prototype;var aW=aZ.prototype=new aX();if(typeof aU=="string"){aW._className=aU}for(var e in aY){aW[e]=aY[e]}aZ.prototype.constructor=aY.constructor;aY=null;return aW};l.isIE=0;(function(){if(navigator.userAgent.indexOf("MSIE")>0&&!window.opera){/MSIE (\d+(\.\d+)?)/.test(navigator.userAgent);l.isIE=parseFloat(RegExp.$1)}})();l.rc=function(e,i){if(!(e=this.G(e))){return}i=this.trim(i);var aU=e.className.replace(new RegExp("(^| +)"+i.replace(/(\W)/g,"\\$1")+"( +|$)","g"),"$2");if(e.className!=aU){e.className=aU}};l.removeClassName=l.rc;l.show=function(){this.each(arguments,function(e){if(e=l.G(e)){e.style.display=""}})};l.trim=function(e){return e.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")};var E=l.BaseClass;E.prototype.toString=function(){return this._className||""};var aw=l.BaseEvent;l.on=function(aU,i,e){if(!(aU=l.G(aU))){return aU}i=i.replace(/^on/,"").toLowerCase();if(aU.addEventListener){aU.addEventListener(i,e,false)}else{if(aU.attachEvent){aU.attachEvent("on"+i,e)}}return aU};l.un=function(aU,i,e){if(!(aU=l.G(aU))){return aU}i=i.replace(/^on/,"").toLowerCase();if(aU.removeEventListener){aU.removeEventListener(i,e,false)}else{if(aU.detachEvent){aU.detachEvent("on"+i,e)}}return aU};l.hc=function(aV,aU){if(!aV||!aV.className||typeof aV.className!="string"){return false}var i=-1;try{i=aV.className==aU||aV.className.search(new RegExp("(\\s|^)"+aU+"(\\s|$)"))}catch(aW){return false}return i>-1};if(typeof HTMLElement!="undefined"&&HTMLElement.prototype.__lookupGetter__&&!HTMLElement.prototype.__lookupGetter__("children")&&!window.opera){try{HTMLElement.prototype.__defineGetter__("children",function(){for(var aU=[],aV=0,aX,aW=0,e=this.childNodes.length;aW<e;aW++){aX=this.childNodes[aW];if(aX.nodeType==1){aU[aV++]=aX;if(aX.name){if(!aU[aX.name]){aU[aX.name]=[]}aU[aX.name][aU[aX.name].length]=aX}if(aX.id){aU[aX.id]=aX}}}return aU})}catch(Q){}}if(typeof(HTMLElement)!="undefined"&&!window.opera&&HTMLElement.prototype&&!HTMLElement.prototype.insertAdjacentHTML){HTMLElement.prototype.insertAdjacentHTML=function(i,aU){var aV=this.ownerDocument.createRange();aV.setStartBefore(this);aV=aV.createContextualFragment(aU);switch(i){case"beforeBegin":this.parentNode.insertBefore(aV,this);break;case"afterBegin":this.insertBefore(aV,this.firstChild);break;case"beforeEnd":this.appendChild(aV);break;case"afterEnd":if(!this.nextSibling){this.parentNode.appendChild(aV)}else{this.parentNode.insertBefore(aV,this.nextSibling)}break}}}if(typeof HTMLElement!="undefined"&&!window.opera){HTMLElement.prototype.contains=function(e){if(e==this){return true}while(e=e.parentNode){if(e==this){return true}}return false}}if(!l.Browser.ie&&typeof Event!="undefined"&&!window.opera){Event.prototype.__defineSetter__("returnValue",function(e){if(!e){this.preventDefault()}return e});Event.prototype.__defineSetter__("cancelBubble",function(e){if(e){this.stopPropagation()}return e})}l.each=function(aW,aV){if(av(aV)){for(var aU=0,e=aW.length;aU<e;aU++){if(aV.call(aW,aW[aU],aU)===false){break}}}return aW};l.Platform={x11:0,macintosh:0,windows:0,android:0,iphone:0,ipad:0};for(var N in l.Platform){if(l.Platform.hasOwnProperty(N)){l.Platform[N]=new RegExp(N,"i").test(window.navigator.userAgent)?1:0}}function aG(aW){var e={duration:1000,fps:30,delay:0,transition:k.linear};if(aW){for(var aU in aW){e[aU]=aW[aU]}}this._opts=e;if(e.delay){var aV=this;setTimeout(function(){aV._beginTime=new Date().getTime();aV._endTime=aV._beginTime+aV._opts.duration;aV._launch()},e.delay)}else{this._beginTime=new Date().getTime();this._endTime=this._beginTime+this._opts.duration;this._launch()}}aG.prototype._launch=function(){var i=this;var e=new Date().getTime();if(e>=i._endTime){if(typeof i._opts.render=="function"){i._opts.render(i._opts.transition(1))}if(typeof i._opts.finish=="function"){i._opts.finish()}return}i.schedule=i._opts.transition((e-i._beginTime)/i._opts.duration);if(typeof i._opts.render=="function"){i._opts.render(i.schedule)}if(!i.terminative){i._timer=setTimeout(function(){i._launch()},1000/i._opts.fps)}};aG.prototype.stop=function(e){this.terminative=true;if(this._timer){clearTimeout(this._timer)}if(e){this._endTime=this._beginTime;this._launch()}};aG.prototype.cancel=function(){if(this._timer){clearTimeout(this._timer)}this._endTime=this._beginTime;this.schedule=0};var k={linear:function(e){return e},reverse:function(e){return 1-e},easeInQuad:function(e){return e*e},easeInCubic:function(e){return Math.pow(e,3)},easeOutQuad:function(e){return -(e*(e-2))},easeOutCubic:function(e){return Math.pow((e-1),3)+1},easeInOutQuad:function(e){if(e<0.5){return e*e*2}else{return -2*(e-2)*e-1}return},easeInOutCubic:function(e){if(e<0.5){return Math.pow(e,3)*4}else{return Math.pow(e-1,3)*4+1}},easeInOutSine:function(e){return(1-Math.cos(Math.PI*e))/2}};function al(e){return e.style}function aR(aU,e){var i=al(aU);i.left=j(e[0]);i.top=j(e[1])}function B(aU,i){var e=al(aU);e.opacity=i;e.MozOpacity=i;e.KhtmlOpacity=i;e.filter="alpha(opacity="+(i*100)+")";e=null}function j(aU){if(typeof aU=="number"){return aU+"px"}else{if(typeof aU=="string"){var i=/"\\s","g"/;var aV=/"^\\d+(px|%)+$","i"/;var e=aU.replace(i,"");if(aV.exec(e)){return e}var aW=new RegExp("^\\d+$");if(aW.exec(e)){return e+"px"}return"0px"}}}function p(e){if(l.Browser.ie>0){e.unselectable="on";e.selectstart=function(){return false}}else{al(e).MozUserSelect="none"}}function aP(aU,e){var i=al(aU);i.width=j(e[0]);i.height=j(e[1])}function s(e){return e&&e.parentNode&&e.parentNode.nodeType!=11}function Z(i,e){i.insertAdjacentHTML("beforeEnd",e);return i.lastChild}function A(e){var i={left:0,top:0};while(e&&e.offsetParent){i.left+=e.offsetLeft;i.top+=e.offsetTop;e=e.offsetParent}return i}function ag(i){var i=window.event||i;i.stopPropagation?i.stopPropagation():i.cancelBubble=true}function D(i){var i=window.event||i;i.preventDefault?i.preventDefault():i.returnValue=false;return false}function aC(i){ag(i);return D(i)}function M(){var e=document.documentElement,i=document.body;if(e&&(e.scrollTop||e.scrollLeft)){return[e.scrollTop,e.scrollLeft]}else{if(i){return[i.scrollTop,i.scrollLeft]}else{return[0,0]}}}function o(aW){if(!aW){return}var aU=aW.attributes,aV,e,aX;if(aU){e=aU.length;for(aV=0;aV<e;aV+=1){aX=aU[aV].name;if(typeof aW[aX]==="function"){aW[aX]=null}}}aU=aW.children;if(aU){e=aU.length;for(aV=0;aV<e;aV+=1){o(aW.children[aV])}}}function aO(i,aY,aX){var aW=aY.lng-aX.lng;var aV=aY.lat-aX.lat;if(aW==0){return Math.abs(i.lng-aY.lng)}if(aV==0){return Math.abs(i.lat-aY.lat)}var aU=aV/aW;var e=aY.lat-aU*aY.lng;return Math.abs(aU*i.lng-i.lat+e)/Math.sqrt(aU*aU+1)}function v(i,e){if(!i||!e){return}return Math.round(Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2)))}function aB(e,aU){var i=[];aU=aU||function(aW){return aW};for(var aV in e){i.push(aV+"="+aU(e[aV]))}return i.join("&")}function t(aU,i,aX){var aY=document.createElement(aU);if(aX){aY=document.createElementNS(aX,aU)}i=i||{};for(var aV in i){var aW={"for":"htmlFor","class":"cssClass"}[aV]||aV;if(aV=="style"){aY.style.cssText=i[aV];continue}if(aV=="class"){l.ac(aY,i[aV]);continue}if(aY.setAttribute){aY.setAttribute(aW,i[aV])}else{try{aY[aW]=i[aV]}catch(aY){}}}return aY}function an(e){if(e.currentStyle){return e.currentStyle}else{if(e.ownerDocument&&e.ownerDocument.defaultView){return e.ownerDocument.defaultView.getComputedStyle(e,null)}}}function av(e){return typeof e=="function"}var aT="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function aa(aW){var aU="";var a3,a1,aZ="";var a2,a0,aY,aX="";var aV=0;var e=/[^A-Za-z0-9\+\/\=]/g;if(!aW||e.exec(aW)){return aW}aW=aW.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{a2=aT.indexOf(aW.charAt(aV++));a0=aT.indexOf(aW.charAt(aV++));aY=aT.indexOf(aW.charAt(aV++));aX=aT.indexOf(aW.charAt(aV++));a3=(a2<<2)|(a0>>4);a1=((a0&15)<<4)|(aY>>2);aZ=((aY&3)<<6)|aX;aU=aU+String.fromCharCode(a3);if(aY!=64){aU=aU+String.fromCharCode(a1)}if(aX!=64){aU=aU+String.fromCharCode(aZ)}a3=a1=aZ="";a2=a0=aY=aX=""}while(aV<aW.length);return aU}var aQ={imgPath:"http://api.map.baidu.com/images/",cityNames:{"\u5317\u4eac":"bj","\u4e0a\u6d77":"sh","\u6df1\u5733":"sz","\u5e7f\u5dde":"gz"}};if(l.Browser.firefox){l.extend(aQ,{distCursor:"url("+aQ.imgPath+"ruler.cur),crosshair",defaultCursor:"-moz-grab",draggingCursor:"-moz-grabbing"})}else{if(l.Browser.chrome||l.Browser.safari){l.extend(aQ,{distCursor:"url("+aQ.imgPath+"ruler.cur) 2 6,crosshair",defaultCursor:"url("+aQ.imgPath+"openhand.cur) 8 8,default",draggingCursor:"url("+aQ.imgPath+"closedhand.cur) 8 8,move"})}else{l.extend(aQ,{distCursor:"url("+aQ.imgPath+"ruler.cur),crosshair",defaultCursor:"url("+aQ.imgPath+"openhand.cur),default",draggingCursor:"url("+aQ.imgPath+"closedhand.cur),move"})}}var aS=aS||{version:"1.1",_register:new Array(),register:function(e){this._register[this._register.length]=e}};function C(aV,aX){aV=l.G(aV);if(!aV){return}E.call(this);this.container=aV;this._setStyle(aV);aV.unselectable="on";aV.innerHTML="";aV.appendChild(this.render());this.width=0;this.height=0;this.offsetX=0;this.offsetY=0;this.platform=aV.children[0];this.maskLayer=this.platform.children[0];this._panes={};this._viewTiles={};this._bind();this.centerPoint=null;this.zoomLevel=0;this.lastLevel=0;this.defaultZoomLevel=null;this.defaultCenter=null;this.currentCity="";this.cityCode="";this.currentOperation=0;this.config={clickInterval:200,enableDragging:true,enableKeyboard:false,enableClickPan:false,enableDblclickZoom:true,enableContinuousZoom:false,enableWheelZoom:false,enableMouseDown:true,fps:25,zoomerDuration:240,actionDuration:450,defaultCursor:aQ.defaultCursor,draggingCursor:aQ.draggingCursor,isOverviewMap:false,zoomLevelMin:1,zoomLevelMax:18,coordType:BMAP_COORD_LNGLAT,mapType:BMAP_NORMAL_MAP,restrictBounds:false,drawer:BMAP_SYS_DRAWER,enableInertialDragging:false,drawMargin:500,enableFulltimeSpotClick:false};this.setConfig(aX);if(!aJ[this.config.mapType]){this.config.mapType=BMAP_NORMAL_MAP}if(this.config.mapType==BMAP_PERSPECTIVE_MAP){_addStat(5002)}aX=aX||{};this.config.zoomLevelMin=aX.zoomLevelMin||aJ[this.config.mapType].zoomLevelMin;this.config.zoomLevelMax=aX.zoomLevelMax||aJ[this.config.mapType].zoomLevelMax;this.mapType=this.config.mapType;this.temp={operating:false,arrow:0,lastDomMoveTime:0,lastLoadTileTime:0,lastMovingTime:0,canKeyboard:false,I:function(i){return l.I(i)},curSpots:[],curSpotsArray:[],spotsGuid:1,registerIndex:-1};window.InstanceCore=this.temp.I;this.platform.style.cursor=this.config.defaultCursor;if(l.Browser.ie){try{document.execCommand("BackgroundImageCache",false,true)}catch(aU){}}for(var e=0;e<aS._register.length;e++){aS._register[e](this)}this.temp.registerIndex=e;var aW=this;if(l.Platform.windows||l.Platform.macintosh||l.Platform.x11){aq.load("oppc",function(){aW._asyncRegister()})}if(l.Platform.iphone||l.Platform.ipad||l.Platform.android){aq.load("opmb",function(){aW._asyncRegister()})}aV=null}C.inherits(E,"Map");l.extend(C.prototype,{render:function(){var e=t("div",{id:"platform"});var aV=e.style;aV.overflow="visible";aV.position="absolute";aV.zIndex="0";aV.top=aV.left="0px";var i=t("div",{id:"mask","class":"BMap_mask"});var aU=i.style;aU.position="absolute";aU.top=aU.left="0px";aU.zIndex="9";aU.overflow="hidden";aU.WebkitUserSelect="none";e.appendChild(i);return e},_setStyle:function(i){var e=i.style;e.overflow="hidden";if(an(i).position!="absolute"){e.position="relative"}e.backgroundImage="url("+aQ.imgPath+"bg.png)";e.color="#000";e.textAlign="left"},_bind:function(){var e=this;e._watchSize=function(){var aU=e.getSize();if(e.width!=aU.width||e.height!=aU.height){var aY=(aU.width-e.width)/2;var a0=(aU.height-e.height)/2;var aV=e.getZoomUnits();var aX=e.centerPoint;if(aX){e.centerPoint=new f(aX.lng+aY*aV,aX.lat-a0*aV)}e.maskLayer.style.width=(e.width=aU.width)+"px";e.maskLayer.style.height=(e.height=aU.height)+"px";if(e.divhs){e.divhs.style.width=(e.width=aU.width)+"px";e.divhs.style.height=(e.height=aU.height)+"px"}var aW=new aw("onresize");aW.size=aU;e.dispatchEvent(aW);var i=parseInt(e.platform.style.left)||0;var aZ=parseInt(e.platform.style.top)||0;if(e.currentOperation!="undefined"&&e.currentOperation!=0&&(e.offsetX!=i||e.offsetY!=aZ)){e._setPlatformPosition(i,aZ)}}};e._watchSize();setInterval(e._watchSize,80)},_setPlatformPosition:function(a3,a1,aV,a4){if(isNaN(a3)||isNaN(a1)){return}if(this.offsetX==a3&&this.offsetY==a1){return}var aW=this.offsetX-a3;var aU=this.offsetY-a1;var aX=this.getZoomUnits();var a2=this.centerPoint.lng;var a0=this.centerPoint.lat;var aZ=new f(a2,a0);this.centerPoint=new f(aZ.lng+aW*aX,aZ.lat-aU*aX);if(aV){this.centerPoint=aV}if(this.config.restrictBounds){var i=aJ[this.mapType].bounds;if(this.centerPoint.lng-this.width/2*aX<=i.minX&&aW<0||this.centerPoint.lng+this.width/2*aX>i.maxX&&aW>=0){a3=this.offsetX}if(this.centerPoint.lat-this.height/2*aX<=i.minY&&aU>=0||this.centerPoint.lat+this.height/2*aX>i.maxY&&aU<0){a1=this.offsetY}this.centerPoint=new f(aZ.lng+(this.offsetX-a3)*aX,aZ.lat-(this.offsetY-a1)*aX);var aY=new aw("onreachbounds");this.dispatchEvent(aY)}a3=Math.round(a3);a1=Math.round(a1);this.offsetX=a3;this.offsetY=a1;this.platform.style.left=a3+"px";this.platform.style.top=a1+"px";this.maskLayer.style.left=-a3+"px";this.maskLayer.style.top=-a1+"px";if(this.divhs){this.divhs.style.left=-a3+"px";this.divhs.style.top=-a1+"px"}if(a4!=false){this.dispatchEvent(new aw("onmoving"))}},zoomTo:function(aY,i){if(typeof aY!="number"){return}var aX=aJ[this.mapType];if(!aX){return}aY=this._getProperZoom(aY).zoom;if(aY==this.zoomLevel){return}this.lastLevel=this.zoomLevel;if(i){this.temp._cPoint=i;this.temp._cPixel=this.pointToPixel(i)}else{if(this.getInfoWindow()){var aW=this.getInfoWindow().getPoint();this.temp._cPixel=this.pointToPixel(aW);this.temp._cPoint=aW}}if(i||this.temp.infoWin&&this.temp.infoWin.isOpen()){var aU=this.config.coordType==BMAP_COORD_LNGLAT?ar.convertLL2MC(this.temp._cPoint):this.temp._cPoint;var e=this.temp._cPixel;var aV=this.getZoomUnits(aY);this.centerPoint=new f(aU.lng+aV*(this.width/2-e.x),aU.lat-aV*(this.height/2-e.y))}this.dispatchEvent(new aw("onzoomstart"));this.dispatchEvent(new aw("onzoomstartcode"));this.zoomLevel=aY},zoomIn:function(e){this.zoomTo(this.zoomLevel+1,e)},zoomOut:function(e){this.zoomTo(this.zoomLevel-1,e)},panTo:function(i,aV,aW){if(!i||i.toString()!="Point"){return}var aU=this.pointToPixel(i);i=this.config.coordType==BMAP_COORD_LNGLAT?V.convertLL2MC(i):i;i=this.mapType==BMAP_PERSPECTIVE_MAP?V.convert2DTo3D(this.currentCity,i):i;var e=Math.round(this.width/2);var aX=Math.round(this.height/2);if(Math.abs(e-aU.x)>this.width||Math.abs(aX-aU.y)>this.height||aV==true){this._panTo(e-aU.x,aX-aU.y,i)}else{this._panBy(e-aU.x,aX-aU.y,{duration:aW})}},_panTo:function(i,e,aV){var aU=this.temp;if(aU.operating==true){return}if(aU.dragAni){aU.dragAni.stop();aU.dragAni=null;this.dispatchEvent(new aw("onmoveend"))}this.dispatchEvent(new aw("onmovestart"));this._setPlatformPosition(this.offsetX+i,this.offsetY+e,aV);this.dispatchEvent(new aw("onmoveend"))},panBy:function(i,e){i=Math.round(i)||0;e=Math.round(e)||0;if(Math.abs(i)<=this.width&&Math.abs(e)<=this.height&&!arguments[3]){this._panBy(i,e,{fps:arguments[2]})}else{this._panTo(i,e)}},_panBy:function(i,e,aW){if(this.temp.operating==true){return}aW=aW||{};this.dispatchEvent(new aw("onmovestart"));var aV=this,aU=aV.temp;aU.pl=aV.offsetX;aU.pt=aV.offsetY;if(aU.tlPan){aU.tlPan.cancel()}if(aU.dragAni){aU.dragAni.stop();aU.dragAni=null;this.dispatchEvent(new aw("onmoveend"))}aU.tlPan=new aG({fps:aW.fps||aV.config.fps,duration:aW.duration||aV.config.actionDuration,transition:aW.transition||k.easeInOutQuad,render:function(aX){this.terminative=aV.temp.operating;if(aV.temp.operating){return}aV._setPlatformPosition(aU.pl+Math.ceil(i*aX),aU.pt+Math.ceil(e*aX))},finish:function(aX){aV.dispatchEvent(new aw("onmoveend"));aV.temp.tlPan=false;if(aV.temp.stopArrow==true){aV.temp.stopArrow=false;if(aV.temp.arrow!=0){aV._arrow()}}}})},addControl:function(e){if(e&&av(e._i)){e._i(this);this.dispatchEvent(new aw("onaddcontrol",e))}},removeControl:function(e){if(e&&av(e.remove)){e.remove();this.dispatchEvent(new aw("onremovecontrol",e))}},addContextMenu:function(e){if(e&&e._type=="contextmenu"&&typeof e.initialize=="function"){e.initialize(this);this.dispatchEvent(new aw("onaddcontextmenu",e))}},removeContextMenu:function(e){if(e&&e._type=="contextmenu"&&typeof e.remove=="function"){this.dispatchEvent(new aw("onremovecontextmenu",e));e.remove()}},addOverlay:function(e){if(e&&av(e._i)){e._i(this);this.dispatchEvent(new aw("onaddoverlay",e))}},removeOverlay:function(e){if(e&&av(e.remove)){e.remove();this.dispatchEvent(new aw("onremoveoverlay",e))}},clearOverlays:function(){this.dispatchEvent(new aw("onclearoverlays"))},addTileLayer:function(e){for(var aV=0;aV<this.tileMgr.tileLayers.length;aV++){var aU=this.tileMgr.tileLayers[aV];if(aU==e||aU.getMapType()==e.getMapType()){return}else{if(e.baseLayer==true){aU.baseLayer=false;aU.zIndex=aV}}}if(e&&e._type=="tilelayer"&&av(e.initialize)){e.initialize(this);this.dispatchEvent(new aw("onaddtilelayer",e))}},removeTileLayer:function(e){if(e&&e._type=="tilelayer"&&av(e.remove)){e.remove();this.dispatchEvent(new aw("onremovetilelayer",e))}},getTileLayer:function(e){if(this.tileMgr){return this.tileMgr.getTileLayer(e)}return},setMapType:function(i){if(this.mapType==i){return}var e=this;if(e._changeMapType){e._changeMapType(i)}else{aq.load("3dmap",function(){e._asyncRegister();e._changeMapType(i)})}},getTileId:function(e,aX){var aV=aJ[this.mapType];if(typeof aV!="object"){return null}var i=aV.baseUnits*Math.pow(2,(aV.zoomLevelMax-aX));var aW=parseInt(e.lng/i);var aU=parseInt(e.lat/i);return{row:aW,column:aU,level:aX}},getViewTiles:function(){var i=this;var e=this._viewTiles[i.mapType];return e},setCenter:function(e){this.panTo(e,true)},centerAndZoom:function(i,aY,aU){if(!i||!aY){return}aY=this._getProperZoom(aY).zoom;this.lastLevel=this.zoomLevel||aY;this.zoomLevel=aY;var aW=new aw("onload");aW.point=i;aW.zoom=aY;function aX(a5,a4,a0){a5.centerPoint=new f(a0.lng,a0.lat);a5.defaultZoomLevel=a5.defaultZoomLevel||a5.zoomLevel;a5.defaultCenter=a5.defaultCenter||a5.centerPoint;var aZ=a5.tileMgr&&a5.tileMgr.tileLayers.length;if(!a5.loaded&&!aZ){var a3=new y(-21364736,-10616832,23855104,15859712);var a2=new af("baidu",a3,"\u767e\u5ea6\u5730\u56fe");var a1=new F({mapType:a5.mapType,copyright:a2});a1.baseLayer=true;a5.addTileLayer(a1)}a4.pixel=a5.pointToPixel(a5.centerPoint,a5.zoomLevel,true);a5.dispatchEvent(a4)}if(!aU){if(this.config.coordType==BMAP_COORD_LNGLAT){i=this.config.coordType==BMAP_COORD_LNGLAT?V.convertLL2MC(i):i}var aV=this;this._setCorrectPts();if(this.mapType==BMAP_PERSPECTIVE_MAP&&!this._get3DHotspots){i=aV.mapType==BMAP_PERSPECTIVE_MAP?V.convert2DTo3D(aV.currentCity,i):i;aX(aV,aW,i);aV.config.zoomLevelMin=15;aV.config.zoomLevelMax=20;aq.load("3dmap",function(){aV.temp.overlayDiv.appendChild(aV.divhs);aV._clear3DHotspots();aV._asyncRegister();if(!aV.loaded){aV.addEventListener("zoomend",aV._get3DHotspots);aV.addEventListener("moveend",aV._get3DHotspots)}aV._get3DHotspots();return})}else{i=this.mapType==BMAP_PERSPECTIVE_MAP?V.convert2DTo3D(this.currentCity,i):i;if(this.mapType==BMAP_PERSPECTIVE_MAP){this._get3DHotspots()}}}if(this.mapType==BMAP_NORMAL_MAP||(this.mapType==BMAP_PERSPECTIVE_MAP&&this._get3DHotspots)){aX(this,aW,i)}},reset:function(){this.centerAndZoom(this.defaultCenter,this.defaultZoomLevel,true)},enableDragging:function(){this.config.enableDragging=true},disableDragging:function(){this.config.enableDragging=false},enableInertialDragging:function(){this.config.enableInertialDragging=true},disableInertialDragging:function(){this.config.enableInertialDragging=false},enableScrollWheelZoom:function(){this.config.enableWheelZoom=true},disableScrollWheelZoom:function(){this.config.enableWheelZoom=false},enableContinuousZoom:function(){this.config.enableContinuousZoom=true},disableContinuousZoom:function(){this.config.enableContinuousZoom=false},enableClickPan:function(e){this.config.enableClickPan=!!e},enableDoubleClickZoom:function(){this.config.enableDblclickZoom=true},disableDoubleClickZoom:function(){this.config.enableDblclickZoom=false},enableKeyboard:function(){this.config.enableKeyboard=true},disableKeyboard:function(){this.config.enableKeyboard=false},getSize:function(){var e=new X(this.container.clientWidth,this.container.clientHeight);return e},getCenter:function(){var e=this.centerPoint;if(this.config.coordType==BMAP_COORD_LNGLAT){if(this.mapType==BMAP_PERSPECTIVE_MAP){e=V.convert3DTo2D(this.currentCity,e)}e=ar.convertMC2LL(e)}else{if(this.mapType==BMAP_PERSPECTIVE_MAP){e=V.convert3DTo2D(this.currentCity,e)}}return e},getZoom:function(){return this.zoomLevel},_getProperZoom:function(aU){var i=this.config.zoomLevelMin,e=this.config.zoomLevelMax,aV=false;if(aU<i){aV=true;aU=i}if(aU>e){aV=true;aU=e}return{zoom:aU,exceeded:aV}},getContainer:function(){return this.container},getZoomUnits:function(aU){var e=aJ[this.mapType];if(typeof e!="object"){return null}var i=aU||this.zoomLevel;return Math.pow(2,(e.zoomLevelMax-i))*e.baseUnits/e.tileSize},pointToPixel:function(i,aX,aV){if(!i){return}if(!aV){i=this.config.coordType==BMAP_COORD_LNGLAT?V.convertLL2MC(i):i;i=this.mapType==BMAP_PERSPECTIVE_MAP?V.convert2DTo3D(this.currentCity,i):i}var aU=this.getZoomUnits(aX);var e=Math.round((i.lng-this.centerPoint.lng)/aU+this.width/2);var aW=Math.round((this.centerPoint.lat-i.lat)/aU+this.height/2);return new aK(e,aW)},pixelToPoint:function(aX,aZ,aU){if(!aX){return}var i=this.getZoomUnits(aZ);var aW=this.centerPoint.lng+i*(aX.x-this.width/2);var aY=this.centerPoint.lat-i*(aX.y-this.height/2);var e=new f(aW,aY);if(!aU){if(this.mapType==BMAP_PERSPECTIVE_MAP){if(this.config.coordType==BMAP_COORD_LNGLAT){var aV=V.convert3DTo2D(this.currentCity,e);e=V.convertMC2LL(aV)}else{e=this.mapType==BMAP_PERSPECTIVE_MAP?V.convert3DTo2D(this.currentCity,e):e}}else{if(this.config.coordType==BMAP_COORD_LNGLAT){e=this.config.coordType==BMAP_COORD_LNGLAT?V.convertMC2LL(e):e}}}return e},pointToOverlayPixel:function(e,aV,i){var aU=this.pointToPixel(e,aV,i);if(!aU){return}aU.x-=this.offsetX;aU.y-=this.offsetY;return aU},overlayPixelToPoint:function(e,aU){if(!e){return}var i=new aK(e.x,e.y);i.x+=this.offsetX;i.y+=this.offsetY;return this.pixelToPoint(i,aU)},lnglatToMercator:function(i,aV){var e=new f(i,aV);var aU=V.convertLL2MC(e);return[aU.lng,aU.lat]},mercatorToLnglat:function(aU,i){if(isNaN(aU)||isNaN(i)){return[]}aU=parseFloat(aU);i=parseFloat(i);var aV=new f(aU,i);var e=V.convertMC2LL(aV);return[e.lng,e.lat]},getBounds:function(){if(!this.isLoaded()){return new y()}var e=arguments[0]||{},aU=e.margins||[0,0,0,0],aW=e.level||null,aV=this.pixelToPoint({x:aU[3],y:this.height-aU[2]},aW,true),i=this.pixelToPoint({x:this.width-aU[1],y:aU[0]},aW,true);if(this.config.coordType==BMAP_COORD_LNGLAT){aV=V.convertMC2LL(aV);i=V.convertMC2LL(i)}if(this.mapType==BMAP_PERSPECTIVE_MAP){aV=V.convert3DTo2D(this.currentCity,aV);i=V.convert3DTo2D(this.currentCity,i)}return new y(aV.lng,aV.lat,i.lng,i.lat)},setConfig:function(e){if(!e){return}for(var i in e){if(typeof this.config[i]==typeof e[i]){this.config[i]=e[i]}}},isLoaded:function(){return !!this.loaded},_getBestLevel:function(i,aU){var aY=aJ[this.mapType];if(!aY){return this.getZoom()}var aZ=aU.margins||[10,10,10,10],aW=aU.zoomFactor||0,a0=aZ[1]+aZ[3],aX=aZ[0]+aZ[2],e=aY.zoomLevelMin,a2=aY.zoomLevelMax;for(var aV=a2;aV>=e;aV--){var a1=this.getZoomUnits(aV);if((i.maxX-i.minX)/a1<this.width-a0&&(i.maxY-i.minY)/a1<this.height-aX){break}}aV+=aW;if(aV<e){aV=e}if(aV>a2){aV=a2}return aV},getViewport:function(a4,aU){var a6={center:this.getCenter(),zoom:this.getZoom()};if(!a4||a4.length==0){return a6}aU=aU||{};var aY=[];var a2=[];if(this.config.coordType==BMAP_COORD_LNGLAT){for(var aZ=0,aX=a4.length;aZ<aX;aZ++){aY.push(ar.convertLL2MC(a4[aZ]))}}else{aY=a4}if(this.mapType!=BMAP_PERSPECTIVE_MAP){a2=aY}else{for(var aZ=0,aX=aY.length;aZ<aX;aZ++){a2.push(ar.convert2DTo3D(this.currentCity,aY[aZ]))}}var aV=new y();for(var aZ=a2.length-1;aZ>=0;aZ--){aV.extend(a2[aZ])}if(aV.isEmpty()){return a6}var e=aV.getCenter();var a5=this._getBestLevel(aV,aU);if(aU.margins){var a1=aU.margins,a0=(a1[1]-a1[3])/2,a3=(a1[0]-a1[2])/2,aW=this.getZoomUnits(a5);e.lng=e.lng+aW*a0;e.lat=e.lat+aW*a3}if(this.mapType==BMAP_PERSPECTIVE_MAP){e=ar.convert3DTo2D(this.currentCity,e)}if(this.config.coordType==BMAP_COORD_LNGLAT){e=ar.convertMC2LL(e)}return{center:e,zoom:a5}},setViewport:function(i,aW){var e;if(i&&i.center){e=i}else{e=this.getViewport(i,aW)}aW=aW||{};var aU=aW.delay||200;if(e.zoom==this.zoomLevel&&aW.enableAnimation!=false){var aV=this;setTimeout(function(){aV.panTo(e.center,false,210)},aU)}else{this.centerAndZoom(e.center,e.zoom)}},addSpots:function(i,aV){if(!i||i.length==0){return}aV=aV||{};var aX=aV.zIndex||0,aW=typeof aV.enableMultiResponse=="undefined"?true:!!aV.enableMultiResponse;this.spotsPool=this.spotsPool||{};var e="sp"+(this.temp.spotsGuid++);this.spotsPool[e]={spots:i.slice(0),zIndex:aX,enableMultiResponse:aW};var aU=this;aq.load("hotspot",function(){aU._asyncRegister()});return e},getSpots:function(e){return this.spotsPool[e]&&this.spotsPool[e].spots||[]},removeSpots:function(e){if(!e||!this.spotsPool[e]){return}delete this.spotsPool[e]},clearSpots:function(){delete this.spotsPool},setBounds:function(e){aJ[this.mapType].bounds=new y(e.minX,e.minY,e.maxX,e.maxY)},getCoordType:function(){return this.config.coordType},getPanes:function(){return this._panes},getInfoWindow:function(){if(this.temp.infoWin&&this.temp.infoWin.isOpen()){return this.temp.infoWin}return null},getDistance:function(aU,e){if(!aU||!e){return}var i=0;if(this.config.coordType==BMAP_COORD_LNGLAT){i=V.getDistanceByLL(aU,e)}else{i=V.getDistanceByMC(aU,e)}return i},getOverlays:function(){var aW=[],aX=this._overlays,aV=this._customOverlays;if(aX){for(var aU in aX){if(aX[aU] instanceof aF){aW.push(aX[aU])}}}if(aV){for(var aU=0,e=aV.length;aU<e;aU++){aW.push(aV[aU])}}return aW},getMapType:function(){return this.mapType},_asyncRegister:function(){for(var e=this.temp.registerIndex;e<aS._register.length;e++){aS._register[e](this)}this.temp.registerIndex=e},_setCorrectPts:function(){var i=aJ[BMAP_PERSPECTIVE_MAP].citys;for(var aV in i){var aU=i[aV][1];var e=i[aV][0];if(aV==this.currentCity){if(this.mapType==BMAP_PERSPECTIVE_MAP){this.setBounds(e)}break}}},setCurrentCity:function(aU){var e=this;if(this.mapType==BMAP_PERSPECTIVE_MAP){aq.load("3dmap",function(){e._asyncRegister();e.addEventListener("zoomend",e._get3DHotspots);e.addEventListener("moveend",e._get3DHotspots)})}if(this._clear3DHotspots){this._clear3DHotspots()}var i=aJ[BMAP_PERSPECTIVE_MAP].citys;this.currentCity=this._get3DCityCode(aU);this.cityCode=i[this.currentCity][2];this._setCorrectPts()},_get3DCityCode:function(e){if(!e){return"bj"}var i=aQ.cityNames;for(var aU in i){if(e.search(aU)>-1){return i[aU]}}return"bj"},setDefaultCursor:function(e){this.config.defaultCursor=e;if(this.platform){this.platform.style.cursor=this.config.defaultCursor}},getDefaultCursor:function(){return this.config.defaultCursor},setDraggingCursor:function(e){this.config.draggingCursor=e},getDraggingCursor:function(){return this.config.draggingCursor}});window.BMAP_NORMAL_MAP="B_NORMAL_MAP";window.BMAP_PERSPECTIVE_MAP="B_DIMENSIONAL_MAP";window.BMAP_COORD_LNGLAT=0;window.BMAP_COORD_MERCATOR=1;window.BMAP_SYS_DRAWER=0;window.BMAP_SVG_DRAWER=1;window.BMAP_VML_DRAWER=2;window.BMAP_CANVAS_DRAWER=3;window._addStat=function(aY,aX){if(!aY){return}aX=aX||{};var aW="";for(var aU in aX){aW=aW+"&"+aU+"="+encodeURIComponent(aX[aU])}var aZ=function(i){if(!i){return}_addStat._sending=true;setTimeout(function(){_addStat._img.src="http://api.map.baidu.com/images/blank.gif?"+i.src},50)};var e=function(){var i=_addStat._reqQueue.shift();if(i){aZ(i)}};var aV=(Math.random()*100000000).toFixed(0);if(_addStat._sending){_addStat._reqQueue.push({src:"t="+aV+"&code="+aY+aW})}else{aZ({src:"t="+aV+"&code="+aY+aW})}if(!_addStat._binded){l.on(_addStat._img,"load",function(){_addStat._sending=false;e()});l.on(_addStat._img,"error",function(){_addStat._sending=false;e()});_addStat._binded=true}};window._addStat._reqQueue=[];window._addStat._img=new Image();var az=5000;_addStat(az);var aJ={B_NORMAL_MAP:{tileUrls:["http://q1.baidu.com/it/","http://q2.baidu.com/it/","http://q3.baidu.com/it/","http://q4.baidu.com/it/","http://q5.baidu.com/it/","http://q6.baidu.com/it/","http://q7.baidu.com/it/","http://q8.baidu.com/it/"],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:18,errorUrl:aQ.imgPath+"bg.png",bounds:new y(-21364736,-10616832,23855104,15859712),imgExtend:"png"},B_DIMENSIONAL_MAP:{tileUrls:["http://d0.map.baidu.com/resource/mappic/","http://d1.map.baidu.com/resource/mappic/","http://d2.map.baidu.com/resource/mappic/","http://d3.map.baidu.com/resource/mappic/"],tileSize:256,baseUnits:256,zoomLevelMin:15,zoomLevelMax:20,errorUrl:aQ.imgPath+"bg.png",bounds:new y(-21364736,-10616832,23855104,15859712),imgExtend:"jpg",hotspotUrl:["http://d0.map.baidu.com/resource/js/map/","http://d1.map.baidu.com/resource/js/map/","http://d2.map.baidu.com/resource/js/map/","http://d3.map.baidu.com/resource/js/map/"],entityUrl:"http://d0.map.baidu.com/resource/js/entity/",citys:{bj:[new y(524288,9363456,727040,9474048),new y(12821123.68,4784960.94,12958550,4862821.56),2],gz:[new y(1048576,8857601,1157119,8949760),new y(12589292.4,2591556.62,12646784.64,2647562.86),1],sz:[new y(524288,9375745,668415,9474048),new y(12668344.21,2560434.57,12710864.02,2587497.06),14],sh:[new y(983040,8890369,1130495,8994816),new y(13507877.45,3640466.88,13537325.71,3658712.59),4]}},BMAP_CUSTOM_LAYER:{tileUrls:[""],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:18,errorUrl:aQ.imgPath+"blank.gif",bounds:new y(-21364736,-10616832,23855104,15859712),imgExtend:"png"}};function m(){}l.extend(m,{num:{bj:{num:Math.sin(Math.PI/4),num2:Math.sin(Math.PI/6)},gz:{num:Math.sin(Math.PI/4),num2:Math.sin(Math.PI/4)},sz:{num:Math.sin(Math.PI/4),num2:Math.sin(Math.PI/4)},sh:{num:Math.sin(Math.PI/4),num2:Math.sin(Math.PI/4)}},correct_pts:{bj:[{j:116.305687,w:39.990912,utm_x:12947230.73,utm_y:4836903.65,x:630412,y:547340},{j:116.381837,w:40.000198,utm_x:12955707.8,utm_y:4838247.62,x:667412,y:561832},{j:116.430651,w:39.995216,utm_x:12961141.81,utm_y:4837526.55,x:686556,y:573372},{j:116.474111,w:39.976323,utm_x:12965979.81,utm_y:4834792.55,x:697152,y:586816},{j:116.280328,w:39.953159,utm_x:12944407.75,utm_y:4831441.53,x:603272,y:549976},{j:116.316117,w:39.952496,utm_x:12948391.8,utm_y:4831345.64,x:618504,y:557872},{j:116.350477,w:39.938107,utm_x:12952216.78,utm_y:4829264.65,x:627044,y:568220},{j:116.432025,w:39.947158,utm_x:12961294.76,utm_y:4830573.59,x:666280,y:584016},{j:116.46873,w:39.949516,utm_x:12965380.79,utm_y:4830914.63,x:683328,y:591444},{j:116.280077,w:39.913823,utm_x:12944379.8,utm_y:4825753.62,x:586150,y:558552},{j:116.308625,w:39.91374,utm_x:12947557.79,utm_y:4825741.62,x:598648,y:564732},{j:116.369853,w:39.912979,utm_x:12954373.73,utm_y:4825631.62,x:624561,y:578039},{j:116.433552,w:39.914694,utm_x:12961464.75,utm_y:4825879.53,x:652972,y:591348},{j:116.457034,w:39.914273,utm_x:12964078.78,utm_y:4825818.67,x:663028,y:596444},{j:116.490927,w:39.914127,utm_x:12967851.77,utm_y:4825797.57,x:677968,y:604188},{j:116.483839,w:39.877198,utm_x:12967062.73,utm_y:4820460.67,x:658596,y:610312},{j:116.405777,w:39.864461,utm_x:12958372.82,utm_y:4818620.62,x:619256,y:596088},{j:116.35345,w:39.859774,utm_x:12952547.74,utm_y:4817943.6,x:594633,y:585851},{j:116.403818,w:39.9141,utm_x:12958154.74,utm_y:4825793.66,x:639699,y:585226},{j:116.318111,w:39.891101,utm_x:12948613.78,utm_y:4822469.56,x:592856,y:571480},{j:116.413047,w:39.907238,utm_x:12959182.12,utm_y:4824801.76,x:640680,y:588704},{j:116.390843,w:39.906113,utm_x:12956710.35,utm_y:4824639.16,x:630620,y:584108},{j:116.446527,w:39.899438,utm_x:12962909.14,utm_y:4823674.4,x:651752,y:597416},{j:116.388665,w:39.95527,utm_x:12956467.9,utm_y:4831746.87,x:650656,y:572800},{j:116.398343,w:39.939704,utm_x:12957545.26,utm_y:4829495.6,x:648036,y:578452},{j:116.355101,w:39.973581,utm_x:12952731.53,utm_y:4834395.82,x:643268,y:560944},{j:116.380727,w:39.88464,utm_x:12955584.23,utm_y:4821535.94,x:616920,y:586496},{j:116.360843,w:39.946452,utm_x:12953370.73,utm_y:4830471.48,x:635293,y:568765},{j:116.340955,w:39.973421,utm_x:12951156.79,utm_y:4834372.67,x:638420,y:558632},{j:116.322585,w:40.023941,utm_x:12949111.83,utm_y:4841684.79,x:652135,y:543802},{j:116.356486,w:39.883341,utm_x:12952885.71,utm_y:4821348.24,x:606050,y:581443},{j:116.339592,w:39.992259,utm_x:12951005.06,utm_y:4837098.59,x:645664,y:554400},{j:116.3778,w:39.86392,utm_x:12955258.4,utm_y:4818542.48,x:606848,y:590328},{j:116.377354,w:39.964124,utm_x:12955208.75,utm_y:4833027.64,x:649911,y:568581},{j:116.361837,w:39.963897,utm_x:12953481.39,utm_y:4832994.8,x:643286,y:565175},{j:116.441397,w:39.939403,utm_x:12962338.06,utm_y:4829452.07,x:666772,y:587728},{j:116.359176,w:40.006631,utm_x:12953185.16,utm_y:4839178.78,x:660440,y:555411}],sz:[{j:113.88099,w:22.58884,utm_x:12677311.76,utm_y:2565810.52,x:569078,y:532290},{j:113.902002,w:22.566098,utm_x:12679650.83,utm_y:2563084.58,x:568318,y:545457},{j:113.869843,w:22.577711,utm_x:12676070.87,utm_y:2564476.5,x:561115,y:532494},{j:113.943387,w:22.555192,utm_x:12684257.84,utm_y:2561777.5,x:579437,y:558427},{j:113.899505,w:22.577052,utm_x:12679372.86,utm_y:2564397.51,x:571923,y:540181},{j:113.900376,w:22.596431,utm_x:12679469.82,utm_y:2566720.51,x:580142,y:535463},{j:113.92101,w:22.528931,utm_x:12681766.81,utm_y:2558630.58,x:560296,y:559780},{j:113.919672,w:22.517839,utm_x:12681617.86,utm_y:2557301.57,x:555296,y:562549},{j:113.938716,w:22.505569,utm_x:12683737.86,utm_y:2555831.55,x:557349,y:571072},{j:113.919203,w:22.483494,utm_x:12681565.66,utm_y:2553187.17,x:540853,y:572118},{j:113.942875,w:22.492046,utm_x:12684200.84,utm_y:2554211.57,x:553296,y:575994},{j:113.9567,w:22.530183,utm_x:12685739.85,utm_y:2558780.59,x:573378,y:568442},{j:113.989102,w:22.52697,utm_x:12689346.86,utm_y:2558395.61,x:584796,y:578728},{j:114.015467,w:22.533746,utm_x:12692281.83,utm_y:2559207.53,x:597126,y:584075},{j:113.972977,w:22.55702,utm_x:12687551.81,utm_y:2561996.58,x:591204,y:565924},{j:113.990368,w:22.561133,utm_x:12689487.79,utm_y:2562489.51,x:599240,y:569528},{j:114.143745,w:22.580535,utm_x:12706561.83,utm_y:2564815,x:663830,y:605622},{j:114.150374,w:22.557704,utm_x:12707299.77,utm_y:2562078.56,x:657016,y:613828},{j:114.106905,w:22.541858,utm_x:12702460.77,utm_y:2560179.58,x:634284,y:606528},{j:114.083927,w:22.535065,utm_x:12699902.85,utm_y:2559365.58,x:623132,y:602096},{j:114.049584,w:22.517997,utm_x:12696079.76,utm_y:2557320.5,x:603390,y:597564},{j:114.056304,w:22.542425,utm_x:12696827.84,utm_y:2560247.52,x:615980,y:592534},{j:114.051552,w:22.551321,utm_x:12696298.84,utm_y:2561313.59,x:617887,y:588719},{j:114.096377,w:22.559064,utm_x:12701288.79,utm_y:2562241.55,x:637568,y:598739},{j:114.135858,w:22.575851,utm_x:12705683.84,utm_y:2564253.55,x:659024,y:604806},{j:114.092029,w:22.575592,utm_x:12700804.77,utm_y:2564222.51,x:642776,y:592932},{j:114.054795,w:22.570617,utm_x:12696659.85,utm_y:2563626.21,x:626988,y:584142},{j:114.03075,w:22.553687,utm_x:12693983.15,utm_y:2561597.14,x:611068,y:582552},{j:114.074153,w:22.554124,utm_x:12698814.8,utm_y:2561649.51,x:627380,y:594008},{j:113.926721,w:22.546028,utm_x:12682402.56,utm_y:2560679.29,x:569340,y:556468},{j:113.938125,w:22.538296,utm_x:12683672.07,utm_y:2559752.74,x:570548,y:561748}],gz:[{j:113.335098,w:23.147289,utm_x:12616542.68,utm_y:2632892.7,x:1129109,y:1073920},{j:113.320932,w:23.146956,utm_x:12614965.71,utm_y:2632852.62,x:1125620,y:1071640},{j:113.321435,w:23.140119,utm_x:12615021.7,utm_y:2632029.65,x:1124032,y:1072882},{j:113.321471,w:23.119165,utm_x:12615025.71,utm_y:2629507.68,x:1118932,y:1076530},{j:113.340201,w:23.118616,utm_x:12617110.75,utm_y:2629441.61,x:1123238,y:1079667},{j:113.358068,w:23.116323,utm_x:12619099.71,utm_y:2629165.66,x:1126968,y:1083116},{j:113.357529,w:23.131271,utm_x:12619039.71,utm_y:2630964.68,x:1130508,y:1080440},{j:113.365811,w:23.150595,utm_x:12619961.67,utm_y:2633290.66,x:1137205,y:1078567},{j:113.294145,w:23.118467,utm_x:12611983.76,utm_y:2629423.68,x:1112245,y:1072043},{j:113.28615,w:23.121525,utm_x:12611093.75,utm_y:2629791.7,x:1110993,y:1070197},{j:113.307152,w:23.055497,utm_x:12613431.71,utm_y:2621847.21,x:1100144,y:1085123},{j:113.333445,w:23.052687,utm_x:12616358.66,utm_y:2621509.2,x:1105784,y:1089948},{j:113.347476,w:23.048755,utm_x:12617920.6,utm_y:2621036.24,x:1108099,y:1093064},{j:113.385774,w:23.036574,utm_x:12622183.96,utm_y:2619571.12,x:1113850,y:1101834},{j:113.364185,w:22.89798,utm_x:12619780.66,utm_y:2602910.64,x:1073186,y:1123374},{j:113.404577,w:22.906481,utm_x:12624277.13,utm_y:2603932.06,x:1084888,y:1128692},{j:113.430856,w:22.913156,utm_x:12627202.52,utm_y:2604734.12,x:1092892,y:1131761},{j:113.384554,w:22.933021,utm_x:12622048.15,utm_y:2607121.32,x:1086975,y:1120403},{j:113.263566,w:23.146333,utm_x:12608579.68,utm_y:2632777.63,x:1111742,y:1062098},{j:113.239213,w:23.152996,utm_x:12605868.69,utm_y:2633579.69,x:1107616,y:1056740},{j:113.253865,w:23.131628,utm_x:12607499.76,utm_y:2631007.65,x:1105912,y:1062966},{j:113.240767,w:23.088434,utm_x:12606041.68,utm_y:2625809.7,x:1092270,y:1068184},{j:113.279628,w:23.088284,utm_x:12610367.72,utm_y:2625791.65,x:1101412,y:1074883},{j:113.462271,w:23.107058,utm_x:12630699.66,utm_y:2628050.7,x:1148752,y:1101736},{j:113.401618,w:23.052957,utm_x:12623947.73,utm_y:2621541.68,x:1121925,y:1101535},{j:113.422504,w:23.05905,utm_x:12626272.77,utm_y:2622274.61,x:1128470,y:1104049},{j:113.362506,w:23.107149,utm_x:12619593.75,utm_y:2628061.65,x:1125835,y:1085505},{j:113.419629,w:23.143176,utm_x:12625952.73,utm_y:2632397.61,x:1148133,y:1089052},{j:113.23315,w:23.062251,utm_x:12605193.75,utm_y:2622659.67,x:1084184,y:1071368},{j:113.314525,w:23.101412,utm_x:12614252.48,utm_y:2627371.29,x:1113011,y:1078426},{j:113.307947,w:23.131369,utm_x:12613520.21,utm_y:2630976.47,x:1118622,y:1072198}],sh:[{j:121.524411,w:31.245875,utm_x:13528182.75,utm_y:3642354.51,x:1086581,y:1065728},{j:121.419229,w:31.244887,utm_x:13516473.81,utm_y:3642226.51,x:1032616,y:1029148},{j:121.405637,w:31.237871,utm_x:13514960.74,utm_y:3641317.54,x:1022724,y:1027244},{j:121.415348,w:31.222879,utm_x:13516041.78,utm_y:3639375.47,x:1018548,y:1036980},{j:121.422561,w:31.224261,utm_x:13516844.73,utm_y:3639554.48,x:1022976,y:1038908},{j:121.412581,w:31.204148,utm_x:13515733.75,utm_y:3636949.48,x:1006568,y:1043696},{j:121.443025,w:31.206202,utm_x:13519122.8,utm_y:3637215.49,x:1022656,y:1053704},{j:121.524061,w:31.246917,utm_x:13528143.79,utm_y:3642489.52,x:1082052,y:1064124},{j:121.529343,w:31.217769,utm_x:13528731.78,utm_y:3638713.59,x:1072696,y:1079064},{j:121.530268,w:31.210341,utm_x:13528834.75,utm_y:3637751.53,x:1068748,y:1082416},{j:121.511601,w:31.227303,utm_x:13526756.73,utm_y:3639948.53,x:1069276,y:1068716},{j:121.4966,w:31.243614,utm_x:13525086.81,utm_y:3642061.58,x:1071220,y:1056805},{j:121.485021,w:31.26138,utm_x:13523797.82,utm_y:3644363.54,x:1075708,y:1045540},{j:121.465114,w:31.278803,utm_x:13521581.76,utm_y:3646621.48,x:1073740,y:1031268},{j:121.454784,w:31.266566,utm_x:13520431.82,utm_y:3645035.58,x:1063591,y:1033191},{j:121.46851,w:31.24951,utm_x:13521959.81,utm_y:3642825.48,x:1060200,y:1044520},{j:121.446384,w:31.248422,utm_x:13519496.73,utm_y:3642684.51,x:1048784,y:1037750},{j:121.509499,w:31.246469,utm_x:13526522.73,utm_y:3642431.47,x:1079309,y:1060105},{j:121.481643,w:31.283943,utm_x:13523421.78,utm_y:3647287.68,x:1087096,y:1035304},{j:121.508054,w:31.280609,utm_x:13526361.87,utm_y:3646855.56,x:1098432,y:1045648},{j:121.493854,w:31.19121,utm_x:13524781.12,utm_y:3635274.07,x:1039624,y:1077288},{j:121.500079,w:31.185541,utm_x:13525474.09,utm_y:3634540.04,x:1039960,y:1081640},{j:121.484482,w:31.202846,utm_x:13523737.82,utm_y:3636780.87,x:1041388,y:1069232},{j:121.480877,w:31.189587,utm_x:13523336.51,utm_y:3635063.92,x:1032484,y:1073640},{j:121.502652,w:31.195209,utm_x:13525760.52,utm_y:3635791.9,x:1046384,y:1078728}]},getLnglatIndex:function(aW,a0,aZ){var aV=0;var aU=0;var a1=10000000,aY=1000000000;for(var aX=0;aX<this.correct_pts[aW].length;aX++){var e=this.getDis(this.correct_pts[aW][aX].x,this.correct_pts[aW][aX].y,a0,aZ);if(e<aY){if(e<a1){aY=a1;a1=e;aU=aV;aV=aX}else{sedMinDis=e;aU=aX}}}return{lt:aV,rb:aU}},getOMapIndex_mm:function(aW,a1,a0){var aV=0;var aU=0;var aZ=1294723000,aY=1294723000;for(var aX=0;aX<this.correct_pts[aW].length;aX++){var e=this.getDis(this.correct_pts[aW][aX].utm_x,this.correct_pts[aW][aX].utm_y,a1,a0);if(e<aY){if(e<aZ){aY=aZ;aZ=e;aU=aV;aV=aX}else{sedMinDis=e;aU=aX}}}return{lt:aV,rb:aU}},getDis:function(e,aV,i,aU){return Math.abs(e-i)+Math.abs(aV-aU)},toMap:function(aV,e,aW){var i=(e-aW)*this.num[aV].num;var aU=(e+aW)*this.num[aV].num*this.num[aV].num2;return{x:i,y:aU}},fromMap:function(aV,e,aW){aW=aW/this.num[aV].num2;var i=(e+aW)/(this.num[aV].num*2);var aU=(aW-e)/(this.num[aV].num*2);return{x:i,y:aU}},getDgPix_mm:function(aW,a1,aX){var a0=this.fromMap(aW,this.correct_pts[aW][a1].x,this.correct_pts[aW][a1].y);var aY=this.fromMap(aW,this.correct_pts[aW][aX].x,this.correct_pts[aW][aX].y);var a6=a0.x,i=a0.y;var a5=aY.x,e=aY.y;var a3=this.correct_pts[aW][a1].utm_x,aV=this.correct_pts[aW][a1].utm_y;var aZ=this.correct_pts[aW][aX].utm_x,aU=this.correct_pts[aW][aX].utm_y;var a4=Math.abs((aZ-a3)*100000/(a5-a6));var a2=Math.abs((aU-aV)*100000/(e-i));return{j:a4,w:a2,x:100000/a4,y:100000/a2}},getPx_mm:function(a9,a5,a4,aW,aV){var aU=this.correct_pts[a9][aW];var e=this.correct_pts[a9][aW];var a2=this.getDgPix_mm(a9,aW,aV);var aY=this.fromMap(a9,aU.x,aU.y);var aX=e.utm_x,bb=e.utm_y;var ba=a5,a3=a4;var a8=aY.x;var i=aY.y;var a0=ba-aX,a7=a3-bb;var a1=a0*a2.x+a8;var aZ=-a7*a2.y+i;var a6=this.toMap(a9,a1,aZ);return a6},getJw_mm:function(a7,a2,a1,aX,aW){var a0=this.correct_pts[a7][aX];var i=this.correct_pts[a7][aX];var a3=this.getDgPix_mm(a7,aX,aW);var a5=this.fromMap(a7,a2,a1);var aV=this.fromMap(a7,a0.x,a0.y);var aY=i.utm_x,a8=i.utm_y;var a6=aV.x;var aU=aV.y;var a9=a5.x-a6,a4=aU-a5.y;var aZ=a9/a3.x+aY;var e=a4/a3.y+a8;return{lng:aZ,lat:e}},getOMap_pts:function(i,e){return this.getOMap_index(i,e.lng,e.lat,e.lt,e.rb)},getMapJw_pts:function(i,e){return this.getMapJw_index(i,e.lng,9998336-e.lat,e.lt,e.rb)},getOMap_mm:function(aV,aU,i){var e=this.getOMapIndex_mm(aV,aU,i);return this.getOMap_index(aV,aU,i,e.lt,e.rb)},getMapJw_mm:function(aU,e,aV){aV=9998336-aV;var i=this.getLnglatIndex(aU,e,aV);return this.getMapJw_index(aU,e,aV,i.lt,i.rb)},getMapJw_Array:function(aY,aX){var aU=this.getLnglatIndex(aY,aX[0].lng,aX[0].lat);var e=new Array;for(var aW=0;aW<aX.length;aW++){var aV=this.getJw_mm(aY,aX[aW].lng,aX[aW].lat,aU.lt,aU.rb);e[aW]={lng:aV.lng,lat:aV.lat,lt:aU.lt,rb:aU.rb}}return e},getOMap_Array:function(aY,aX){var e=this.getOMapIndex_mm(aY,aX[0].lng,aX[0].lat);var aW=new Array;for(var aV=0;aV<aX.length;aV++){var aU=this.getPx_mm(aY,aX[aV].lng,aX[aV].lat,e.lt,e.rb);aW[aV]={lng:aU.x,lat:aU.y,lt:e.lt,rb:e.rb}}return aW},getOMap_index:function(aY,aX,aW,e,aV){if(!e||!aV){var i=this.getOMapIndex_mm(aY,aX,aW)}else{var i={lt:e,rb:aV}}var aU=this.getPx_mm(aY,aX,aW,i.lt,i.rb);return{x:Math.floor(aU.x),y:9998336-Math.floor(aU.y),lt:i.lt,rb:i.rb}},getMapJw_index:function(aX,aU,aY,i,aW){if(!i||!aW){var aV=this.getLnglatIndex(aX,aU,aY)}else{var aV={lt:i,rb:aW}}var e=this.getJw_mm(aX,aU,aY,aV.lt,aV.rb);return{lng:e.lng,lat:e.lat,lt:aV.lt,rb:aV.rb}}});function z(e){e=e||{};this.charset=e.charset||"utf-8";this.objName=e.objName||"mapData";this.callback=e.callback;this.errorUrl=e.errorUrl||""}z.inherits(E,"DataRequest");l.extend(z.prototype,{send:function(i,e){this.url=i;this.userData=e;var aU=this;var aV=t("script");aV.type="text/javascript";aV.userData=e;aV.setAttribute("defer","true");aV.defer=true;aV.loaded=false;aV.stime=new Date().getTime();if(aV.addEventListener){aV.addEventListener("load",function(aW){aU._loadData(aU.objName,aV)},false);aV.addEventListener("error",function(aW){aU._loadError(aU.objName,aV)},false)}else{if(aV.attachEvent){aV.attachEvent("onreadystatechange",function(aX){var aW=window.event.srcElement;aV.timer=setInterval(function(){aV.etime=new Date().getTime();var aY=parseInt(aV.etime-aV.stime);if(aW&&(aW.readyState=="loaded"||aW.readyState=="complete")){aV.loaded=true}if(aV.loaded==true){aU._loadData(aU.objName,aV);clearInterval(aV.timer)}else{if(aY>5000){aU._loadError(aU.objName,aV);clearInterval(aV.timer)}}},5)})}}aV.charset=aU.charset;aV.src=aU.url;document.getElementsByTagName("head")[0].appendChild(aV)},_loadData:function(aX,aU){var i=window[aX];var aW=new aw("onloaded");aW.data=i;for(var aV in aU.userData){if(!aW[aV]&&aU.userData[aV]){aW[aV]=aU.userData[aV]}}this.dispatchEvent(aW);aU.parentNode&&aU.parentNode.removeChild(aU);aU=null},_loadError:function(i,e){e.parentNode&&e.parentNode.removeChild(e);e=null}});var aI={request:function(i){var e=t("script",{src:i,type:"text/javascript",charset:"utf-8"});if(e.addEventListener){e.addEventListener("load",function(aV){var aU=aV.target;aU.parentNode.removeChild(aU)},false)}else{if(e.attachEvent){e.attachEvent("onreadystatechange",function(aV){var aU=window.event.srcElement;if(aU&&(aU.readyState=="loaded"||aU.readyState=="complete")){aU.parentNode.removeChild(aU)}})}}setTimeout(function(){document.getElementsByTagName("head")[0].appendChild(e);e=null},1)}};function aq(){}l.extend(aq,{Request:{INITIAL:-1,WAITING:0,COMPLETED:1},Dependency:{control:[],marker:[],poly:["marker"],infowindow:["marker"],hotspot:["poly"],menu:[],tools:["marker","poly"],oppc:[],opmb:[],"3dmap":["hotspot"]},preLoaded:{},Config:{_baseUrl:"http://api.map.baidu.com/getmodules?v=1.1",_timeout:5000},delayFlag:false,Module:{_modules:{},_arrMdls:[]},load:function(i,aV){var e=this.current(i);if(e._status==this.Request.COMPLETED){return}else{if(e._status==this.Request.INITIAL){this.combine(i);this.pushUniqueMdl(i);var aU=this;if(aU.delayFlag==false){aU.delayFlag=true;window.setTimeout(function(){var aW=aU.Config._baseUrl+"&mod="+aU.Module._arrMdls.join(",");aI.request(aW);aU.Module._arrMdls.length=0;aU.delayFlag=false},1)}e._status=this.Request.WAITING}e._callbacks.push(aV)}},combine:function(e){if(e&&this.Dependency[e]){var aV=this.Dependency[e];for(var aU=0;aU<aV.length;aU++){this.combine(aV[aU]);if(!this.Module._modules[aV[aU]]){this.pushUniqueMdl(aV[aU])}}}},pushUniqueMdl:function(aU){for(var e=0;e<this.Module._arrMdls.length;e++){if(this.Module._arrMdls[e]==aU){return}}this.Module._arrMdls.push(aU)},run:function(aW,aY){var aV=this.current(aW);try{eval(aY)}catch(aZ){return}aV._status=this.Request.COMPLETED;for(var aX=0,aU=aV._callbacks.length;aX<aU;aX++){aV._callbacks[aX]()}aV._callbacks.length=0},check:function(i,aU){var e=this;e.timeout=setTimeout(function(){var aV=e.Module._modules[i]._status;if(aV!=e.Request.COMPLETED){e.remove(i);e.load(i,aU)}else{clearTimeout(e.timeout)}},e.Config._timeout)},current:function(i){var e;if(!this.Module._modules[i]){this.Module._modules[i]={};this.Module._modules[i]._status=this.Request.INITIAL;this.Module._modules[i]._callbacks=[]}e=this.Module._modules[i];return e},remove:function(i){var e=this.current(i);delete e}});window._jsload=function(e,i){aq.run(e,i)};function P(){this._map=null;this._container;this._type="control";this.blockInfoWindow=true;this._visible=true}P.inherits(E,"Control");l.extend(P.prototype,{initialize:function(e){this._map=e;if(this._container){e.container.appendChild(this._container);return this._container}return},_i:function(e){if(!this._container&&this.initialize&&av(this.initialize)){this._container=this.initialize(e)}this._opts=this._opts||{printable:false};this._setStyle();this._setPosition();if(this._container){this._container._jsobj=this}},_setStyle:function(){var i=this._container;if(i){var e=i.style;e.position="absolute";e.zIndex=this._cZIndex||"10";e.MozUserSelect="none";if(!this._opts.printable){l.ac(i,"BMap_noprint")}l.on(i,"contextmenu",aC)}},remove:function(){this._map=null;if(!this._container){return}this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container._jsobj=null;this._container=null},_render:function(){this._container=Z(this._map.container,"<div unselectable='on'></div>");if(this._visible==false){this._container.style.display="none"}return this._container},_setPosition:function(){this.setAnchor(this._opts.anchor)},setAnchor:function(aV){if(this.anchorFixed||typeof aV!="number"||isNaN(aV)||aV<BMAP_ANCHOR_TOP_LEFT||aV>BMAP_ANCHOR_BOTTOM_RIGHT){aV=this.defaultAnchor}this._opts.offset=this._opts.offset||this.defaultOffset;var aU=this._opts.anchor;this._opts.anchor=aV;if(!this._container){return}var aX=this._container;var e=this._opts.offset.width;var aW=this._opts.offset.height;aX.style.left=aX.style.top=aX.style.right=aX.style.bottom="auto";switch(aV){case BMAP_ANCHOR_TOP_LEFT:aX.style.top=aW+"px";aX.style.left=e+"px";break;case BMAP_ANCHOR_TOP_RIGHT:aX.style.top=aW+"px";aX.style.right=e+"px";break;case BMAP_ANCHOR_BOTTOM_LEFT:aX.style.bottom=aW+"px";aX.style.left=e+"px";break;case BMAP_ANCHOR_BOTTOM_RIGHT:aX.style.bottom=aW+"px";aX.style.right=e+"px";break;default:break}var i=["TL","TR","BL","BR"];l.rc(this._container,"anchor"+i[aU]);l.ac(this._container,"anchor"+i[aV])},getAnchor:function(){return this._opts.anchor},setOffset:function(e){if(!e||e&&e.toString()!="Size"){return}this._opts.offset=new X(e.width,e.height);if(!this._container){return}this.setAnchor(this._opts.anchor)},getOffset:function(){return this._opts.offset},getDom:function(){return this._container},show:function(){if(this._visible==true){return}this._visible=true;if(this._container){this._container.style.display=""}},hide:function(){if(this._visible==false){return}this._visible=false;if(this._container){this._container.style.display="none"}},isPrintable:function(){return !!this._opts.printable},isVisible:function(){if(!this._container&&!this._map){return false}return !!this._visible}});window.BMAP_ANCHOR_TOP_LEFT=0;window.BMAP_ANCHOR_TOP_RIGHT=1;window.BMAP_ANCHOR_BOTTOM_LEFT=2;window.BMAP_ANCHOR_BOTTOM_RIGHT=3;function K(e){P.call(this);e=e||{};this._opts={printable:false};l.extend(this._opts,e);this._copyrightCollection=[];this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT;this.defaultOffset=new X(5,2);this.setAnchor(e.anchor);this._canShow=true;this.blockInfoWindow=false;this._asyncLoadCode()}K.inherits(P,"CopyrightControl");l.extend(K.prototype,{initialize:function(e){this._map=e;return this._container},addCopyright:function(aV){if(!aV||typeof aV.id!="number"||isNaN(aV.id)){return}var e={minZoom:0,bounds:null,content:"",mapType:""};for(var aU in aV){e[aU]=aV[aU]}if(this._map){var aY=e.minZoom;if(aY==-1||aY<aJ[this._map.mapType].zoomLevelMin||aY>aJ[this._map.mapType].zoomLevelMax){e.minZoom=aJ[this._map.mapType].zoomLevelMin}if(e.mapType!=""&&!aJ[e.mapType]){e.mapType=BMAP_NORMAL_MAP}}var aW=this.getCopyright(aV.id);if(aW){for(var aX in e){aW[aX]=e[aX]}}else{this._copyrightCollection.push(e)}},getCopyright:function(aV){for(var aU=0,e=this._copyrightCollection.length;aU<e;aU++){if(this._copyrightCollection[aU].id==aV){return this._copyrightCollection[aU]}}},getCopyrightCollection:function(){return this._copyrightCollection},removeCopyright:function(aV){for(var aU=0,e=this._copyrightCollection.length;aU<e;aU++){if(this._copyrightCollection[aU].id==aV){r=this._copyrightCollection.splice(aU,1);aU--;e=this._copyrightCollection.length}}},_asyncLoadCode:function(){var e=this;aq.load("control",function(){e._asyncDraw()})}});function ah(e){P.call(this);e=e||{};this._opts={printable:false};this._opts=l.extend(l.extend(this._opts,{size:new X(150,150),padding:8,isOpen:false,zoomInterval:4}),e);this.defaultAnchor=BMAP_ANCHOR_BOTTOM_RIGHT;this.defaultOffset=new X(0,0);this.setAnchor(e.anchor);this.setSize(this._opts.size);this._asyncLoadCode()}ah.inherits(P,"OverviewMapControl");l.extend(ah.prototype,{initialize:function(e){this._map=e;return this._container},setAnchor:function(e){P.prototype.setAnchor.call(this,e)},changeView:function(){this.changeView._running=true;this._opts.isOpen=!this._opts.isOpen;if(!this._container){this.changeView._running=false}},setSize:function(e){if(!e||e.toString()!="Size"){e=new X(150,150)}e.width=e.width>0?e.width:150;e.height=e.height>0?e.height:150;this._opts.size=e},getSize:function(){if(this.isOpen()){return this._opts.size}else{return new X(this._btnWidth,this._btnHeight)}},isOpen:function(){return this._opts.isOpen},_asyncLoadCode:function(){var e=this;aq.load("control",function(){e._asyncDraw()})}});function T(e){P.call(this);e=e||{};this._opts={printable:false};this._opts=l.extend(l.extend(this._opts,{color:"black",unit:"metric"}),e);this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT;this.defaultOffset=new X(81,18);this.setAnchor(e.anchor);this._units={metric:{name:"metric",conv:1,incon:1000,u1:"\u7c73",u2:"\u516c\u91cc"},us:{name:"us",conv:3.2808,incon:5280,u1:"\u82f1\u5c3a",u2:"\u82f1\u91cc"}};if(!this._units[this._opts.unit]){this._opts.unit="metric"}this._asyncLoadCode()}window.BMAP_UNIT_METRIC="metric";window.BMAP_UNIT_IMPERIAL="us";T.inherits(P,"ScaleControl");l.extend(T.prototype,{initialize:function(e){this._map=e;return this._container},setUnit:function(e){this._opts.unit=this._units[e]&&this._units[e].name||this._opts.unit},getUnit:function(){return this._opts.unit},_asyncLoadCode:function(){var e=this;aq.load("control",function(){e._asyncDraw()})}});window.BMAP_NAVIGATION_CONTROL_LARGE=0;window.BMAP_NAVIGATION_CONTROL_SMALL=1;window.BMAP_NAVIGATION_CONTROL_PAN=2;window.BMAP_NAVIGATION_CONTROL_ZOOM=3;function H(e){P.call(this);e=e||{};this._opts={printable:false,showZoomInfo:true};l.extend(this._opts,e);this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT;this.defaultOffset=new X(10,10);this.setAnchor(e.anchor);this.setType(e.type);this._asyncLoadCode()}H.inherits(P,"NavigationControl");l.extend(H.prototype,{initialize:function(e){this._map=e;return this._container},setType:function(e){if(typeof e=="number"&&e>=BMAP_NAVIGATION_CONTROL_LARGE&&e<=BMAP_NAVIGATION_CONTROL_ZOOM){this._opts.type=e}else{this._opts.type=BMAP_NAVIGATION_CONTROL_LARGE}},getType:function(){return this._opts.type},_asyncLoadCode:function(){var e=this;aq.load("control",function(){e._asyncDraw()})}});function ae(e){P.call(this);e=e||{};this._opts={printable:false};this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT;this.defaultOffset=new X(10,10);this.setAnchor(e.anchor);this._opts=l.extend(l.extend(this._opts,{offset:this.defaultOffset,enableSwitch:true}),e);this._asyncLoadCode()}ae.inherits(P,"MapTypeControl");l.extend(ae.prototype,{initialize:function(e){this._map=e;return this._container},select:function(e){},_asyncLoadCode:function(){var e=this;aq.load("control",function(){e._asyncDraw()})}});function g(i){E.call(this);this._opts={container:null,cursor:"default"};this._opts=l.extend(this._opts,i);this._type="contextmenu";this._map=null;this._container;this._shadow;this._left=0;this._top=0;this._items=[];this._rItems=[];this._dividers=[];this._enable=true;this.curPixel=null;this.curPoint=null;this._isOpen=false;var e=this;aq.load("menu",function(){e._draw()})}g.inherits(E,"ContextMenu");l.extend(g.prototype,{initialize:function(e){this._map=e},remove:function(){this._map=null},addItem:function(aV){if(!aV||aV._type!="menuitem"||aV._text==""||aV._width<=0){return}for(var aU=0,e=this._items.length;aU<e;aU++){if(this._items[aU]===aV){return}}this._items.push(aV);this._rItems.push(aV)},removeItem:function(aV){if(!aV||aV._type!="menuitem"){return}for(var aU=0,e=this._items.length;aU<e;aU++){if(this._items[aU]===aV){this._items[aU].remove();this._items.splice(aU,1);e--}}for(var aU=0,e=this._rItems.length;aU<e;aU++){if(this._rItems[aU]===aV){this._rItems[aU].remove();this._rItems.splice(aU,1);e--}}},addSeparator:function(){this._items.push({_type:"divider",_dIndex:this._dividers.length});this._dividers.push({dom:null})},removeSeparator:function(aU){if(!this._dividers[aU]){return}for(var aV=0,e=this._items.length;aV<e;aV++){if(this._items[aV]&&this._items[aV]._type=="divider"&&this._items[aV]._dIndex==aU){this._items.splice(aV,1);e--}if(this._items[aV]&&this._items[aV]._type=="divider"&&this._items[aV]._dIndex>aU){this._items[aV]._dIndex--}}this._dividers.splice(aU,1)},getDom:function(){return this._container},show:function(){if(this._isOpen==true){return}this._isOpen=true},hide:function(){if(this._isOpen==false){return}this._isOpen=false},setCursor:function(e){if(!e){return}this._opts.cursor=e},getItem:function(e){return this._rItems[e]},enable:function(){this._enable=true},disable:function(){this._enable=false}});function L(aU,aV,i){if(!aU||!aV||typeof aV!="function"){return}E.call(this);this._opts={width:100,id:""};i=i||{};this._opts.width=(i.width*1)?i.width:100;this._opts.id=i.id?i.id:"";this._text=aU+"";this._callback=aV;this._map=null;this._type="menuitem";this._contextmenu=null;this._container=null;this._enabled=true;var e=this;aq.load("menu",function(){e._draw()})}L.inherits(E,"MenuItem");l.extend(L.prototype,{initialize:function(e,i){this._map=e;this._contextmenu=i},remove:function(){this._contextmenu=null;this._map=null},setText:function(e){if(!e){return}this._text=e+""},getDom:function(){return this._container},enable:function(){this._enabled=true},disable:function(){this._enabled=false}});function y(e,aV,aU,i){this.minX=e;this.minY=aV;this.maxX=aU;this.maxY=i}l.extend(y.prototype,{isEmpty:function(){var e="number";return(typeof(this.minX)!=e||typeof(this.minY)!=e||typeof(this.maxX)!=e||typeof(this.maxY)!=e)},equals:function(e){if(!e||e.toString()!="Bounds"){return}return(this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY)},getMaxX:function(){return this.maxX},getMaxY:function(){return this.maxY},getMinX:function(){return this.minX},getMinY:function(){return this.minY},containsBounds:function(e){if(!e||e.toString()!="Bounds"){return}return(e.minX>this.minX&&e.maxX<this.maxX&&e.minY>this.minY&&e.maxY<this.maxY)},getCenterPoint:function(){return new f((this.minX+this.maxX)/2,(this.minY+this.maxY)/2)},getCenter:function(){return this.getCenterPoint()},intersects:function(aU){if(!aU||aU.toString()!="Bounds"){return}if(Math.max(aU.minX,aU.maxX)<Math.min(this.minX,this.maxX)||Math.min(aU.minX,aU.maxX)>Math.max(this.minX,this.maxX)||Math.max(aU.minY,aU.maxY)<Math.min(this.minY,this.maxY)||Math.min(aU.minY,aU.maxY)>Math.max(this.minY,this.maxY)){return null}var aW=Math.max(this.minX,aU.minX);var i=Math.min(this.maxX,aU.maxX);var aV=Math.max(this.minY,aU.minY);var e=Math.min(this.maxY,aU.maxY);return new y(aW,aV,i,e)},containsPoint:function(e){if(!e||e.toString()!="Point"){return}return(e.lng>=this.minX&&e.lng<=this.maxX&&e.lat>=this.minY&&e.lat<=this.maxY)},extend:function(e){if(!e||e.toString()!="Point"){return}var i=e.lng,aU=e.lat;if(!this.minX||this.minX>i){this.minX=i}if(!this.maxX||this.maxX<i){this.maxX=i}if(!this.minY||this.minY>aU){this.minY=aU}if(!this.maxY||this.maxY<aU){this.maxY=aU}},getIntersectLine:function(e){if(!e||e.toString()!="Line"){return}var i=e.sPoint;var aV=e.ePoint;var aU=[];if(i.lat==aV.lat){if(i.lng==aV.lng){return null}if(i.lat>this.minY&&i.lat<this.maxY){}var e=new Line(aU.lng,aU.lat);return e}},getMin:function(){return new f(this.minX,this.minY)},getMax:function(){return new f(this.maxX,this.maxY)},toString:function(){return"Bounds"}});function f(e,i){if(isNaN(e)){e=aa(e);e=isNaN(e)?0:e}if(typeof e=="string"){e=parseFloat(e)}if(isNaN(i)){i=aa(i);i=isNaN(i)?0:i}if(typeof i=="string"){i=parseFloat(i)}this.lng=e;this.lat=i}var u=f.prototype;u.equals=function(e){if(!e||e.toString()!="Point"){return}return(this.lat==e.lat&&this.lng==e.lng)};u.toString=function(){return"Point"};function x(e){if(Object.prototype.toString.call(e)!="[object Array]"){return}this.points=e}x.inherits(E,"Area");x.prototype={containsPoint:function(e){var aU=0,aW=0;var aX=this.points;for(var aV=0;aV<aX.length;aV++){aU=(aV==aX.length-1)?0:aU+1;if((aX[aV].lat!=aX[aU].lat)&&(((e.lat>=aX[aV].lat)&&(e.lat<aX[aU].lat))||((e.lat>=aX[aU].lat)&&(e.lat<aX[aV].lat)))&&(e.lng<(aX[aU].lng-aX[aV].lng)*(e.lat-aX[aV].lat)/(aX[aU].lat-aX[aV].lat)+aX[aV].lng)){aW++}}return(aW%2>0)?true:false},getQuad:function(e){return(e.lng>=0)?((e.lat>=0)?0:3):((e.lat>=0)?1:2)}};var aL={undo:1,redo:2,zoom:4,drag:8,move:16,mousewheel:32,toolbarOperation:64,stdMapCtrlDrag:128,dblclick:256};var ap={_map:null,_html:"<div class='BMap_opMask' unselectable='on'></div>",_maskElement:null,_cursor:"default",inUse:false,show:function(e){if(!this._map){this._map=e}this.inUse=true;if(!this._maskElement){this._createMask(e)}this._maskElement.style.display="block"},_createMask:function(i){if(!this._map){this._map=i}if(!this._map){return}var e=this._maskElement=Z(this._map.container,this._html);l.on(e,"mouseup",function(aU){if(aU.button==2){aC(aU)}});l.on(e,"contextmenu",aC);e.style.display="none"},getDrawPoint:function(aV,aY,aW){aV=window.event||aV;var i=aV.layerX||aV.offsetX||0;var aX=aV.layerY||aV.offsetY||0;var aU=aV.target||aV.srcElement;if(aU!=ap.getDom(this._map)&&aY==true){while(aU&&aU!=this._map.container){if(!(aU.clientWidth==0&&aU.clientHeight==0&&aU.offsetParent&&aU.offsetParent.nodeName.toLowerCase()=="td")){i+=aU.offsetLeft;aX+=aU.offsetTop}aU=aU.offsetParent}}if(aU!=ap.getDom(this._map)&&aU!=this._map.container){return}if(typeof i==="undefined"||typeof aX==="undefined"){return}if(isNaN(i)||isNaN(aX)){return}if(aW){i=i+aW.x;aX=aX+aW.y}return this._map.pixelToPoint(new aK(i,aX))},hide:function(){if(!this._map){return}this.inUse=false;if(this._maskElement){this._maskElement.style.display="none"}},getDom:function(e){if(!this._maskElement){this._createMask(e)}return this._maskElement},setCursor:function(e){this._cursor=e||"default";if(this._maskElement){this._maskElement.style.cursor=this._cursor}}};function O(){this._type="overlay"}O.inherits(l.BaseClass,"Overlay");O.getZIndex=function(i,e){i=i*1;if(!i){return 0}if(e&&e==BMAP_COORD_MERCATOR){i=V.convertMC2LL(new aS.Point(0,i)).lat}return(i*-100000)<<1};l.extend(O.prototype,{_i:function(e){if(!this.domElement&&av(this.initialize)){this.domElement=this.initialize(e);if(this.domElement){this.domElement.style.WebkitUserSelect="none"}}this.draw()},initialize:function(e){throw"initialize\u65b9\u6cd5\u672a\u5b9e\u73b0"},draw:function(){throw"draw\u65b9\u6cd5\u672a\u5b9e\u73b0"},remove:function(){if(this.domElement&&this.domElement.parentNode){this.domElement.parentNode.removeChild(this.domElement)}this.domElement=null;this.dispatchEvent(new aw("onremove"))},hide:function(){l.hide(this.domElement)},show:function(){l.show(this.domElement)},dispose:function(){l.BaseClass.prototype.decontrol.call(this)}});aS.register(function(i){i.temp.overlayDiv=i.overlayDiv=e(i.platform,200);i._panes.floatPane=e(i.temp.overlayDiv,800);i._panes.markerMouseTarget=e(i.temp.overlayDiv,700);i._panes.floatShadow=e(i.temp.overlayDiv,600);i._panes.labelPane=e(i.temp.overlayDiv,500);i._panes.markerPane=e(i.temp.overlayDiv,400);i._panes.mapPane=e(i.temp.overlayDiv,200);function e(aU,aX){var aW=t("div"),aV=aW.style;aV.position="absolute";aV.top=aV.left=aV.width=aV.height="0";aV.zIndex=aX;aU.appendChild(aW);return aW}});function aF(){l.BaseClass.call(this);O.call(this);this._visible=true;this.infoWindow=null;this._dblclickTime=0}aF.inherits(O,"OverlayInternal");l.extend(aF.prototype,{initialize:function(e){this.map=e;l.BaseClass.call(this,this.hashCode);return null},draw:function(){},remove:function(){this.map=null;this.decontrol();O.prototype.remove.call(this)},hide:function(){if(this._visible==false){return}this._visible=false},show:function(){if(this._visible==true){return}this._visible=true},getDom:function(){return this.domElement},setConfig:function(i){i=i||{};for(var e in i){if(typeof(this._config[e])==typeof(i[e])){this._config[e]=i[e]}}},getPoint:function(){return this.point},setZIndex:function(e){this.zIndex=e},isVisible:function(){if(!this.domElement){return false}return !!this._visible},enableMassClear:function(){this._config.enableMassClear=true},disableMassClear:function(){this._config.enableMassClear=false}});function at(){this.map=null;this._overlays={};this._customOverlays=[]}aS.register(function(i){var e=new at();e.map=i;i._overlays=e._overlays;i._customOverlays=e._customOverlays;i.addEventListener("load",function(aU){e.draw(aU)});i.addEventListener("moveend",function(aU){e.draw(aU)});if(l.Browser.ie&&l.Browser.ie<8||document.compatMode=="BackCompat"){i.addEventListener("zoomend",function(aU){setTimeout(function(){e.draw(aU)},20)})}else{i.addEventListener("zoomend",function(aU){e.draw(aU)})}i.addEventListener("maptypechange",function(aU){e.draw(aU)});i.addEventListener("addoverlay",function(aY){var aV=aY.target;if(aV instanceof aF){if(!e._overlays[aV.hashCode]){e._overlays[aV.hashCode]=aV}}else{var aX=false;for(var aW=0,aU=e._customOverlays.length;aW<aU;aW++){if(e._customOverlays[aW]===aV){aX=true;break}}if(!aX){e._customOverlays.push(aV)}}});i.addEventListener("removeoverlay",function(aX){var aV=aX.target;if(aV instanceof aF){delete e._overlays[aV.hashCode]}else{for(var aW=0,aU=e._customOverlays.length;aW<aU;aW++){if(e._customOverlays[aW]===aV){e._customOverlays.splice(aW,1);break}}}});i.addEventListener("clearoverlays",function(aX){this.closeInfoWindow();for(var aW in e._overlays){if(e._overlays[aW]._config.enableMassClear){e._overlays[aW].remove();delete e._overlays[aW]}}for(var aV=0,aU=e._customOverlays.length;aV<aU;aV++){if(e._customOverlays[aV].enableMassClear!=false){e._customOverlays[aV].remove();e._customOverlays[aV]=null;e._customOverlays.splice(aV,1);aV--;aU--}}});i.addEventListener("infowindowopen",function(aV){var aU=this.infoWindow;if(aU){l.hide(aU.popDom);l.hide(aU.shadowDom)}});i.addEventListener("movestart",function(){if(this.getInfoWindow()){this.getInfoWindow()._setOverflow()}});i.addEventListener("moveend",function(){if(this.getInfoWindow()){this.getInfoWindow()._resetOverflow()}})});at.prototype.draw=function(aV){for(var aU in this._overlays){this._overlays[aU].draw()}l.each(this._customOverlays,function(e){e.draw()});if(this.map.temp.infoWin){this.map.temp.infoWin.setPosition()}if(aS.DrawerSelector){var i=aS.DrawerSelector.getDrawer(this.map);i.setPalette()}};function au(e){aF.call(this);this._config={strokeColor:"#3a6bdb",strokeWeight:5,strokeOpacity:0.65,strokeStyle:"solid",enableMassClear:true,getParseTolerance:null,getParseCacheIndex:null,enableEditing:false,mouseOverTolerance:15,use3DCoords:false,clickable:true};this.setConfig(e);if(this._config.strokeWeight<=0){this._config.strokeWeight=5}if(this._config.strokeOpacity<0||this._config.strokeOpacity>1){this._config.strokeOpacity=0.65}if(this._config.fillOpacity<0||this._config.fillOpacity>1){this._config.fillOpacity=0.65}if(this._config.strokeStyle!="solid"&&this._config.strokeStyle!="dashed"){this._config.strokeStyle="solid"}this.domElement=null;this._bounds=new aS.Bounds(0,0,0,0);this._parseCache=[];this.vertexMarkers=[];this._temp={}}au.inherits(aF,"Graph");au.getGraphPoints=function(i){var e=[];if(!i){return e}if(typeof i=="string"){var aU=i.split(";");l.each(aU,function(aW){var aV=aW.split(",");e.push(new f(aV[0],aV[1]))})}if(i.constructor==Array&&i.length>0){e=i}return e};au.parseTolerance={0:[0.09,0.005,0.0001,0.00001],1:[9000,500,10,1]};l.extend(au.prototype,{initialize:function(e){this.map=e;return null},draw:function(){return;if(!this.domElement){return}if(this._drawer){this._drawer.setPath(this.domElement,this._getDisplayPixels(this.points))}},setPoints:function(e){this._parseCache.length=0;this.points=au.getGraphPoints(e).slice(0);this._calcBounds()},_calcBounds:function(){if(!this.points){return}var e=this;e._bounds=new y();l.each(this.points,function(i){e._bounds.extend(i)})},getPoints:function(){return this.points},setPointAt:function(i,e){if(!e||!this.points[i]){return}this._parseCache.length=0;this.points[i]=new f(e.lng,e.lat);this._calcBounds()},setStrokeColor:function(e){this._config.strokeColor=e},getStrokeColor:function(){return this._config.strokeColor},setStrokeWeight:function(e){if(e>0){this._config.strokeWeight=e}},getStrokeWeight:function(){return this._config.strokeWeight},setStrokeOpacity:function(e){if(!e||e>1||e<0){return}this._config.strokeOpacity=e},getStrokeOpacity:function(){return this._config.strokeOpacity},setFillOpacity:function(e){if(e>1||e<0){return}this._config.fillOpacity=e},getFillOpacity:function(){return this._config.fillOpacity},setStrokeStyle:function(e){if(e!="solid"&&e!="dashed"){return}this._config.strokeStyle=e},getStrokeStyle:function(){return this._config.strokeStyle},setFillColor:function(e){this._config.fillColor=e||""},getFillColor:function(){return this._config.fillColor},getBounds:function(){return this._bounds},remove:function(){if(this.map){this.map.removeEventListener("onmousemove",this._graphMouseEvent)}aF.prototype.remove.call(this);this._parseCache.length=0},enableEditing:function(){this._config.enableEditing=true},disableEditing:function(){this._config.enableEditing=false}});if(l.Browser.ie){l.on(document.body,"load",function(){if(document.namespaces&&!document.namespaces.olv){document.namespaces.add("olv","urn:schemas-microsoft-com:vml")}})}function aj(e){aF.call(this);this.map=null;this.domElement=null;this._config={width:0,height:0,offset:new X(0,0),opacity:1,background:"transparent",lineStroke:1,lineColor:"#000",lineStyle:"solid",point:null};this.setConfig(e);this.point=this._config.point}aj.inherits(aF,"Division");l.extend(aj.prototype,{_addDom:function(){var e=this._config;var aU=this.content;var i=['<div class="BMap_Division" style="position:absolute;'];i.push("width:"+e.width+"px;display:block;");i.push("overflow:hidden;");if(e.borderColor!="none"){i.push("border:"+e.lineStroke+"px "+e.lineStyle+" "+e.lineColor+";")}i.push("opacity:"+e.opacity+"; filter:(opacity="+e.opacity*100+")");i.push("background:"+e.background+";");i.push('z-index:60;">');i.push(aU);i.push("</div>");this.domElement=Z(this.map.getPanes().markerMouseTarget,i.join(""))},initialize:function(e){this.map=e;this._addDom();if(this.domElement){l.on(this.domElement,"mousedown",function(i){ag(i)})}return this.domElement},draw:function(){var e=this.map.pointToOverlayPixel(this._config.point);this._config.offset=new X(-Math.round(this._config.width/2)-Math.round(this._config.lineStroke),-Math.round(this._config.height/2)-Math.round(this._config.lineStroke));this.domElement.style.left=e.x+this._config.offset.width+"px";this.domElement.style.top=e.y+this._config.offset.height+"px"},getPoint:function(){return this._config.point},_getPixel:function(e){return this.map.pointToPixel(this.getPoint())},setPoint:function(e){this._config.point=e;this.draw()},setDimension:function(e,i){this._config.width=Math.round(e);this._config.height=Math.round(i);if(this.domElement){this.domElement.style.width=this._config.width+"px";this.domElement.style.height=this._config.height+"px";this.draw()}}});function w(i,aU,aW){if(!i||!aU){return}this.imageUrl=i;this.size=aU;var aV=new X(Math.floor(aU.width/2),Math.floor(aU.height/2));var aX={offset:aV,imageOffset:new X(0,0)};aW=aW||{};for(var e in aW){if(typeof(aX[e])==typeof(aW[e])){aX[e]=aW[e]}}this.offset=aX.offset;this.imageOffset=aX.imageOffset;this.infoWindowOffset=aW.infoWindowOffset||this.offset;this.printImageUrl=aW.printImageUrl||""}var R=w.prototype;R.setImageUrl=function(e){if(!e){return}this.imageUrl=e};R.setPrintImageUrl=function(e){if(!e){return}this.printImageUrl=e};R.setSize=function(e){if(!e){return}this.size=new X(e.width,e.height)};R.setOffset=function(e){if(!e){return}this.offset=new X(e.width,e.height)};R.setImageOffset=function(e){if(!e){return}this.imageOffset=new X(e.width,e.height)};R.setInfoWindowOffset=function(e){if(!e){return}this.infoWindowOffset=new X(e.width,e.height)};R.toString=function(){return"Icon"};function ay(aU,i){l.BaseClass.call(this);this.content=aU;this.map=null;this._config={width:0,height:0,maxWidth:600,offset:new X(0,0),title:"",maxContent:"",enableMaximize:false,enableAutoPan:true,enableCloseOnClick:true,margin:[10,10,40,10],collisions:[[10,10],[10,10],[10,10],[10,10]],ifMaxScene:false,onClosing:function(){return true}};this.setConfig(i);if(this._config.width!=0){if(this._config.width<220){this._config.width=220}if(this._config.width>730){this._config.width=730}}if(this._config.height!=0){if(this._config.height<60){this._config.height=60}if(this._config.height>650){this._config.height=650}}if(this._config.maxWidth!=0){if(this._config.maxWidth<220){this._config.maxWidth=220}if(this._config.maxWidth>730){this._config.maxWidth=730}}this.isWinMax=false;this.IMG_PATH=aQ.imgPath;this.overlay=null;var e=this;aq.load("infowindow",function(){e._draw()})}ay.inherits(l.BaseClass,"InfoWindow");l.extend(ay.prototype,{setWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<220){e=220}if(e>730){e=730}}this._config.width=e},setHeight:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<60){e=60}if(e>650){e=650}}this._config.height=e},setMaxWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<220){e=220}if(e>730){e=730}}this._config.maxWidth=e},setTitle:function(e){this._config.title=e||""},setContent:function(e){this.content=e||""},setMaxContent:function(e){this._config.maxContent=e||""},redraw:function(){},enableAutoPan:function(){this._config.enableAutoPan=true},disableAutoPan:function(){this._config.enableAutoPan=false},enableCloseOnClick:function(){this._config.enableCloseOnClick=true},disableCloseOnClick:function(){this._config.enableCloseOnClick=false},enableMaximize:function(){this._config.enableMaximize=true},disableMaximize:function(){this._config.enableMaximize=false},show:function(){this._visible=true},hide:function(){this._visible=false},close:function(){this.hide()},dispose:function(){l.BaseClass.prototype.decontrol.call(this)},maximize:function(){this.isWinMax=true},restore:function(){this.isWinMax=false},setConfig:function(i){if(!i){return}for(var e in i){if(typeof(this._config[e])==typeof(i[e])){this._config[e]=i[e]}}},isVisible:function(){return this.isOpen()},isOpen:function(){return false},getPoint:function(){if(this.overlay&&this.overlay.getPoint){return this.overlay.getPoint()}},getOffset:function(){return this._config.offset},toString:function(){return"InfoWindow"}});C.prototype.openInfoWindow=function(aV,e){if(!aV||aV.toString()!="InfoWindow"||!e||e.toString()!="Point"){return}var i=this.temp;if(!i.marker){var aU=new w(aQ.imgPath+"blank.gif",{width:1,height:1});i.marker=new J(e,{icon:aU,width:1,height:1,offset:new X(0,0),infoWindowOffset:new X(0,0),clickable:false});i.marker._fromMap=1}else{i.marker.setPoint(e)}this.addOverlay(i.marker);i.marker.openInfoWindow(aV)};C.prototype.closeInfoWindow=function(){var e=this.temp.infoWin||this.temp._infoWin;if(e&&e.overlay){e.overlay.closeInfoWindow()}};aF.prototype.openInfoWindow=function(e){if(this.map){this.map.closeInfoWindow();e._visible=true;this.map.temp._infoWin=e;e.overlay=this;l.BaseClass.call(e,e.hashCode)}};aF.prototype.closeInfoWindow=function(){if(this.map&&this.map.temp._infoWin){this.map.temp._infoWin._visible=false;this.map.temp._infoWin.decontrol();this.map.temp._infoWin=null}};function q(aU,i){aF.call(this);this.content=aU;this.map=null;this.domElement=null;this._config={width:0,offset:new X(0,0),styles:{backgroundColor:"#fff",border:"1px solid #f00",padding:"1px",whiteSpace:"nowrap",font:"12px arial,simsun",zIndex:"80",MozUserSelect:"none"},point:null,enableMassClear:true,clickable:true};i=i||{};this.setConfig(i);if(this._config.width<0){this._config.width=0}this.point=this._config.point;var e=this;aq.load("marker",function(){e._draw()})}q.inherits(aF,"Label");l.extend(q.prototype,{setPoint:function(e){if(e&&e.toString()=="Point"&&!this.getMarker()){this.point=this._config.point=new f(e.lng,e.lat)}},setContent:function(e){this.content=e},setOpacity:function(e){if(e>=0&&e<=1){this._config.opacity=e}},setOffset:function(e){if(!e||e.toString()!="Size"){return}this._config.offset=new X(e.width,e.height)},getOffset:function(){return this._config.offset},setStyle:function(e){e=e||{};this._config.styles=l.extend(this._config.styles,e)},setStyles:function(e){return this.setStyle(e)},setTitle:function(e){this._config.title=e||""},getTitle:function(){return this._config.title},setMarker:function(e){this._marker=e;if(e){this.point=this._config.point=e.getPoint()}else{this.point=this._config.point=null}},getMarker:function(){return this._marker||null}});function J(e,aU){aF.call(this);aU=aU||{};this.point=e;this.map=null;this.domElement=null;this.iconDom=null;this.infoWindowDom=null;this.siblingElement=null;this.iconClassName="";this._config={offset:new X(0,0),opacity:1,icon:null,title:"",infoWindow:null,label:null,baseZIndex:0,clickable:true,zIndexFixed:false,isTop:false,enableMassClear:true,enableDragging:false,restrictDraggingArea:false};this.setConfig(aU);if(!aU.icon){this._config.icon=new aS.Icon(aQ.imgPath+"marker_red.png",new X(23,25),{offset:new X(10,25),infoWindowOffset:new X(10,0)})}this._isDragging=false;var i=this;aq.load("marker",function(){i._draw()})}J.TOP_ZINDEX=O.getZIndex(-90)+1000000;J.DRAG_ZINDEX=J.TOP_ZINDEX+1000000;J.inherits(aF,"Marker");l.extend(J.prototype,{setIcon:function(e){if(e&&e.toString()=="Icon"){this._config.icon=e}},setIconClassName:function(e){if(this.iconDom){this.iconDom.className=e}},getIcon:function(){return this._config.icon},setLabel:function(e){if(e&&e.toString()=="Label"){this._config.label=e}},getLabel:function(){return this._config.label},enableDragging:function(e){this._config.enableDragging=true},disableDragging:function(){this._config.enableDragging=false},setPoint:function(e){if(e&&e.toString()=="Point"){this.point=this._config.point=new f(e.lng,e.lat)}},setTop:function(i,e){this._config.isTop=!!i;if(i){this._addi=e||0}},setTitle:function(e){this._config.title=e},getTitle:function(){return this._config.title||""},setOffset:function(e){if(e&&e.toString()=="Size"){this._config.offset=e}},getOffset:function(){return this._config.offset}});function c(e,aU){au.call(this,aU);aU=aU||{};this._config.fillOpacity=aU.fillOpacity?aU.fillOpacity:0.65;if(aU.fillColor==""){this._config.fillColor=""}else{this._config.fillColor=aU.fillColor?aU.fillColor:"#fff"}this.setPoints(e);var i=this;aq.load("poly",function(){i._draw()})}c.inherits(au,"Polygon");l.extend(c.prototype,{setPoints:function(i,e){this._userPoints=au.getGraphPoints(i).slice(0);var aU=au.getGraphPoints(i).slice(0);if(aU.length>1&&!aU[0].equals(aU[aU.length-1])){aU.push(new f(aU[0].lng,aU[0].lat))}au.prototype.setPoints.call(this,aU,e)},setPointAt:function(i,e){if(!this._userPoints[i]){return}this._userPoints[i]=new f(e.lng,e.lat);this.points[i]=new f(e.lng,e.lat);if(i==0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new f(e.lng,e.lat)}this._calcBounds()},getPoints:function(){var e=this._userPoints;if(e.length==0){e=this.points}return e}});function ai(e,aU){au.call(this,aU);this.setPoints(e);var i=this;aq.load("poly",function(){i._draw()})}ai.inherits(au,"Polyline");function Y(i,e,aU){this.point=i;this.radius=Math.abs(e);c.call(this,[],aU)}Y.parseTolerance={0:[0.01,0.0001,0.00001,0.000004],1:[1000,10,1,0.4]};Y.inherits(c,"Circle");l.extend(Y.prototype,{initialize:function(e){this.map=e;this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();return null},getPoint:function(){return this.point},getCenter:function(){return this.point},setPoint:function(e,i){if(!e){return}this.point=e},setCenter:function(e,i){this.setPoint(e,i)},getRadius:function(){return this.radius},setRadius:function(e,i){this.radius=Math.abs(e)},_getPerimeterPoints:function(e,a1){if(!e||!a1||!this.map){return[]}var aU=this.map;var aY=e.lng,aW=e.lat;if(aU.config.coordType==BMAP_COORD_MERCATOR){var a7=ar.convertMC2LL(e);aY=a7.lng;aW=a7.lat}var a9=[];var a3=a1/6378800,a0=(Math.PI/180)*aW,a6=(Math.PI/180)*aY;for(var aZ=0;aZ<360;aZ+=9){var aX=(Math.PI/180)*aZ,a4=Math.asin(Math.sin(a0)*Math.cos(a3)+Math.cos(a0)*Math.sin(a3)*Math.cos(aX)),a2=Math.atan2(Math.sin(aX)*Math.sin(a3)*Math.cos(a0),Math.cos(a3)-Math.sin(a0)*Math.sin(a4)),a5=((a6-a2+Math.PI)%(2*Math.PI))-Math.PI,a8=new f(a5*(180/Math.PI),a4*(180/Math.PI));if(aU.config.coordType==BMAP_COORD_LNGLAT){a9.push(a8)}else{a9.push(V.convertLL2MC(a8))}}var aV=a9[0];a9.push(new f(aV.lng,aV.lat));return a9}});function G(e,aU){c.call(this,e,aU);var i=this;aq.load("poly",function(){i._draw()})}G.inherits(c,"Rectangle");l.extend(G.prototype,{setPoints:function(aV){if(!aV){return}var aU=aV[0],e=aV[1];if(!aU||!e||aU.toString()!="Point"||e.toString()!="Point"){return}var aZ=aU;var aX=e;var aY=new f(aZ.lng,aX.lat);var aW=new f(aX.lng,aZ.lat);var i=aU;this.points=[aZ,aY,aX,aW,i];this._calcBounds()},getPoints:function(){return[this.points[0],this.points[2]]}});function aK(e,i){e=isNaN(e)?0:e;i=isNaN(i)?0:i;this.x=e;this.y=i}aK.prototype.equals=function(e){if(!e){return false}return e.x==this.x&&e.y==this.y};aK.prototype.toString=function(){return"Pixel"};function V(){}var ar=V;l.extend(V,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,0.00000898305509648872,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-0.03801003308653,17337981.2],[-7.435856389565537e-9,0.000008983055097726239,-0.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,0.00000898305509983578,0.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,0.32710905363475,6856817.37],[-1.981981304930552e-8,0.000008983055099779535,0.03278182852591,40.31678527705744,0.65659298677277,-4.44255534477492,0.85341911805263,0.12923347998204,-0.04625736007561,4482777.06],[3.09191371068437e-9,0.000008983055096812155,0.00006995724062,23.10934304144901,-0.00023663490511,-0.6321817810242,-0.00663494467273,0.03430082397953,-0.00466043876332,2555164.4],[2.890871144776878e-9,0.000008983055095805407,-3.068298e-8,7.47137025468032,-0.00000353937994,-0.02145144861037,-0.00001234426596,0.00010322952773,-0.00000323890364,826088.5]],LL2MC:[[-0.0015702102444,111320.7020616939,1704480524535203,-10338987376042340,26112667856603880,-35149669176653700,26595700718403920,-10725012454188240,1800819912950474,82.5],[0.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[0.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[0.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-0.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-0.0003218135878613132,111320.7020701615,0.00369383431289,823725.6402795718,0.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,0.37238884252424,7.45]],getDistanceByMC:function(aX,aV){if(typeof(aX)=="undefined"||typeof(aV)=="undefined"){return 0}var i,aW,e,aU;aX=this.convertMC2LL(aX);if(typeof(aX)=="undefined"){return 0}i=this.toRadians(aX.lng);aW=this.toRadians(aX.lat);aV=this.convertMC2LL(aV);if(typeof(aV)=="undefined"){return 0}e=this.toRadians(aV.lng);aU=this.toRadians(aV.lat);return this.getDistance(i,e,aW,aU)},getDistanceByLL:function(aX,aV){if(typeof(aX)=="undefined"||typeof(aV)=="undefined"){return 0}aX.lng=this.getLoop(aX.lng,-180,180);aX.lat=this.getRange(aX.lat,-74,74);aV.lng=this.getLoop(aV.lng,-180,180);aV.lat=this.getRange(aV.lat,-74,74);var i,e,aW,aU;i=this.toRadians(aX.lng);aW=this.toRadians(aX.lat);e=this.toRadians(aV.lng);aU=this.toRadians(aV.lat);return this.getDistance(i,e,aW,aU)},convertMC2LL:function(aU){var aV,aX;aV=new f(Math.abs(aU.lng),Math.abs(aU.lat));for(var aW=0;aW<this.MCBAND.length;aW++){if(aV.lat>=this.MCBAND[aW]){aX=this.MC2LL[aW];break}}var e=this.convertor(aU,aX);var aU=new f(e.lng.toFixed(6),e.lat.toFixed(6));return aU},convertLL2MC:function(e){var aU,aW;e.lng=this.getLoop(e.lng,-180,180);e.lat=this.getRange(e.lat,-74,74);aU=new f(e.lng,e.lat);for(var aV=0;aV<this.LLBAND.length;aV++){if(aU.lat>=this.LLBAND[aV]){aW=this.LL2MC[aV];break}}if(!aW){for(var aV=this.LLBAND.length-1;aV>=0;aV--){if(aU.lat<=-this.LLBAND[aV]){aW=this.LL2MC[aV];break}}}var aX=this.convertor(e,aW);var e=new f(aX.lng.toFixed(2),aX.lat.toFixed(2));return e},convertor:function(aU,aV){if(!aU||!aV){return}var e=aV[0]+aV[1]*Math.abs(aU.lng);var i=Math.abs(aU.lat)/aV[9];var aW=aV[2]+aV[3]*i+aV[4]*i*i+aV[5]*i*i*i+aV[6]*i*i*i*i+aV[7]*i*i*i*i*i+aV[8]*i*i*i*i*i*i;e*=(aU.lng<0?-1:1);aW*=(aU.lat<0?-1:1);return new f(e,aW)},getDistance:function(i,e,aV,aU){return this.EARTHRADIUS*Math.acos((Math.sin(aV)*Math.sin(aU)+Math.cos(aV)*Math.cos(aU)*Math.cos(e-i)))},toRadians:function(e){return Math.PI*e/180},toDegrees:function(e){return(180*e)/Math.PI},getRange:function(aU,i,e){if(i!=null){aU=Math.max(aU,i)}if(e!=null){aU=Math.min(aU,e)}return aU},getLoop:function(aU,i,e){while(aU>e){aU-=e-i}while(aU<i){aU+=e-i}return aU},convert2DTo3D:function(aU,e){if(!aU){aU="bj"}var i=m.getOMap_pts(aU,e);return new f(i.x,i.y)},convert3DTo2D:function(aU,e){if(!aU){aU="bj"}var i=m.getMapJw_pts(aU,e);return new f(i.lng,i.lat)},batch3DTo2D:function(aU,e){if(!aU){aU="bj"}var i=m.getMapJw_Array(aU,e);return i},batch2DTo3D:function(aU,e){if(!aU){aU="bj"}var i=m.getOMap_Array(aU,e);return i}});function X(i,e){this.width=parseFloat(i)||0;this.height=parseFloat(e)||0}X.prototype.equals=function(e){return !!(e&&this.width==e.width&&this.height==e.height)};X.prototype.toString=function(){return"Size"};function ax(a0,i,aW,aU,aV){this.mgr=a0;this.position=aW;this.name=a0.getTileName(aU,aV);this.info=aU;var a1=t("img");p(a1);a1.galleryImg=false;var aZ=a1.style;aZ.position="absolute";aZ.width=a0.tileSize+"px";aZ.height=a0.tileSize+"px";aZ.left=aW[0]+"px";aZ.top=aW[1]+"px";this.img=a1;this.src=i;var aY=this;this.img.onload=function(a8){if(!aY.mgr){return}var a5=aY.mgr;if(a5.map.temp._beginLoadTile){a5.map.temp._loadTileTime=new Date().getTime()-a5.map.temp._beginLoadTile}var a9=a5.bufferTiles;if(a5.bufferNumber>0){a9[aY.name]=aY;a9.push(aY.name)}var bc=a9.length-a5.bufferNumber;for(var a6=0;bc>0&&a6<a9.length;a6++){var a2=a9[a6];if(!a5.mapTiles[a2]){if(a9[a2]){a9[a2].mgr=null;var a7=a9[a2].img;if(a7.parentNode){o(a7);a7.parentNode.removeChild(a7)}a7=null;a9[a2].img=null;delete a9[a2]}a9.splice(a6,1);a6--;bc--}}aY.loaded=true;a5.imgNumber++;if(!s(aY.img)){if(aV.tilesDiv){aV.tilesDiv.appendChild(aY.img);if(FeBrowser.ie<=6&&FeBrowser.ie>0&&aV.isTransparentPng()==true){var bb=aY.src.toUpperCase();if(bb.indexOf(".PNG")>0){var a3=aY.img.style;var a4=a3.width;var bd=a3.height;var ba='position:absolute;FILTER: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+aY.src+'",sizingMethod=scale);';a3.cssText=ba;a3.width=a4;a3.height=bd;a3.left=aY.position[0]+"px";a3.top=aY.position[1]+"px"}}}}var a8=new aw("onimagechange");a8.action="show";a8.tile=aY.name;a5.map.dispatchEvent(a8)};this.img.onerror=function(a4){if(!aY.mgr){return}var a2=aY.mgr;aY.error=true;var a3=aJ[aV.mapType];if(a3.errorUrl){aY.img.src=a3.errorUrl}if(!s(aY.img)){if(aV.tilesDiv){aV.tilesDiv.appendChild(aY.img)}}};if(FeBrowser.ie<=6&&FeBrowser.ie>0&&aV.isTransparentPng()==true){a1.src=aQ.imgPath+"blank.gif"}else{a1.src=i}a1=null;var aX=new aw("onimagebefore");aX.tile=aY.name;a0.map.dispatchEvent(aX)}function aE(e){this.tileLayers=[];this.cacheDiv=null;this.map=e;this.bufferNumber=300;this.mapTiles=[];this.bufferTiles=[];this.slideMaxZoom=4;this.config=aJ[this.map.mapType];this.errorUrl=this.config.errorUrl;this.tileSize=this.config.tileSize;this.baseUnits=this.config.baseUnits;this.minZoomLevel=this.config.zoomLevelMin;this.maxZoomLevel=this.config.zoomLevelMax;this.tileURLs=this.config.tileUrls;this.imgNumber=0;this.temp={}}aS.register(function(i){var e=i.tileMgr=new aE(i);i.addEventListener("dragstart",function(aU){e.dragStart(aU)});i.addEventListener("dragend",function(aU){e.dragEnd(aU)});i.addEventListener("click",function(aU){e.click(aU)});i.addEventListener("mousewheel",function(aU){e.mouseWheel(aU)});i.addEventListener("dblclick",function(aU){e.dblClick(aU)});i.addEventListener("rightdblclick",function(aU){e.dblClick(aU)});i.addEventListener("minuspress",function(aU){e.keypress(aU)});i.addEventListener("pluspress",function(aU){e.keypress(aU)});i.addEventListener("load",function(aU){e.loadTiles()});i.addEventListener("zoomstartcode",function(aU){e._zoom(aU)});i.addEventListener("moving",function(aU){e.mend(aU)});i.addEventListener("resize",function(aU){e.resizeMap(aU)});i.addEventListener("addtilelayer",function(aU){e.addTileLayer(aU)});i.addEventListener("removetilelayer",function(aU){e.removeTileLayer(aU)})});l.extend(aE.prototype,{addTileLayer:function(aV){var aU=this;var i=aV.target;aU.tileLayers.push(i);if(aU.map.loaded){aU.moveGridTiles(true)}},removeTileLayer:function(a1){var a2=this;var aZ=a1.target;var aX=aZ.mapType;var aW=a2.mapTiles;var a3=a2.bufferTiles;for(var aU in a3){var aV=aU.split("-")[1];if(aV==aX){delete a3[aU]}}for(var aU in aW){var aV=aU.split("-")[1];if(aV==aX){delete aW[aU]}}if(a2.zoomsDiv&&a2.zoomsDiv.parentNode){a2.zoomsDiv.parentNode.removeChild(a2.zoomsDiv);a2.zoomsDiv.innerHTML=""}for(var a0=0,aY=a2.tileLayers.length;a0<aY;a0++){if(aZ==a2.tileLayers[a0]){a2.tileLayers.splice(a0,1);delete aZ}}a2.moveGridTiles(true)},getTileLayer:function(aW){var aV=this;for(var aU=0,e=aV.tileLayers.length;aU<e;aU++){tilelayer=aV.tileLayers[aU];if(tilelayer.mapType==aW){return tilelayer}}return},mend:function(i){this.moveGridTiles(true)},_zoom:function(aU){var i=this;if(i.zoomsDiv&&i.zoomsDiv.style.display!="none"){i.zoomsDiv.style.display="none"}setTimeout(function(){i.moveGridTiles(true);i.map.dispatchEvent(new aw("onzoomend"))},10)},resizeMap:function(i){this.loaded=false;this.moveGridTiles(true)},showTile:function(aZ,aY,a5,a1){this.centerPos=aY;var a0=aJ[a1.mapType];var aV=this.getTileName(aZ,a1);var aW=(aZ[0]*a0.tileSize)+aY[0];var a8=0;if(a1.mapType==BMAP_PERSPECTIVE_MAP&&this.map.getZoom()==15){a8=0.5}var aU=(a8-1-aZ[1])*a0.tileSize+aY[1];var a2=[aW,aU];var a4=this.mapTiles[aV];if(a4){if(a5){aR(a4.img,a2)}return}a4=this.bufferTiles[aV];if(a4){this.imgNumber++;a1.tilesDiv.insertBefore(a4.img,a1.tilesDiv.lastChild);this.mapTiles[aV]=a4;aR(a4.img,a2);var a3=new aw("onimagechange");a3.action="cache";a3.tile=this.getTileName(aZ,a1);this.map.dispatchEvent(a3);return}else{var a7=a0.baseUnits*Math.pow(2,(a0.zoomLevelMax-aZ[2]));var a6=new f(aZ[0]*a7,aZ[1]*a7);var aX=new aK(aZ[0],aZ[1]);var i=a1.getTilesUrl(aX,aZ[2]);a4=new ax(this,i,a2,aZ,a1);this.mapTiles[aV]=a4}},getTileName:function(e,i){var aV=i.mapType;var aU="";if(aV==BMAP_PERSPECTIVE_MAP){aU="TILE-"+aV+"-"+this.map.cityCode+"-"+e[0]+"-"+e[1]+"-"+e[2]}else{aU="TILE-"+aV+"-"+e[0]+"-"+e[1]+"-"+e[2]}return aU},hideTile:function(aW,aV){var aU=false;var i=aW.img;if(s(i)){if(aW.loaded){this.imgNumber--;aU=true}if(i.parentNode){o(i);i.parentNode.removeChild(i)}}var aX=new aw("onimagechange");aX.tile=this.getTileName(aW.info,aV);aX.action="hide";delete this.mapTiles[aW.name];if(!aU){if(i.parentNode){o(i);i.parentNode.removeChild(i)}i=null;aW.img=null;aW.mgr=null;aW=null}this.map.dispatchEvent(aX)},loadTiles:function(){var i=this;if(l.Browser.ie){try{document.execCommand("BackgroundImageCache",false,true)}catch(aV){}}if(this.zoomsDiv&&this.zoomsDiv.style.display!="none"){this.zoomsDiv.style.display="none"}i.moveGridTiles(true);var aU=i.map;aU.loaded=true},getCell:function(aW,aV){var e=this.baseUnits*Math.pow(2,(this.maxZoomLevel-aV));var aU=parseInt(aW.lng/e);var i=parseInt(aW.lat/e);return[aU,i,e*(aU+0.5),e*(i+0.5)]},moveGridTiles:function(bd){var a9=this.tileLayers.length;for(var bb=0;bb<a9;bb++){var aX=this.tileLayers[bb];if(aX.baseLayer||a9==1){this.tilesDiv=aX.tilesDiv;aX.baseLayer=true}var bj=aJ[aX.mapType];var bn=this.map;var ba=bn.zoomLevel;var be=bn.centerPoint;this.mapCenterPoint=be;var a2=bn.getZoomUnits(bn.zoomLevel);var a4=bj.baseUnits*Math.pow(2,(bj.zoomLevelMax-ba));var a3=parseInt(be.lng/a4);if(be.lng<0){a3-=1}var aY=parseInt(be.lat/a4);if(be.lat<0){aY-=1}var a8=bj.tileSize;var aW=[a3,aY,(be.lng-a3*a4)/a4*a8,(be.lat-aY*a4)/a4*a8];var bi=aW[0]-Math.ceil((bn.width/2-aW[2])/a8);var aV=aW[1]-Math.ceil((bn.height/2-aW[3])/a8);var bf=aW[0]+Math.ceil((bn.width/2+aW[2])/a8);var a6=0;if(aX.mapType==BMAP_PERSPECTIVE_MAP&&bn.getZoom()==15){a6=1}var a5=aW[1]+Math.ceil((bn.height/2+aW[3])/a8)+a6;if(bd){this.areaCenter=new f(be.lng,be.lat)}var aU=this.mapTiles;var a1=-this.areaCenter.lng/a2;var a0=this.areaCenter.lat/a2;var bl=[Math.round(a1),Math.round(a0)];for(var bm in aU){var bo=aU[bm];var bk=bo.info;if(!bk){continue}if(bk[2]==bn.zoomLevel&&(bi>bk[0]||bf<=bk[0]||aV>bk[1]||a5<=bk[1])){this.hideTile(bo,aX)}else{if(bk[2]!=bn.zoomLevel){this.hideTile(bo,aX)}else{if(bk[2]==bn.lastLevel){this.showTile(bk,[bl[0]*Math.pow(2,bn.zoomLevel-bn.lastLevel),bl[1]*Math.pow(2,bn.zoomLevel-bn.lastLevel)],bd,aX)}}}}var aZ=-bn.offsetX+bn.width/2;var a7=-bn.offsetY+bn.height/2;aX.tilesDiv.style.left=Math.round(a1+aZ)-bl[0]+"px";aX.tilesDiv.style.top=Math.round(a0+a7)-bl[1]+"px";var e=[];this.imgTotalNumber=0;for(var bh=bi;bh<bf;bh++){for(var bg=aV;bg<a5;bg++){e.push([bh,bg]);this.imgTotalNumber++}}e.sort((function(i){return function(bp,bq){return(Math.abs(bp[0]-i[0]+bp[1]-i[1])-Math.abs(bq[0]-i[0]+bq[1]-i[1]))}})([aW[0],aW[1]]));if(!bn.temp._beginLoadTile){bn.temp._beginLoadTile=new Date().getTime()}for(var bh=0,bc=e.length;bh<bc;bh++){this.showTile([e[bh][0],e[bh][1],bn.zoomLevel],bl,bd,aX)}}return},dragStart:function(i){this.temp.pps={x:this.map.offsetX,y:this.map.offsetY}},dragEnd:function(i){this.temp.ppe={x:this.map.offsetX,y:this.map.offsetY};if(l.Platform.iphone||l.Platform.ipad||l.Platform.android){if(this.zoomsDiv&&this.zoomsDiv.style.display!="none"){this.zoomsDiv.style.display="none"}}},click:function(aU){if(!this.map.config.enableClickPan){return}var i=this.temp;if(this.map.currentOperation==0&&!i.ppe&&!i.pps||(i.ppe&&i.pps&&(i.ppe.x-i.pps.x==0&&i.ppe.y-i.pps.y==0))){this.map.panBy(this.map.width/2-aU.offsetX,this.map.height/2-aU.offsetY)}i.pps=null;i.ppe=null},mouseWheel:function(aY){var aX=this.map;if(!aX.config.enableWheelZoom){return}var aZ=aX.zoomLevel+(aY.trend==true?1:-1);var aV=aX._getProperZoom(aZ);if(aV.exceeded){return}aX.dispatchEvent(new aw("onzoomstart"));aX.lastLevel=aX.zoomLevel;aX.zoomLevel=aV.zoom;var i=aY.pixel;var aU=aX.pixelToPoint(i,aX.lastLevel,true);var aW=aX.getZoomUnits(aX.zoomLevel);aX.centerPoint=new f(aU.lng+aW*(aX.width/2-i.x),aU.lat-aW*(aX.height/2-i.y));this.zoom(i)},dblClick:function(a1){var aW=this.map;if(!aW.config.enableDblclickZoom){return}var a2=a1.pixel;var aX=aW.pixelToPoint(a2,null,true);var aY=1;var aU=a2;var aZ=new X(0,0);if(a1.type=="onrightdblclick"){aY=-1;aU=new aK(aW.width/2,aW.height/2)}var aV=aW.zoomLevel+aY;var a0=aW._getProperZoom(aV);if(!a0.exceeded){aW.dispatchEvent(new aw("onzoomstart"));aW.lastLevel=aW.zoomLevel;aW.zoomLevel=a0.zoom;if(aY==1){aW.centerPoint=new f(aX.lng,aX.lat);var i=(aW.getZoomUnits(aW.lastLevel))/aW.getZoomUnits(a0.zoom)*0.5;aZ.width=a2.x-Math.round(aW.width/2)*i;aZ.height=a2.y-Math.round(aW.height/2)*i}this.zoom(aU,aZ)}else{if(aY==1){var a3=aW.pixelToPoint(a2,null);aW.panTo(a3)}}},keypress:function(aY){var aX=this.map;if(!aX.config.enableContinuousZoom){aY.type=="onpluspress"?aX.zoomIn():aX.zoomOut();return}if(this._zTimeLine){return}var aZ=aX.zoomLevel+(aY.type=="onpluspress"?1:-1);var aV=aX._getProperZoom(aZ);if(aV.exceeded){return}aX.dispatchEvent(new aw("onzoomstart"));var i=new aK(aX.width/2,aX.height/2);aX.lastLevel=aX.zoomLevel;aX.zoomLevel=aV.zoom;if(aX.getInfoWindow()){i=aX.pointToPixel(aX.getInfoWindow().getPoint(),aX.lastLevel);var aU=aX.pixelToPoint(i,aX.lastLevel,true);var aW=aX.getZoomUnits(aX.zoomLevel);aX.centerPoint=new f(aU.lng+aW*(aX.width/2-i.x),aU.lat-aW*(aX.height/2-i.y))}this.zoom(i)}});function F(e){this.opts=e||{};this.copyright=this.opts.copyright||{};this.transparentPng=this.opts.transparentPng||false;this.baseLayer=this.opts.baseLayer||false;this.offset=[0,0];this._type="tilelayer"}F.inherits(E,"TileLayer");l.extend(F.prototype,{isTransparentPng:function(){return this.transparentPng},getTilesUrl:function(a0,i){var aU=aJ[this.mapType];if(typeof aU!="object"){return null}var aZ=aU.baseUnits*Math.pow(2,(aU.zoomLevelMax-i));var a1=a0.x;var aW=a0.y;var aY=Math.floor(a1/200);var aX=Math.floor(aW/200);var e="";if(this.opts.tileUrlTemplate){e=this.opts.tileUrlTemplate;e=e.replace(/\{X\}/,a1);e=e.replace(/\{Y\}/,aW);e=e.replace(/\{Z\}/,i)}else{if(this.mapType==BMAP_NORMAL_MAP){e=aU.tileUrls[Math.abs(a1+aW)%aU.tileUrls.length]+"u=x="+a1+";y="+aW+";z="+i+";v=004;type=web&fm=44";e=e.replace(/-(\d+)/gi,"M$1")}if(this.mapType==BMAP_PERSPECTIVE_MAP){var aV=Math.pow(2,(aU.zoomLevelMax-i))*aU.baseUnits;aW=Math.round((9998336-aV*(aW))/aV)-1;e=aU.tileUrls[Math.abs(a1+aW)%aU.tileUrls.length]+this.map.currentCity+"/"+this.map.cityCode+"/3/lv"+(21-i)+"/"+a1+","+aW+"."+(aU.imgExtend||"jpg")}}return e},initialize:function(aU){if(!aU.temp.layerZIndex){aU.temp.layerZIndex=0}this.zIndex=this.zIndex||0;if(this.baseLayer){this.zIndex=-1}if(!aU.temp.layid){aU.temp.layid=0}if(!this.opts.mapType){this.mapType="BMAP_CUSTOM_LAYER_"+aU.temp.layid;aU.temp.layid++}else{this.mapType=this.opts.mapType}var e=aJ[this.mapType];if(!e){aJ[this.mapType]={tileUrls:[],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:18,errorUrl:aQ.imgPath+"/blank.gif",bounds:new y(-21364736,-10616832,23855104,15859712),imgExtend:"png"}}var i=Z(aU.platform,'<div style="position:absolute;z-index:'+this.zIndex+'"></div>');i.style.display="";i.style.left=Math.ceil(-aU.offsetX+aU.width/2)+"px";i.style.top=Math.ceil(-aU.offsetY+aU.height/2)+"px";this.tilesDiv=i;this.map=aU},remove:function(){if(this.tilesDiv&&this.tilesDiv.parentNode){this.tilesDiv.innerHTML="";this.tilesDiv.parentNode.removeChild(this.tilesDiv)}delete this.tilesDiv},getCopyright:function(){return this.copyright},getMapType:function(){return this.mapType},setZIndex:function(e){this.zIndex=e;if(this.tilesDiv){this.tilesDiv.style.zIndex=e}}});function af(i,e,aU){this.bounds=i;this.content=e;this.mapType=aU}af.inherits(E,"Copyright");function aH(e){this._opts={};e=e||{};this._opts=l.extend(this._opts,e);if(this._opts.predictDate){if(this._opts.predictDate.weekday<1||this._opts.predictDate.weekday>7){this._opts.predictDate=1}if(this._opts.predictDate.hour<0||this._opts.predictDate.hour>23){this._opts.predictDate.hour=0}}this._tileUrl="http://p{number}.map.baidu.com/traffic/"}aH.prototype=new F();aH.prototype.initialize=function(e){F.prototype.initialize.call(this,e);this._map=e};aH.prototype.getTilesUrl=function(aY,i){var aZ="";if(this._opts.predictDate){aZ="history/"+this._opts.predictDate.weekday+"/"+this._opts.predictDate.hour+"/"}var aU=this._map,a0=aY.x,aV=aY.y,aX=Math.floor(a0/200),aW=Math.floor(aV/200),e=this._tileUrl.replace("{number}",[Math.abs(a0+aV)%8])+aZ+i+"/"+aX+"/"+aW+"/"+a0+"_"+aV+".png";return e.replace(/-(\d+)/gi,"M$1")};function ao(e){E.call(this);if(!e){return}this._opts={};this._map=e}ao.inherits(E,"ToolbarItem");l.extend(ao.prototype,{open:function(){if(this._isOpen==true){return true}if(this._map._toolInUse){return false}this._map._toolInUse=true;this._isOpen=true;return true},close:function(){if(!this._isOpen){return}this._map._toolInUse=false;this._isOpen=false},_checkStr:function(e){if(!e){return""}return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}});function ak(aU,i){ao.call(this,aU);this._opts=l.extend(l.extend(this._opts,{icon:null,iconFollow:false,followText:"",cursor:"pointer"}),i);this._isOpen=false;this._opts.followText=this._checkStr(this._opts.followText);this.followTitle=this._opts.followText;this.followMarker=null;this._overlays=[];var e=this;aq.load("tools",function(){e._draw()})}ak.inherits(ao,"PushpinTool");l.extend(ak.prototype,{setIcon:function(e){if(!e||e&&e.toString()!="Icon"){return}this._opts.icon=e},getIcon:function(){return this._opts.icon},setCursor:function(e){this._opts.cursor=e},getCursor:function(){return this._opts.cursor},clear:function(){for(var aU=0,e=this._overlays.length;aU<e;aU++){if(this._overlays[aU].remove){this._overlays[aU].remove();this._overlays[aU].dispose()}}this._overlays.length=0},toString:function(){return"PushPinTool"}});function S(aU,i){ao.call(this,aU);i=i||{};this._opts=l.extend(l.extend(this._opts||{},{autoClear:false,tips:"\u6d4b\u8ddd",followText:"\u5355\u51fb\u786e\u5b9a\u8d77\u70b9\uff0c\u53cc\u51fb\u7ed3\u675f\u7ed8\u5236",unit:"metric",showResult:true,lineColor:"blue",lineStroke:2,opacity:1,lineStyle:"solid",cursor:aQ.imgPath+"ruler.cur",styleCodes:{lnCode:0,spCode:0,slCode:0,tlCode:0},enableMassClear:true}),i);if(this._opts.showResult==false){if(typeof i.tips=="undefined"){this._opts.tips="\u7ed8\u5236\u6298\u7ebf"}if(!i.cursor){this._opts.cursor="crosshair"}}if(this._opts.lineStroke<=0){lineStroke=2}if(this._opts.opacity>1){this._opts.opacity=1}else{if(this._opts.opacity<0){this._opts.opacity=0}}if(this._opts.lineStyle!="solid"&&this._opts.lineStyle!="dashed"){this._opts.lineStyle="solid"}this._checked=false;this._drawing=null;this.followTitle=null;this._totalDis={};this._points=[];this._paths=[];this._dots=[];this._segDistance=[];this._overlays=[];this._units={metric:{name:"metric",conv:1,incon:1000,u1:"\u7c73",u2:"\u516c\u91cc"},us:{name:"us",conv:3.2808,incon:5279.856,u1:"\u82f1\u5c3a",u2:"\u82f1\u91cc"}};if(!this._units[this._opts.unit]){this._opts.unit="metric"}this._dLineColor="#ff6319";this._dLineStroke=3;this._dOpacity=0.8;this._dLineStyle="solid";this._dCursor=aQ.imgPath+"ruler.cur";if(this._opts.showResult){this._opts.followText="\u5355\u51fb\u786e\u5b9a\u8d77\u70b9"}this._followTextM="\u5355\u51fb\u786e\u5b9a\u5730\u70b9\uff0c\u53cc\u51fb\u7ed3\u675f";this._movingTimerId=null;if(this._opts.showResult){this.text="\u6d4b\u8ddd"}else{this.text="\u7ed8\u7ebf"}this._isOpen=false;var e=this;aq.load("tools",function(){e._draw()})}S.inherits(ao,"PolylineTItem");l.extend(S.prototype,{setLineColor:function(e){this._opts.lineColor=e},setLineStroke:function(e){if(Math.round(e)>0){this._opts.lineStroke=Math.round(e)}},setOpacity:function(e){if(e>=0&&e<=1){this._opts.opacity=e}},setLineStyle:function(e){if(e=="solid"||e=="dashed"){this._opts.lineStyle=e}},clear:function(){for(var aU=0,e=this._overlays.length;aU<e;aU++){if(this._overlays[aU]){this._map.removeOverlay(this._overlays[aU])}}this._overlays.length=0;for(var aU=0,e=this._dots.length;aU<e;aU++){if(this._dots[aU]&&this._dots[aU].parentNode){this._dots[aU].parentNode.removeChild(this._dots[aU])}}this._dots.length=0},setCursor:function(e){if(this._opts.showResult==true){}else{this._opts.cursor=e}},getCursor:function(){if(this._opts.showResult==true){return this._dCursor}var e=this._opts.cursor.match(/^url\((.+)\)(,.*)?/);if(e!=null){return e[1]}else{return this._opts.cursor}},showResult:function(e){this._opts.showResult=!!e},toString:function(){return"DistanceTool"}});window.BMAP_ZOOM_IN=0;window.BMAP_ZOOM_OUT=1;function n(aU,i){ao.call(this,aU);this._opts=l.extend(l.extend(this._opts,{zoomType:BMAP_ZOOM_IN,followText:"",strokeWeight:2,strokeColor:"#111",style:"solid",fillColor:"#ccc",opacity:0.4,cursor:"crosshair",autoClose:false}),i);this._opts.strokeWeight=this._opts.strokeWeight<=0?1:this._opts.strokeWeight;this._opts.opacity=this._opts.opacity<0?0:this._opts.opacity>1?1:this._opts.opacity;if(this._opts.zoomType<BMAP_ZOOM_IN||this._opts.zoomType>BMAP_ZOOM_OUT){this._opts.zoomType=BMAP_ZOOM_IN}this._isOpen=false;this._fDiv=null;this.followTitle=null;var e=this;aq.load("tools",function(){e._draw()})}n.inherits(ao,"DragAndZoomTool");l.extend(n.prototype,{setStrokeColor:function(e){if(typeof e=="string"){this._opts.strokeColor=e}},setLineStroke:function(e){if(typeof e=="number"&&Math.round(e)>0){this._opts.strokeWeight=Math.round(e)}},setLineStyle:function(e){if(e=="solid"||e=="dashed"){this._opts.style=e}},setOpacity:function(e){if(typeof e=="number"&&e>=0&&e<=1){this._opts.opacity=e}},setLineStyle:function(e){if(e=="solid"||e=="dashed"){this._opts.style=e}},setFillColor:function(e){this._opts.fillColor=e},setCursor:function(e){this._opts.cursor=e},getCursor:function(){return this._opts.cursor},toString:function(){return"DragAndZoomTool"}});function ad(){this._container=null}aS.register(function(i){if(i.config.isOverviewMap){return}var e=new ad();i.container.insertAdjacentHTML("beforeEnd",e.render(i.config.defaultCursor));e._container=i.container.lastChild;i.temp.zoomer=e});ad.prototype.render=function(i){var e=['<div id=zoomer style="position:absolute;z-index:0;top:0px;left:0px;overflow:hidden;visibility:hidden;cursor:'+i+'">'];e.push('<div class="BMap_zoomer" style="top:0;left:0;"></div>');e.push('<div class="BMap_zoomer" style="top:0;right:0;"></div>');e.push('<div class="BMap_zoomer" style="bottom:0;left:0;"></div>');e.push('<div class="BMap_zoomer" style="bottom:0;right:0;"></div>');e.push("</div>");return e.join("")};ad.prototype.action=function(a0,a1){if(ad._timeline){return}var aZ=this._container;if(!aZ){return}var a8=a1;var aU=60;var a7=120;var a2=4/3,aW=Math.ceil((a8?aU:a7)/2),aX=Math.max(15,aW/a2),aY=aZ.style;aY.width=aW*2+"px";aY.height=aX*2+"px";aY.visibility="visible";var a4=aZ.children;if(a8){a4[0].style.backgroundPosition="0 0";a4[1].style.backgroundPosition="-7px 0";a4[2].style.backgroundPosition="0 -7px";a4[3].style.backgroundPosition="-7px -7px"}else{a4[0].style.backgroundPosition="-7px -7px";a4[1].style.backgroundPosition="0 -7px";a4[2].style.backgroundPosition="-7px 0";a4[3].style.backgroundPosition="0 0"}a4=null;var a6=a0.x-aW;var a5=a0.y-aX;if(isNaN(a6)||isNaN(a5)){return}aY.left=a6+"px";aY.top=a5+"px";var i=Math.ceil((a8?a7:aU)/2);var aV=Math.max(15,i/a2);i=i-aW;aV=Math.ceil(aV-aX);var a3=this;var e=a3._container.style;if(ad._timeline){ad._timeline.end()}ad._timeline=new aG({fps:20,duration:240,transition:k.easeInQuad,delay:100,render:function(ba){if(ba<0.1){return}var bb=Math.ceil(i*ba);var a9=Math.ceil(aV*ba);e.width=(aW+bb)*2+"px";e.height=(aX+a9)*2+"px";e.left=a6-bb+"px";e.top=a5-a9+"px"},finish:function(){ad._timeline=false;setTimeout(function(){aY.visibility="hidden"},300)}})};window.BMap=aS;aS.Map=C;aS.MapType=aJ;aS.Point=f;aS.Pixel=aK;aS.Size=X;aS.Bounds=y;aS.Area=x;aS.TileLayer=F;aS.Copyright=af;aS.CoordTrans=m;aS.Projection=V;aS.Overlay=O;aS.Label=q;aS.Marker=J;aS.Icon=w;aS.Polyline=ai;aS.Polygon=c;aS.Rectangle=G;aS.InfoWindow=ay;aS.Circle=Y;aS.Control=P;aS.NavigationControl=H;aS.OverviewMapControl=ah;aS.CopyrightControl=K;aS.ScaleControl=T;aS.MapTypeControl=ae;aS.PushpinTool=ak;aS.DistanceTool=S;aS.DragAndZoomTool=n;aS.TrafficLayer=aH;aS.ContextMenu=g;aS.MenuItem=L;aS.OperationMask=ap;aS.register(function(e){if(e.config&&e.config.isOverviewMap){return}e.addEventListener("load",function(){if(e.temp.copyadded){return}e.temp.copyadded=true;var aV=new K({offset:new X(81,2),printable:true});var aU="&copy; 2011 Baidu";if(e.getMapType()==BMAP_PERSPECTIVE_MAP){aU='<span style="color:#fff">&copy; 2011 Baidu - Data &copy; </span><a href="http://o.cn" target="_blank" style="color:#fff">\u90fd\u5e02\u5708</a>'}aV.addCopyright({content:aU,id:1});e.addEventListener("maptypechange",function(){var aW=e.getMapType();if(aW==BMAP_PERSPECTIVE_MAP){aV.addCopyright({id:1,content:'<span style="color:#fff">&copy; 2011 Baidu - Data &copy; </span><a href="http://o.cn" target="_blank" style="color:#fff">\u90fd\u5e02\u5708</a>'})}if(aW==BMAP_NORMAL_MAP){aV.addCopyright({id:1,content:"&copy; 2011 Baidu"})}});e.addControl(aV);var i=new I();i._opts={printable:true};e.addControl(i)})});function I(e){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT;this.defaultOffset=new X(1,0);this._useSmallImage=!!(l.Platform.ipad||l.Platform.iphone||l.Platform.android);this.IMG_URL=aQ.imgPath+(this._useSmallImage?"copyright_logo_s.png":"copyright_logo.png")}I.prototype=new P();I.prototype.initialize=function(i){this._map=i;var aU=t("div");aU.style.height="32px";var e=t("a",{title:"\u5230\u767e\u5ea6\u5730\u56fe\u9996\u9875",target:"_blank",href:"http://map.baidu.com/?sr=1"});e.style.outline="none";if(l.Browser.ie==6){e.innerHTML="<div style='cursor:pointer;width:77px;height:32px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+this.IMG_URL+")'></div>"}else{e.innerHTML="<img style='border:none;width:77px;height:32px' src='"+this.IMG_URL+"' />"}if(this._useSmallImage){aU.style.height="25px";e.href="#";e.innerHTML="<img style='border:none;width:68px;height:25px' src='"+this.IMG_URL+"' />"}aU.appendChild(e);i.getContainer().appendChild(aU);e=null;return aU};})();(function(){var baidu=baidu||{version:"1-1-0"};baidu.event=baidu.event||{};baidu.event._unload=function(){var c=baidu.event._listeners,a=c.length,b=!!window.removeEventListener,e,d;while(a--){e=c[a];d=e[0];if(d.removeEventListener){d.removeEventListener(e[1],e[3],false)}else{if(d.detachEvent){d.detachEvent("on"+e[1],e[3])}}}if(b){window.removeEventListener("unload",baidu.event._unload,false)}else{window.detachEvent("onunload",baidu.event._unload)}};if(window.attachEvent){window.attachEvent("onunload",baidu.event._unload)}else{window.addEventListener("unload",baidu.event._unload,false)}baidu.event._listeners=baidu.event._listeners||[];baidu.event.un=function(c,d,f){if("string"==typeof c){c=baidu.dom.g(c)}d=d.replace(/^on/i,"");var b=baidu.event._listeners,a=b.length,g=!f,e;while(a--){e=b[a];if(e[1]===d&&e[0]===c&&(g||e[2]===f)){if(c.detachEvent){c.detachEvent("on"+d,e[3])}else{if(c.removeEventListener){c.removeEventListener(d,e[3],false)}}b.splice(a,1)}}return c};baidu.un=baidu.event.un;baidu.array=baidu.array||{};baidu.string=baidu.string||{};baidu.string.trim=function(a){return String(a).replace(new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+\x24)","g"),"")};baidu.trim=baidu.string.trim;baidu.object=baidu.object||{};baidu.object.extend=function(c,a){for(var b in a){if(a.hasOwnProperty(b)){c[b]=a[b]}}};baidu.extend=baidu.object.extend;baidu.event.on=function(b,d,e){d=d.replace(/^on/i,"");if("string"==typeof b){b=baidu.dom.g(b)}var c=function(f){e.call(b,f)},a=baidu.event._listeners;a[a.length]=[b,d,e,c];if(b.attachEvent){b.attachEvent("on"+d,c)}else{if(b.addEventListener){b.addEventListener(d,c,false)}}return b};baidu.on=baidu.event.on;baidu.lang=baidu.lang||{};baidu.lang._instances=baidu.lang._instances||{};baidu.lang.instance=function(a){return baidu.lang._instances[a]||null};baidu.lang.inherits=function(g,e,d){var c,f,a=g.prototype,b=new Function();b.prototype=e.prototype;f=g.prototype=new b();for(c in a){f[c]=a[c]}g.prototype.constructor=g;g.superClass=e.prototype;if("string"==typeof d){f._className=d}};baidu.inherits=baidu.lang.inherits;baidu.dom=baidu.dom||{};baidu.dom.g=function(a){if("string"==typeof a||a instanceof String){return document.getElementById(a)}else{if(a&&a.nodeName&&(a.nodeType==1||a.nodeType==9)){return a}}return null};baidu.g=baidu.G=baidu.dom.g;baidu.lang._insCounter=baidu.lang._insCounter||1;baidu.lang.Class=function(a){this.guid=a||baidu.lang.Class.guid();baidu.lang._instances[this.guid]=this};baidu.lang.Class.guid=function(){return"TANGRAM__"+(baidu.lang._insCounter++).toString(36)};baidu.lang.Class.create=function(b){var d=new baidu.lang.Class();for(var a in b){d[a]=b[a]}return d};baidu.lang.Class.prototype.dispose=function(){if(this.guid){delete baidu.lang._instances[this.guid]}for(var a in this){if(typeof this[a]!="function"){delete this[a]}}};baidu.lang.Class.prototype.toString=function(){return this._className||"Object"};var CITY_TYPE_PROV=1;var CITY_TYPE_CITY=2;var CITY_TYPE_DIST=3;var RED_ICON_SIZE=new BMap.Size(23,25);var RED_ICON_OFFSET=new BMap.Size(9,25);var RED_ICON_INFOWND_OFFSET=new BMap.Size(9,0);function addSearchPoi(map,point,index,title,coordType){var pt=getPoiPoint(point,map.config.coordType,coordType);if(!pt){return}if(index<0||index>9){return}var ico=new BMap.Icon(API_URL+"img/markers.png",RED_ICON_SIZE,{offset:RED_ICON_OFFSET,imageOffset:new BMap.Size(0,-25*index),infoWindowOffset:RED_ICON_INFOWND_OFFSET});var mkr=new BMap.Marker(pt,{icon:ico});map.addOverlay(mkr);if(title){mkr.setTitle(title)}return mkr}function addCenterPoi(map,point,title,coordType){var pt=getPoiPoint(point,map.config.coordType,coordType);if(!pt){return}var ico=new BMap.Icon(API_URL+"img/markers.png",RED_ICON_SIZE,{offset:RED_ICON_OFFSET,imageOffset:new BMap.Size(0,-250),infoWindowOffset:RED_ICON_INFOWND_OFFSET});var mkr=new BMap.Marker(pt,{icon:ico});map.addOverlay(mkr);if(title){mkr.setTitle(title)}return mkr}function addSearchInBoundsPoi(map,point,title,coordType){var pt=getPoiPoint(point,map.config.coordType,coordType);if(!pt){return}var ico=new BMap.Icon(API_URL+"img/markers.png",RED_ICON_SIZE,{offset:RED_ICON_OFFSET,imageOffset:new BMap.Size(0,-300),infoWindowOffset:RED_ICON_INFOWND_OFFSET});var mkr=new BMap.Marker(pt,{icon:ico});map.addOverlay(mkr);if(title){mkr.setTitle(title)}return mkr}function getPoiPoint(point,mapCoordType,searchCoordType){var pts=[];var pt=null;if(point&&point.toString()=="Point"){pt=point}else{if(typeof point=="string"){pts=baidu.trim(point).split(",");if(pts.length<2){return}pts[0]=parseFloat(baidu.trim(pts[0]));pts[1]=parseFloat(baidu.trim(pts[1]))}else{pts=point.slice(0);if(pts.length<2){return}}pt=new BMap.Point(pts[0],pts[1])}pt=convertCoord(pt,searchCoordType,mapCoordType);return pt}window.BMAP_POI_TYPE_NORMAL=0;window.BMAP_POI_TYPE_BUSSTOP=1;window.BMAP_POI_TYPE_BUSLINE=2;window.BMAP_POI_TYPE_SUBSTOP=3;window.BMAP_POI_TYPE_SUBLINE=4;function createSearchInfoWnd(contents,opts){var title=contents.title;var addr=contents.addr;var tel=contents.tel;var uid=contents.uid||"";var url=contents.url;var poiType=contents.poiType||BMAP_POI_TYPE_NORMAL;opts=opts||{};if(!title){return null}var ntitle=title;if(poiType==BMAP_POI_TYPE_BUSSTOP){ntitle=ntitle+"-\u516c\u4ea4\u8f66\u7ad9"}else{if(poiType==BMAP_POI_TYPE_SUBSTOP){ntitle=ntitle+"-\u5730\u94c1\u7ad9"}}if(ntitle.replace(/[\u0100-\uffff]/g,"##").length>27){ntitle=ntitle.substring(0,13)+"&#8230"}var thtml="<p style='width:210px;font-family:arial,simsun,sans-serif;line-height:16px;margin:0;font-size:14px;color:#cc5522;font-weight:bold;white-space:nowrap;overflow:hidden' title='"+title+"'>"+ntitle+"</p>";var htmls=[];htmls.push("<div style='font:12px arial,sans-serif;margin-top:10px'>");if(addr){var addrTitle="\u5730\u5740\uff1a";if(poiType==BMAP_POI_TYPE_BUSSTOP||poiType==BMAP_POI_TYPE_SUBSTOP){addrTitle="\u8f66\u6b21\uff1a"}htmls.push('<table cellspacing="0" style="table-layout:fixed;width:100%;font:12px arial,simsun,sans-serif" >');htmls.push('<tr><td style="vertical-align:top;width:38px;white-space:nowrap;word-break:keep-all">'+addrTitle+'&nbsp;</td><td style="line-height:16px">');htmls.push(addr+"&nbsp;</td></tr>");if(tel){htmls.push("<tr><td>\u7535\u8bdd\uff1a</td><td>"+tel+"</td></tr>")}htmls.push("</table>")}else{if(tel){htmls.push('<table cellspacing="0" style="table-layout:fixed;width:100%;font:12px arial,simsun,sans-serif">');htmls.push('<tr><td style="vertical-align:top;width:36px;white-space:nowrap;word-break:keep-all">\u7535\u8bdd\uff1a</td><td>'+tel+"</td></tr></table>")}}htmls.push("</div>");var iw=new BMap.InfoWindow(htmls.join(""),{title:thtml,height:0,width:230,margin:[10,10,20,10]});return iw}var DEST_START=0;var DEST_END=1;function addDestPoi(map,point,title,type,coordType){var pt=getPoiPoint(point,map.config.coordType,coordType);if(!pt){return}var ico=new BMap.Icon(API_URL+"img/dest_markers.png",new BMap.Size(42,34),{offset:new BMap.Size(14,32),imageOffset:new BMap.Size(0,-34*type),infoWindowOffset:new BMap.Size(14,0)});var mkr=new BMap.Marker(pt,{icon:ico,baseZIndex:3500000});map.addOverlay(mkr);if(title){mkr.setTitle(title)}return mkr}var ROUTE_TYPE_DEFAULT=0;var ROUTE_TYPE_TRANSIT=1;function addLine(map,points,coordType){return addRoute(map,points,ROUTE_TYPE_TRANSIT,coordType)}function addRoute(map,points,type,coordType){var config=[{stroke:6,color:"#0030ff",opacity:0.45,style:"solid"},{stroke:6,color:"#0030ff",opacity:0.45,style:"solid"},{stroke:4,color:"#30a208",opacity:0.55,style:"dashed"},{stroke:5,color:"#0030ff",opacity:0.45,style:"solid"}];if(typeof type=="undefined"){type=0}if(!config[type]){return}var realPoints=[];var conf=config[type];if(map.config.coordType!=coordType){for(var i=0,l=points.length;i<l;i++){realPoints.push(convertCoord(points[i],coordType,map.config.coordType))}}else{realPoints=points}var p=new BMap.Polyline(realPoints,{strokeWeight:conf.stroke,strokeColor:conf.color,strokeOpacity:conf.opacity,strokeStyle:conf.style});map.addOverlay(p);p._routeType=type;if(type==ROUTE_TYPE_TRANSIT){var p2=new BMap.Polyline(realPoints,{strokeWeight:conf.stroke-2,strokeColor:"#fff",strokeOpacity:0.3});p._p=p2;map.addOverlay(p2)}return p}var TRANS_INFO_WND_TRANSIT=0;var TRANS_INFO_WND_DRIVING=1;var TRANS_INFO_WND_WALKING=2;function createTransInfoWnd(contents){var content=contents.content;var curIndex=contents.curIndex;var total=contents.total;var nextTransCbk=contents.nextTransCbk;var obj=contents.obj;var type=contents.type||TRANS_INFO_WND_TRANSIT;var htmls=["<div style='font:12px arial,simsun,sans-serif'>"];if(content){htmls.push("<div style='margin:0 1em 24px 0'>"+content+"</div>")}htmls.push('<table width="99%" cols="2" style="background:#eaf2ff;font:12px arial,simsun,sans-serif"><tbody><tr>');htmls.push('<td nowrap="nowrap" width="50%" align="left">');if(curIndex==0){htmls.push('<span unselectable="on" style="color:#9c9d99;-moz-user-select:none" >\u4e0a\u4e00\u6b65</span>')}else{htmls.push('<a id="trans_prev" style="color:#7777cc;-moz-user-select:none" href="javascript:void(0)">\u4e0a\u4e00\u6b65</a>')}htmls.push("</td>");htmls.push('<td nowrap="nowrap" width="50%" align="right">');if(curIndex==total+1){htmls.push('<span unselectable="on" style="color:#9c9d99;-moz-user-select:none" >\u4e0b\u4e00\u6b65</span>')}else{htmls.push('<a style="color:#7777cc" id="trans_next" href="javascript:void(0)">\u4e0b\u4e00\u6b65</a>')}htmls.push("</td></tr></tbody></table>");var iw=new BMap.InfoWindow(htmls.join(""),{title:"",height:0,width:220,margin:[10,10,20,10]});iw.addEventListener("open",function(){if(baidu.G("trans_prev")){baidu.on(baidu.G("trans_prev"),"click",function(){if(nextTransCbk&&typeof nextTransCbk=="function"){nextTransCbk(curIndex-1,obj)}})}if(baidu.G("trans_next")){baidu.on(baidu.G("trans_next"),"click",function(){if(nextTransCbk&&typeof nextTransCbk=="function"){nextTransCbk(curIndex+1,obj)}})}});return iw}function addTransPoi(map,point,type,title,coordType){var pt=getPoiPoint(point,map.config.coordType,coordType);if(!pt){return}type=type||BMAP_LINE_TYPE_BUS;var offsetY=-55;if(type==BMAP_LINE_TYPE_SUBWAY){offsetY=-76}var ico=new BMap.Icon(API_URL+"img/trans_icons.png",new BMap.Size(21,21),{imageOffset:new BMap.Size(0,offsetY),infoWindowOffset:new BMap.Size(10,0)});var mkr=new BMap.Marker(pt,{icon:ico});map.addOverlay(mkr);if(title){mkr.setTitle(title)}return mkr}function getInfoWindowDom(map){if(map&&map.infoWindowDoms&&map.infoWindowDoms.contentDiv){return map.infoWindowDoms.contentDiv.childNodes[0]}return null}var DataMgr={RawDispatcher:{},REQ_BASE_URL:"http://api.map.baidu.com/",request:function(cbk,params,userData,path){var timeStamp=(Math.random()*100000).toFixed(0);DataMgr.RawDispatcher["_cbk"+timeStamp]=function(json){userData=userData||{};cbk&&cbk(json,userData);delete DataMgr.RawDispatcher["_cbk"+timeStamp]};path=path||"";var reqParam=jsonToQuery(params,encodeURIComponent),me=this,key=window._key||"",script=create("script",{src:me.REQ_BASE_URL+path+"?"+reqParam+"&key="+key+"&ie=utf-8&oue=1&res=api&callback=BMap.DataMgr.RawDispatcher._cbk"+timeStamp});if(script.addEventListener){script.addEventListener("load",function(){script.parentNode.removeChild(script)},false)}else{if(script.attachEvent){script.attachEvent("onreadystatechange",function(e){var t=window.event.srcElement;if(t&&t.readyState=="loaded"){script.parentNode.removeChild(script)}})}}setTimeout(function(){document.getElementsByTagName("head")[0].appendChild(script)},1)}};mg("DataMgr",DataMgr);function BaseSearch(loc,opts){baidu.lang.Class.call(this);this._loc={};this.setLocation(loc);this._opts={coordType:BMAP_COORD_LNGLAT,renderOptions:{panel:null,map:null,autoViewport:true},onSearchComplete:function(){},onMarkersSet:function(){},onInfoHtmlSet:function(){},onResultsHtmlSet:function(){}};baidu.extend(this._opts,opts);this._opts.renderOptions.autoViewport=!!this._opts.renderOptions.autoViewport;this._opts.renderOptions.panel=baidu.G(this._opts.renderOptions.panel);this._setCoordType(this._opts.coordType)}baidu.inherits(BaseSearch,baidu.lang.Class);BaseSearch.CBK_SEARCH_COMPLETE=1;BaseSearch.CBK_MARKERS_SET=2;BaseSearch.CBK_INFO_HTML_SET=3;BaseSearch.CBK_POLYLINES_SET=4;BaseSearch.CBK_RESULTS_HTML_SET=5;BaseSearch._getPoiUrl=function(uid,ccode){if(uid){return MAP_URL+"?s="+encodeURIComponent("inf&uid="+uid+"&c="+ccode)+"&i=0&sr=1"}return""};BaseSearch._getLocType=function(loc){if(!loc){return LOC_TYPE_UNKNOWN}if(typeof loc=="string"){return LOC_TYPE_STRING}else{if(loc.constructor==BMap.Point){return LOC_TYPE_POINT}else{if(loc.constructor==BMap.Map){return LOC_TYPE_MAP}}}return LOC_TYPE_UNKNOWN};baidu.extend(BaseSearch.prototype,{getCoordType:function(){return this._opts.coordType},getResults:function(){return this._results},enableAutoViewport:function(){this._opts.renderOptions.autoViewport=true},disableAutoViewport:function(){this._opts.renderOptions.autoViewport=false},setLocation:function(loc){if(!loc){return}this._loc.src=loc},_getIdByLoc:function(loc,cbk){var locType=BaseSearch._getLocType(loc.src);if(locType==LOC_TYPE_UNKNOWN){return}var me=this;if(locType==LOC_TYPE_STRING){if(loc.curLocType==locType&&loc.curSrc==loc.src&&loc.curId){cbk&&cbk(loc.curId);return}loc.curLocType=locType;loc.curSrc=loc.src;DataMgr.request(function(json){if(json&&json.result&&json.result.type==RETURN_TYPE_CURRENT_CITY){me._loc.curId=json.content.code;cbk&&cbk(me._loc.curId)}},{qt:QUERY_TYPE_CURRENT_CITY,wd:loc.src})}else{var pt;var level=18;if(locType==LOC_TYPE_MAP){pt=loc.src.getCenter();level=loc.src.getZoom()}else{pt=loc.src}if(locType==loc.curLocType&&loc.curSrc.equals(pt)&&loc.curId){cbk&&cbk(loc.curId);return}if(locType==LOC_TYPE_MAP&&loc.src.config.coordType==BMAP_COORD_LNGLAT){pt=BMap.Projection.convertLL2MC(pt)}if(locType==LOC_TYPE_POINT&&this._opts.coordType==BMAP_COORD_LNGLAT){pt=BMap.Projection.convertLL2MC(pt)}loc.curLocType=locType;loc.curSrc=new BMap.Point(pt.lng,pt.lat);DataMgr.request(function(json){if(json&&json.result&&json.result.type==RETURN_TYPE_CENTER){me._loc.curId=json.content.uid;cbk&&cbk(me._loc.curId)}},{qt:QUERY_TYPE_CENTER,b:pt.lng+","+pt.lat+";"+pt.lng+","+pt.lat,l:level})}},setSearchCompleteCallback:function(cbk){this._opts.onSearchComplete=cbk||function(){}},setMarkersSetCallback:function(cbk){this._opts.onMarkersSet=cbk||function(){}},setInfoHtmlSetCallback:function(cbk){this._opts.onInfoHtmlSet=cbk||function(){}},setResultsHtmlSetCallback:function(cbk){this._opts.onResultsHtmlSet=cbk||function(){}},getStatus:function(){return this._status},_setStatus:function(code){if(typeof code=="number"){this._status=code}else{delete this._status}},_setCoordType:function(type){if(type===BMAP_COORD_LNGLAT||type===BMAP_COORD_MERCATOR){this._opts.coordType=type}else{this._opts.coordType=BMAP_COORD_LNGLAT}},_triggerCbk:function(cbkCode,d0,d1){var cbk;switch(cbkCode){case BaseSearch.CBK_SEARCH_COMPLETE:cbk=this._opts.onSearchComplete;break;case BaseSearch.CBK_MARKERS_SET:cbk=this._opts.onMarkersSet;break;case BaseSearch.CBK_POLYLINES_SET:cbk=this._opts.onPolylinesSet;break;case BaseSearch.CBK_INFO_HTML_SET:cbk=this._opts.onInfoHtmlSet;break;case BaseSearch.CBK_RESULTS_HTML_SET:cbk=this._opts.onResultsHtmlSet;break;default:break}cbk&&cbk(d0,d1)}});var LocalSearch=function(loc,opts){BaseSearch.call(this,loc,opts);opts=opts||{};opts.renderOptions=opts.renderOptions||{};this.setPageCapacity(opts.pageCapacity);if(typeof opts.renderOptions.selectFirstResult!="undefined"&&!opts.renderOptions.selectFirstResult){this.disableFirstResultSelection()}else{this.enableFirstResultSelection()}this._overlays=[];this._curIndex=-1};baidu.inherits(LocalSearch,BaseSearch,"LocalSearch");LocalSearch.DEFAULT_PAGE_CAPACITY=10;LocalSearch.MIN_PAGE_CAPACITY=1;LocalSearch.MAX_PAGE_CAPACITY=50;LocalSearch.DEFAULT_RADIUS=2000;LocalSearch.MAX_RADIUS=5000;LocalSearch.isReqDataMap=function(qt,type){if(!qt||typeof type=="undefined"){return false}if(qt==QUERY_TYPE_POI_SEARCH&&type!=RETURN_TYPE_POI_SEARCH&&type!=RETURN_TYPE_CITY_LIST&&type!=RETURN_TYPE_CURRENT_CITY&&type!=RETURN_TYPE_SPECIAL_REGION&&type!=RETURN_TYPE_NODATA_REGION){return false}if(qt==QUERY_TYPE_SEARCH_NEARBY&&type!=RETURN_TYPE_SEARCH_NEARBY){return false}if(qt==QUERY_TYPE_SEARCH_INBOUNDS&&type!=RETURN_TYPE_SEARCH_INBOUNDS){return false}return true};baidu.extend(LocalSearch.prototype,{search:function(keyword){if(!keyword){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(BaseSearch.CBK_SEARCH_COMPLETE);return}var opts=arguments[1]||{};var me=this;this._getIdByLoc(this._loc,function(id){id=id||1;var _opts={qt:QUERY_TYPE_POI_SEARCH,c:id,wd:keyword,rn:me.getPageCapacity(QUERY_TYPE_POI_SEARCH)};baidu.extend(_opts,opts.params);var ud={params:_opts,userKw:opts.userKw||keyword};baidu.extend(ud,opts);DataMgr.request(function(json,userData){me._rawDataCbk(json,userData)},_opts,ud)})},searchInBounds:function(keyword,bounds){if(!keyword||!bounds){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(BaseSearch.CBK_SEARCH_COMPLETE);return}var me=this;var opts=arguments[2]||{};this._getIdByLoc(this._loc,function(id){id=id||1;var pt1=new BMap.Point(bounds.minX,bounds.minY);var pt2=new BMap.Point(bounds.maxX,bounds.maxY);if(me._opts.coordType==BMAP_COORD_LNGLAT){pt1=BMap.Projection.convertLL2MC(pt1);pt2=BMap.Projection.convertLL2MC(pt2)}var bdstr="("+pt1.lng+","+pt1.lat+";"+pt2.lng+","+pt2.lat+")";var _opts={qt:QUERY_TYPE_SEARCH_INBOUNDS,c:id,wd:keyword,ar:bdstr,rn:me._opts.pageCapacity,l:18};baidu.extend(_opts,opts.params);var ud;if(opts&&opts.center&&opts.radius){ud={params:_opts,bounds:bounds,center:opts.center,radius:opts.radius,userKw:opts.userKw||keyword}}else{ud={params:_opts,bounds:bounds,userKw:opts.userKw||keyword}}DataMgr.request(function(json,userData){me._rawDataCbk(json,userData)},_opts,ud)})},searchNearby:function(keyword,center,radius){if(!keyword||!center||!(center instanceof BMap.Point)&&typeof center=="object"&&!center.uid){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(BaseSearch.CBK_SEARCH_COMPLETE);return}radius=radius||LocalSearch.DEFAULT_RADIUS;radius=radius<1?1:(radius>LocalSearch.MAX_RADIUS?LocalSearch.MAX_RADIUS:radius);var me=this;var opts=arguments[3]||{};if(center&&center instanceof BMap.Point){var prjCenter;if(me._opts.coordType==BMAP_COORD_LNGLAT){prjCenter=BMap.Projection.convertLL2MC(center)}else{prjCenter=center}var prjPt1=new BMap.Point(prjCenter.lng-radius,prjCenter.lat-radius);var prjPt2=new BMap.Point(prjCenter.lng+radius,prjCenter.lat+radius);var pt1,pt2;if(me._opts.coordType==BMAP_COORD_LNGLAT){pt1=BMap.Projection.convertMC2LL(prjPt1);pt2=BMap.Projection.convertMC2LL(prjPt2)}else{pt1=prjPt1;pt2=prjPt2}var bounds=new BMap.Bounds(pt1.lng,pt1.lat,pt2.lng,pt2.lat);opts.center=center;opts.radius=radius;this.searchInBounds(keyword,bounds,opts);return}this._getIdByLoc(this._loc,function(id){id=id||1;var _opts={qt:QUERY_TYPE_SEARCH_NEARBY,c:id,wd:keyword,rn:me.getPageCapacity(QUERY_TYPE_SEARCH_NEARBY),uid:center.uid,r:radius};if(typeof center=="string"){_opts.qt=QUERY_TYPE_POI_SEARCH;_opts.wd=center+" "+keyword;delete _opts.r;delete _opts.uid}baidu.extend(_opts,opts.params);DataMgr.request(function(json,userData){me._rawDataCbk(json,userData)},_opts,{params:_opts,center:center,radius:radius,userKw:opts.userKw||keyword})})},_rawDataCbk:function(json,userData){var me=this;this.clearResults();me._json=json;this._ud=userData;var r=json.result;var qt=userData.params.qt;if(r.error!=0||!LocalSearch.isReqDataMap(qt,r.type)){var cc=json.current_city;this._results=new LocalResult({keyword:userData.userKw,city:cc.name,ccode:cc.code,pc:me.getPageCapacity(userData.params.qt),center:userData.center,radius:userData.radius,bounds:((userData.center&&userData.radius)?undefined:userData.bounds),moreUrl:this._getMoreUrl(userData,cc)});this._results._qt=userData.params.qt;this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION);this._triggerCbk(BaseSearch.CBK_SEARCH_COMPLETE,this._results);this._renderList();return}me._processRaw(userData);me._renderMap();me._renderList();if(this._opts.renderOptions.selectFirstResult&&this._results&&this._results.getNumPois()>0){var me=this;setTimeout(function(){me._select(0)},240)}},_processRaw:function(userData){var r=this._json.result,c=this._json.content,cc=this._json.current_city,type=r.type,me=this,pageNum=r.page_num||0,total=0,count=0,results=[],points=[],cityList=[],count,total;if(type!=RETURN_TYPE_CITY_LIST&&type!=RETURN_TYPE_SPECIAL_REGION){count=r.count-(pageNum==0?(r.spec_dispnum||0):0);total=r.total<760?r.total:760;var start=pageNum==0?(r.spec_dispnum||0):0;if(type!=RETURN_TYPE_CURRENT_CITY){for(var i=start;i<r.count;i++){if(c&&c[i]){var cur=c[i];var addr=this._formatAddr(cur.addr,cur.poiType);var poi={title:cur.name,uid:cur.uid,point:parseGeo(cur.geo,true,me._opts.coordType).point,url:BaseSearch._getPoiUrl(cur.uid,cc.code),address:addr,city:cc.name,phoneNumber:cur.tel,postcode:cur.zip,type:cur.poiType||BMAP_POI_TYPE_NORMAL};results.push(poi);points.push(poi.point)}}}else{count=total=1;var poi={title:c.cname,uid:c.uid,point:parseGeo(c.geo,true,me._opts.coordType).point,address:c.cname,url:MAP_URL+"?s="+encodeURIComponent("s&wd="+r.wd)};results.push(poi);points.push(poi.point)}}else{if(type==RETURN_TYPE_SPECIAL_REGION){count=total=1;var poi={title:r.wd,point:parseGeoStr(c[0],me._opts.coordType),url:MAP_URL+"?s="+encodeURIComponent("s&wd="+r.wd)};results.push(poi);points.push(poi.point)}if(type==RETURN_TYPE_CITY_LIST){count=total=0;for(var i=0;i<c.length;i++){cityList.push({city:c[i].name,_code:c[i].code,numResults:c[i].num})}if(this._json.more_city){var mc=this._json.more_city;for(var i=0,l=mc.length;i<l;i++){for(var j=0,ll=mc[i].city.length;j<ll;j++){var c=mc[i].city[j];cityList.push({city:c.name,_code:c.code,numResults:c.num})}}}}}this._results=new LocalResult({keyword:userData.userKw,count:count,total:total,pageIdx:r.page_num,city:cc.name,ccode:cc.code,pois:results,cityList:cityList,pc:me.getPageCapacity(userData.params.qt),center:userData.center,radius:userData.radius,bounds:((userData.center&&userData.radius)?undefined:userData.bounds),moreUrl:this._getMoreUrl(userData,cc)});this._results._qt=userData.params.qt;if(total==0&&type!=RETURN_TYPE_CITY_LIST){this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION)}else{if(type!=RETURN_TYPE_CITY_LIST){this._setStatus(BMAP_STATUS_SUCCESS)}else{this._setStatus(BMAP_STATUS_CITY_LIST)}}this._triggerCbk(BaseSearch.CBK_SEARCH_COMPLETE,this._results)},_getMoreUrl:function(userData,cc){var retStr="";var keyword=typeof userData.center=="string"?(userData.center+" "+userData.userKw):userData.userKw;var qt="s",extra="",para="";if(typeof userData.center=="object"&&!(userData.center instanceof BMap.Point)){qt="nb";var pt=userData.center.point;if(this._opts.coordType==BMAP_COORD_LNGLAT){pt=BMap.Projection.convertLL2MC(pt)}extra=encodeURIComponent("&uid="+userData.center.uid+"&r="+userData.radius)+"&l=13&c="+pt.lng+","+pt.lat}if(userData.bounds&&!userData.center){qt="bd";var pt=userData.bounds.getCenter();if(this._opts.coordType==BMAP_COORD_LNGLAT){pt=BMap.Projection.convertLL2MC(pt)}para="&c="+pt.lng+","+pt.lat+"&l=13"}if(userData.center&&userData.center instanceof BMap.Point){var pt=userData.center;if(this._opts.coordType==BMAP_COORD_LNGLAT){pt=BMap.Projection.convertLL2MC(pt)}para="&c="+pt.lng+","+pt.lat+"&l=13";var r=userData.radius;qt="tpl:PoiSearch?nb&ar=("+(pt.lng-r)+","+(pt.lat-r)+";"+(pt.lng+r)+","+(pt.lat+r)+")"}retStr=MAP_URL+"?sr=1"+para+"&s="+encodeURIComponent(qt+"&wd="+keyword+"&c="+cc.code)+extra;return retStr},_formatAddr:function(addr,poiType){poiType=poiType||BMAP_POI_TYPE_NORMAL;if(poiType==BMAP_POI_TYPE_BUSSTOP||poiType==BMAP_POI_TYPE_SUBSTOP){return unique(addr.split(";")).join("; ")}return addr},_renderMap:function(){if(this._opts.renderOptions.map&&this._results&&this._results.getCurrentNumPois()>0){var me=this,map=this._opts.renderOptions.map,points=[];for(var i=0;i<this._results.getCurrentNumPois();i++){var cur=this._results.getPoi(i);points.push(cur.point);var mkr=this._addPoi(cur.point,i,cur.title);if(!mkr){continue}cur.marker=mkr;(function(){var index=i;mkr.addEventListener("click",function(){me._select(index)})})();this._overlays.push(mkr)}var center=this._results.center;if(center&&typeof center!="string"&&!(center instanceof BMap.Point)){var ctr=this._centerMkr=addCenterPoi(map,center.point,center.title,this._opts.coordType);ctr.addEventListener("click",function(){me._select(-1);me._curIndex="c";var iw=createSearchInfoWnd({title:center.title,addr:center.address,tel:center.phoneNumber,url:center.url,poiType:center.type});iw.addEventListener("open",function(){me._triggerCbk(BaseSearch.CBK_INFO_HTML_SET,center,getInfoWindowDom(map))});ctr.openInfoWindow(iw)})}var type=this._json.result&&this._json.result.type;var viewData={};switch(type){case RETURN_TYPE_POI_SEARCH:case RETURN_TYPE_SEARCH_NEARBY:case RETURN_TYPE_SEARCH_INBOUNDS:viewData.points=points;break;case RETURN_TYPE_CURRENT_CITY:viewData.center=this._results.getPoi(0).point;viewData.level=this._json.content.level;break;case RETURN_TYPE_NODATA_REGION:viewData.center=this._results.getPoi(0).point;viewData.level=13;break;case RETURN_TYPE_SPECIAL_REGION:viewData.center=this._results.getPoi(0).point;viewData.level=parseInt(this._json.content[1]);break;default:break}this._getBestViewport(viewData);this._triggerCbk(BaseSearch.CBK_MARKERS_SET,this._results._pois)}},_addPoi:function(pt,i,title){if(this._results.getCurrentNumPois()<=LocalSearch.DEFAULT_PAGE_CAPACITY){return addSearchPoi(this._opts.renderOptions.map,pt,i,title,this._opts.coordType)}else{return addSearchInBoundsPoi(this._opts.renderOptions.map,pt,title,this._opts.coordType)}},_select:function(index){var preIndex=this._curIndex,map=this._opts.renderOptions.map,panel=this._opts.renderOptions.panel;if(map&&index>-1&&this._overlays[index]){var mkr=this._overlays[index];map.closeInfoWindow();var cur=this._results.getPoi(index);var iw=createSearchInfoWnd({title:cur.title,addr:cur.address,tel:cur.phoneNumber,url:cur.url,poiType:cur.type});var me=this;iw.addEventListener("close",function(){if(panel){if(typeof me._curIndex=="number"&&me._curIndex!=-1&&panel.getElementsByTagName("li")[me._curIndex]){panel.getElementsByTagName("li")[me._curIndex].style.backgroundColor=""}}me._curIndex=-1});iw.addEventListener("open",function(){me._triggerCbk(BaseSearch.CBK_INFO_HTML_SET,cur,getInfoWindowDom(map))});mkr.openInfoWindow(iw)}if(panel){if(typeof preIndex=="number"&&preIndex!=-1&&panel.getElementsByTagName("li")[preIndex]){panel.getElementsByTagName("li")[preIndex].style.backgroundColor=""}if(typeof index=="number"&&index!=-1&&panel.getElementsByTagName("li")[index]){panel.getElementsByTagName("li")[index].style.backgroundColor="#f0f0f0"}}this._curIndex=index},_clearOverlays:function(){for(var i=0,l=this._overlays.length;i<l;i++){this._overlays[i].remove();this._overlays[i].dispose();this._overlays[i]=null}this._overlays.length=0;if(this._centerMkr){this._centerMkr.remove();this._centerMkr.dispose();this._centerMkr=null}},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._results){var container=create("div",{style:"font-family:arial,sans-serif;border:1px solid #999;font-size:12px"});var status=this.getStatus();var resultsContainer=create("div",{style:"background:#fff"});var resultsList=create("ol",{style:"list-style:none;padding:0;margin:0"});if(status==BMAP_STATUS_SUCCESS){for(var i=0,l=this._results.getCurrentNumPois();i<l;i++){var item=this._createItem(i);resultsList.appendChild(item)}}if(status==BMAP_STATUS_CITY_LIST){for(var i=0,l=Math.min(6,this._results.getCityList().length);i<l;i++){var item=this._createCityItem(i);resultsList.appendChild(item)}}if(status==BMAP_STATUS_UNKNOWN_LOCATION){var item=create("li",{style:"margin:2px 0;padding:0 5px 0 3px;overflow:hidden;line-height:17px"});item.innerHTML="\u62b1\u6b49\uff0c\u672a\u627e\u5230\u76f8\u5173\u5730\u70b9\u3002";resultsList.appendChild(item)}resultsContainer.appendChild(resultsList);container.appendChild(resultsContainer);var me=this;var resultsControl=create("div",{style:"white-space:nowrap;text-align:right;background:#e5ecf9;margin-top:5px;padding:2px"});var moreUrl=create("a",{style:"color:#7777cc",href:this._results.moreResultsUrl,target:"_blank",title:"\u5230\u767e\u5ea6\u5730\u56fe\u67e5\u770b\u66f4\u591a\u7ed3\u679c"});moreUrl.innerHTML="\u66f4\u591a\u7ed3\u679c&#187;";var paging=create("div",{style:"float:left;margin-right:5px"});if(this._results.getNumPages()>1){var pg=new Page(paging,function(page){me.gotoPage(page-1)},{pageCount:me._results.getNumPages(),page:me._results.getPageIndex()+1,update:false})}resultsControl.appendChild(paging);resultsControl.appendChild(moreUrl);container.appendChild(resultsControl);this._opts.renderOptions.panel.appendChild(container);this._triggerCbk(BaseSearch.CBK_RESULTS_HTML_SET,container)}},_createItem:function(index){var r=this._results;if(!r||!r.getPoi(index)){return}var cur=r.getPoi(index);var kw=this._results.keyword;var item=create("li",{style:"margin:2px 0;padding:0 5px 0 3px;cursor:pointer;overflow:hidden;line-height:17px"});if(this._curIndex>-1&&index==this._curIndex){item.style.backgroundColor="#f0f0f0"}var offsetY=index==0?index+2+"px":"-"+(index*20-2)+"px";if(this._results.getCurrentNumPois()>LocalSearch.DEFAULT_PAGE_CAPACITY){offsetY="-218px"}var htmls=["<span style='background:url("+API_URL+"bmap/red_labels.gif) 0 "+offsetY+" no-repeat;padding-left:10px;margin-right:3px'>&nbsp;</span>"];var regex=new RegExp(kw,"ig");var title=cur.title.replace(regex,"<b>$&</b>");if(cur.type==BMAP_POI_TYPE_BUSSTOP){title+="-\u516c\u4ea4\u8f66\u7ad9"}else{if(cur.type==BMAP_POI_TYPE_SUBSTOP){title+="-\u5730\u94c1\u7ad9"}}htmls.push("<span style='color:#00c;text-decoration:underline'>"+title+"</span>");if(cur.address){htmls.push("<span style='color:#666;'> - "+cur.address.replace(regex,"<b>$&</b>")+"</span>")}item.innerHTML=htmls.join("");var me=this;item.onclick=function(){me._select(index)};return item},_createCityItem:function(index){var item=create("li",{style:"margin:2px 0;padding:0 5px 0 3px;cursor:pointer;overflow:hidden;line-height:17px"});item._index=index;var clist=this._results.getCityList();item.innerHTML="<span style='color:#00c;text-decoration:underline'>"+clist[index].city+"</span> <span style='color:#666'>(\u5171"+clist[index].numResults+"\u6761\u7ed3\u679c)</span>";var me=this;item.onclick=function(){me.setLocation(me._results.getCityList()[index].city);me.search(me._results.keyword)};return item},clearResults:function(){delete this._json;delete this._status;delete this._results;delete this._ud;this._curIndex=-1;this._setStatus();this._clearOverlays();if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.innerHTML=""}},gotoPage:function(pageNum){if(this._ud){if(typeof pageNum=="number"&&!isNaN(pageNum)&&pageNum>=0&&pageNum<=this._results.getNumPages()-1){this._ud.params.pn=pageNum;var qt=this._ud.params.qt;switch(qt){case QUERY_TYPE_POI_SEARCH:this.search(this._ud.params.wd,this._ud);break;case QUERY_TYPE_SEARCH_INBOUNDS:this.searchInBounds(this._ud.params.wd,this._ud.bounds,this._ud);break;case QUERY_TYPE_SEARCH_NEARBY:this.searchNearby(this._ud.params.wd,this._ud.center,this._ud.radius,this._ud);break;default:break}}else{this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(BaseSearch.CBK_SEARCH_COMPLETE)}}},enableFirstResultSelection:function(){this._opts.renderOptions.selectFirstResult=true},disableFirstResultSelection:function(){this._opts.renderOptions.selectFirstResult=false},setPageCapacity:function(cap){if(typeof cap=="number"&&!isNaN(cap)){this._opts.pageCapacity=cap<1?LocalSearch.DEFAULT_PAGE_CAPACITY:(cap>LocalSearch.MAX_PAGE_CAPACITY?LocalSearch.DEFAULT_PAGE_CAPACITY:cap)}else{this._opts.pageCapacity=LocalSearch.DEFAULT_PAGE_CAPACITY}},getPageCapacity:function(){if(!arguments[0]){return this._opts.pageCapacity}if(arguments[0]!=QUERY_TYPE_SEARCH_INBOUNDS){if(this._opts.pageCapacity<=LocalSearch.DEFAULT_PAGE_CAPACITY){return this._opts.pageCapacity}else{return LocalSearch.DEFAULT_PAGE_CAPACITY}}else{return this._opts.pageCapacity}},_getBestViewport:function(viewData){var renderOptions=this._opts.renderOptions,map=renderOptions.map;if(map){if(viewData.points){var pts=viewData.points;if(this._opts.coordType!=map.config.coordType){if(map.config.coordType==BMAP_COORD_MERCATOR){for(var i=0;i<pts.length;i++){pts[i]=BMap.Projection.convertLL2MC(pts[i])}}else{if(map.config.coordType==BMAP_COORD_LNGLAT){for(var i=0;i<pts.length;i++){pts[i]=BMap.Projection.convertMC2LL(pts[i])}}}}var preserve=!renderOptions.autoViewport,animation=!renderOptions.selectFirstResult&&renderOptions.autoViewport,ret=map.getViewport(pts,{margins:[30,30,30,30]});if(!preserve){map.setViewport(ret,{enableAnimation:animation})}}else{var pt=convertCoord(viewData.center,this._opts.coordType,map.config.coordType);viewData.level=getBestLevel(viewData.level,map);if(this._opts.renderOptions.autoViewport){map.centerAndZoom(pt,viewData.level)}}}},toString:function(){return"LocalSearch"}});function LocalResult(opts){this.keyword=opts.keyword||"";this._pageIndex=opts.pageIdx||0;this._currentNumPois=opts.count||0;this._numPois=opts.total||0;this._numPages=Math.ceil(opts.total/opts.pc);this.center=opts.center;this.radius=opts.radius;this.bounds=opts.bounds;this.city=opts.city;this.viewport=opts.viewport;this.moreResultsUrl=opts.moreUrl;this._pois=opts.pois&&opts.pois.slice(0)||[];this._cityList=opts.cityList&&opts.cityList.slice(0)}baidu.extend(LocalResult.prototype,{getPoi:function(i){if(this._pois[i]){return this._pois[i]}},getNumPois:function(){return this._numPois},getNumPages:function(){return this._numPages},getCurrentNumPois:function(){return this._currentNumPois},getPageIndex:function(){return this._pageIndex},getCityList:function(){return this._cityList},toString:function(){return"LocalResult"}});var BaseRoute=function(loc,opts){BaseSearch.call(this,loc,opts);opts=opts||{};this.setPolylinesSetCallback(opts.onPolylinesSet)};baidu.inherits(BaseRoute,BaseSearch,"BaseRoute");BaseRoute._genTitle=function(title,clickBhv,seFlag){var borderStyle="border-bottom:1px solid #ccc";var imgOffsetY="-21px";if(seFlag===0){borderStyle+=";border-top:1px solid #ccc";imgOffsetY="5px"}var res=["<div style='"+borderStyle+"'><div style='cursor:pointer;background:url("];res.push(API_URL+"img/trans_icons.png) no-repeat 5px "+imgOffsetY+";padding:8px 0 8px 33px;line-height:15px' ");res.push("onclick='"+clickBhv+"'><span style='white-space:nowrap'>");res.push(title);res.push("</span></div></div>");return res.join("")};baidu.extend(BaseRoute.prototype,{search:function(start,end){if(!start||!end){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(BaseSearch.CBK_SEARCH_COMPLETE);return false}return true},clearResults:function(){delete this._results;delete this._ud;delete this._json;delete this._boundsPoints;this._setStatus();if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.innerHTML=""}if(this._opts.renderOptions.map){this._opts.renderOptions.map.closeInfoWindow()}this._clearOverlays();this._curIndex=-1},_formatDestQuery:function(dest){var ret;if(typeof dest=="string"){ret=[2,"","",dest,"",""]}else{if(dest instanceof BMap.Point){var pt=convertCoord(dest,this._opts.coordType,BMAP_COORD_MERCATOR);ret=[1,"",pt.lng+","+pt.lat,"","",""]}else{var pt=convertCoord(dest.point,this._opts.coordType,BMAP_COORD_MERCATOR);ret=[1,dest.uid,pt.lng+","+pt.lat,dest.title,"",""]}}return ret.join("$$")},setPolylinesSetCallback:function(cbk){this._opts.onPolylinesSet=cbk||function(){}}});function Route(opts){this._steps=opts.steps&&opts.steps.slice(0)||[];this._distance=opts.distance||0;this._index=opts.index||0;this._points=opts.points.slice(0);this._planIndex=opts.planIndex||0;this._rt=opts.rt;if(this._distance===0&&this._points.length>2){this._points.length=2}}baidu.extend(Route.prototype,{getNumSteps:function(){return this._steps.length},getStep:function(i){if(this._steps[i]){return this._steps[i]}},getDistance:function(format){if(format===false){return this._distance}else{return formatDistance(this._distance)}},getIndex:function(){return this._index},getPolyline:function(){return this._polyline},getPoints:function(){return this._points},getRouteType:function(){return this._rt},getPlanIndex:function(){return this._planIndex}});function RoutePlan(opts){this._routes=opts.routes.slice(0);this._distance=opts.distance||0;this._duration=opts.duration||0}baidu.extend(RoutePlan.prototype,{getRoute:function(i){if(this._routes[i]){return this._routes[i]}},getNumRoutes:function(){return this._routes.length},getDistance:function(format){if(format===false){return this._distance}else{return formatDistance(this._distance)}},getDuration:function(format){if(format===false){return this._duration}else{return formatTime(this._duration,"nav")}}});window.BMAP_TRANSIT_POLICY_LEAST_TIME=0;window.BMAP_TRANSIT_POLICY_LEAST_TRANSFER=2;window.BMAP_TRANSIT_POLICY_LEAST_WALKING=3;window.BMAP_LINE_TYPE_BUS=0;window.BMAP_LINE_TYPE_SUBWAY=1;window.BMAP_LINE_TYPE_FERRY=2;function TransitRoute(loc,opts){BaseRoute.call(this,loc,opts);opts=opts||{};this.setPolicy(opts.policy);this.setPageCapacity(opts.pageCapacity);this.QUERY_TYPE=QUERY_TYPE_TRANSIT;this.RETURN_TYPE=RETURN_TYPE_TRANSIT;this.ROUTE_TYPE=ROUTE_TYPE_TRANSIT;this._overlays=[];this._curIndex=-1}TransitRoute.MAX_PAGE_CAPACITY=5;TransitRoute.LINE_TYPE_MAPPING=[0,1,0,0,0,0,0,0,2,0,0,0,1,1,1];baidu.inherits(TransitRoute,BaseRoute,"TransitRoute");baidu.extend(TransitRoute.prototype,{setPolicy:function(policy){if(policy>=BMAP_TRANSIT_POLICY_LEAST_TIME&&policy<=BMAP_TRANSIT_POLICY_LEAST_WALKING){this._opts.policy=policy}else{this._opts.policy=BMAP_TRANSIT_POLICY_LEAST_TIME}},search:function(start,end){if(BaseRoute.prototype.search.call(this,start,end)==true){var me=this;this._getIdByLoc(this._loc,function(id){if(!id){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(BaseSearch.CBK_SEARCH_COMPLETE)}var params={qt:me.QUERY_TYPE,c:id,sn:me._formatDestQuery(start),en:me._formatDestQuery(end),sy:me._opts.policy||0,brn:me._opts.pageCapacity};DataMgr.request(function(json,userData){me._rawDataCbk(json,userData)},params,{start:start,end:end})})}},_rawDataCbk:function(json,userData){this.clearResults();this._json=json;var r=json.result;this._ud=userData;if(r.error!=0||r.type!=this.RETURN_TYPE){this._results=new TransitRouteResult({city:json.current_city.name,plans:[],policy:r.sy});this._setStatus(BMAP_STATUS_UNKNOWN_ROUTE);this._triggerCbk(BaseSearch.CBK_SEARCH_COMPLETE,this._results);return}this._processRaw();this._renderList();this._selectPlan(0)},_processRaw:function(){var r=this._json.result;var c=this._json.content;var cc=this._json.current_city;var start={};var end={};if(typeof this._ud.start=="object"&&!this._ud.start instanceof BMap.Point){baidu.extend(start,this._ud.start)}else{start.title=r.start.wd||"\u8d77\u70b9";start.uid=r.start.uid;start.url=BaseSearch._getPoiUrl(start.uid,cc.code);start.point=parseGeo(r.start.pt,true,this._opts.coordType).point;start.city=cc.name}if(typeof this._ud.end=="object"&&!this._ud.end instanceof BMap.Point){baidu.extend(end,this._ud.end)}else{end.title=r.end.wd||"\u7ec8\u70b9";end.uid=r.end.uid;end.url=BaseSearch._getPoiUrl(end.uid,cc.code);end.point=parseGeo(r.end.pt,true,this._opts.coordType).point;end.city=cc.name}var plans=[];this._boundsPoints=[];for(var i=0;i<c.length;i++){this._boundsPoints[i]=[];var stops=c[i].stops[0];var lines=c[i].lines[0];var len=0;for(var n=0,l=lines.length;n<l;n++){if(typeof lines[n]=="object"){len++}}var duration=lines[len+1],resLines=[],wRoutes=[],dis=0,desc="";for(var j=0;j<stops.length-1;j++){var on=stops[j].getOn;var onStop={title:on.name,uid:on.uid,url:BaseSearch._getPoiUrl(on.uid,cc.code),city:cc.name,point:parseGeo(on.geo,true,this._opts.coordType).point};var off=stops[j+1].getOff;var offStop={title:off.name,uid:off.uid,url:BaseSearch._getPoiUrl(off.uid,cc.code),city:cc.name,point:parseGeo(off.geo,true,this._opts.coordType).point};wRoutes.push(new Route({distance:stops[j].walk.distance,points:parseGeo(stops[j].walk.geo,true,this._opts.coordType).points,rt:BMAP_ROUTE_TYPE_WALKING,index:j,planIndex:i}));dis+=stops[j].walk.distance;if(j==stops.length-2){wRoutes.push(new Route({distance:stops[j+1].walk.distance,points:parseGeo(stops[j+1].walk.geo,true,this._opts.coordType).points,rt:BMAP_ROUTE_TYPE_WALKING,index:j+1,planIndex:i}));dis+=stops[j+1].walk.distance}var lineGeo=parseGeo(lines[j].geo,true,this._opts.coordType);resLines.push(new Line({title:lines[j].name,uid:lines[j].uid,distance:lines[j].distance,points:lineGeo.points,stops:[onStop,offStop],type:this._getLineType(lines[j].type),numViaStops:lines[j].station_num}));var bpts=getPointsByBounds(lineGeo.bounds,this._opts.coordType,this._opts.renderOptions.map?this._opts.renderOptions.map.config.coordType:this._opts.coordType);this._boundsPoints[i].push(bpts[0],bpts[1]);dis+=lines[j].distance;if(stops[j].walk.distance){desc+="<b>\u6b65\u884c</b>\u7ea6"+formatDistance(stops[j].walk.distance)+"\uff0c\u5230\u8fbe<b>"+onStop.title+"</b>\uff0c"}desc+="\u4e58\u5750<b>"+this._shortTitle(lines[j].name)+"</b>\uff0c\u7ecf\u8fc7"+lines[j].station_num+"\u7ad9\uff0c\u5230\u8fbe<b>"+offStop.title+"</b>";if(j<stops.length-2){desc+="\uff0c"}else{if(stops[j+1].walk.distance){desc+="\uff0c<b>\u6b65\u884c</b>\u7ea6"+formatDistance(stops[j+1].walk.distance)+"\uff0c\u5230\u8fbe<b>"+stops[j+1].getOn.name+"</b>"}}}plans.push(new TransitRoutePlan({routes:wRoutes,distance:dis,duration:duration,lines:resLines,description:desc}))}var url=MAP_URL+"?s="+encodeURIComponent(this.QUERY_TYPE+"&c="+cc.code+"&sy="+r.sy+"&sn="+this._formatDestQuery(this._ud.start)+"&en="+this._formatDestQuery(this._ud.end)+"&sq="+(this._ud.start.title?this._ud.start.title:this._ud.start)+"&eq="+(this._ud.end.title?this._ud.end.title:this._ud.end))+"&sr=1";if(this._ud.start.toString()=="Point"&&this._ud.start.toString()=="Point"){url=""}this._results=new TransitRouteResult({city:cc.name,plans:plans,start:start,end:end,url:url,policy:r.sy});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(BaseSearch.CBK_SEARCH_COMPLETE,this._results)},_shortTitle:function(title){return title.replace(/\(.*\)/,"")},_renderPlan:function(index){var map=this._opts.renderOptions.map;if(!map){return}var plan=this._results.getPlan(index);if(!plan){return}var startPoi=this._results.getStart();var endPoi=this._results.getEnd();var staMkr=addDestPoi(map,startPoi.point,startPoi.title,DEST_START,this._opts.coordType);startPoi.marker=staMkr;staMkr.addEventListener("click",function(){me._select(0)});this._overlays.push(staMkr);var endMkr=addDestPoi(map,endPoi.point,endPoi.title,DEST_END,this._opts.coordType);endPoi.marker=endMkr;this._overlays.push(endMkr);endMkr.addEventListener("click",function(){me._selectLast()});var startPt=convertCoord(startPoi.point,this._opts.coordType,map.config.coordType);var endPt=convertCoord(endPoi.point,this._opts.coordType,map.config.coordType);this._boundsPoints[index].push(startPt,endPt);var transPois=[];var me=this;for(var i=0,l=plan.getNumLines();i<l;i++){var line=plan.getLine(i);var polyline=addLine(map,line.getPoints(),this._opts.coordType);line._polyline=polyline;this._overlays.push(polyline);var on=line.getGetOnStop();transPois.push(on);var onMkr=addTransPoi(map,on.point,line.type,on.title,this._opts.coordType);on.marker=onMkr;this._overlays.push(onMkr);var off=line.getGetOffStop();transPois.push(off);var offMkr=addTransPoi(map,off.point,line.type,off.title,this._opts.coordType);off.marker=offMkr;(function(){var curIndex=i;onMkr.addEventListener("click",function(){me._select((curIndex+1)*2-1)});offMkr.addEventListener("click",function(){me._select((curIndex+1)*2)})})();this._overlays.push(offMkr);var route=plan.getRoute(i);if(route.getDistance(false)>0){polyline=addRoute(map,route.getPoints(),route.getRouteType(),this._opts.coordType);route._polyline=polyline;this._overlays.push(polyline)}}var route=plan.getRoute(i);polyline=addRoute(map,route.getPoints(),route.getRouteType(),this._opts.coordType);route._polyline=polyline;this._overlays.push(polyline);var me=this;if(this._opts.renderOptions.autoViewport){map.setViewport(this._boundsPoints[index],{margins:[30,30,30,30]})}this._triggerCbk(BaseSearch.CBK_POLYLINES_SET,plan._lines,plan._routes);this._triggerCbk(BaseSearch.CBK_MARKERS_SET,[startPoi,endPoi],transPois)},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._results&&this._results.getNumPlans()>0){var container=create("div",{style:"font-size:12px;font-family:arial,sans-serif;background:#fff"});var divSta=BaseRoute._genTitle(this._results.getStart().title,'Instance("'+this.guid+'")._select(0)',0);var tables=["<table style='font:12px arial,simsun,sans-serif;border-collapse:collapse' cellpadding='0' cellspacing='0' border='0'>"];for(var i=0,l=this._results.getNumPlans();i<l;i++){var plan=this._results.getPlan(i),dis=plan.getDistance().replace(/(\d+(?:.\d+)?)/,"$1 "),dur=plan.getDuration().replace(/(\d+)/,"$1 "),bg="";if(this._curIndex==i){bg=";background:#f0f0f0"}var commonStyle="border-bottom:1px solid #ccc;vertical-align:top;";tables.push("<tr style='cursor:pointer"+bg+"' onclick='Instance(\""+this.guid+'")._selectPlan('+i+")'>");tables.push("<td style='"+commonStyle+"width:20px;text-align:right;padding:4px 3px' >"+(i+1)+".</td>");tables.push("<td style='"+commonStyle+"padding:2px;line-height:18px' >"+plan.getDescription()+"</td>");tables.push("<td style='"+commonStyle+"text-align:right;padding:4px 3px;white-space:nowrap' >"+dis+" / "+dur+"</td></tr>");tables.push("</tr>")}tables.push("</table>");var divEnd=BaseRoute._genTitle(this._results.getEnd().title,'Instance("'+this.guid+'")._selectLast()',1);var control="<div style='border-bottom:1px solid #ccc;margin-bottom:10px;color:#7777cc;background:#e5ecf9;overflow:hidden;padding:2px;text-align:right'>";if(this._results.moreResultsUrl){control+="<a style='color:#7777cc' href='"+this._results.moreResultsUrl+"' target='_blank'>\u5230\u767e\u5ea6\u5730\u56fe\u67e5\u770b&#187;</a>"}control+="&nbsp;</div>";container.innerHTML=divSta+tables.join("")+divEnd+control;this._opts.renderOptions.panel.appendChild(container);this._triggerCbk(BaseSearch.CBK_RESULTS_HTML_SET,container)}},_select:function(index){var map=this._opts.renderOptions.map;if(map){var plan=this._results.getPlan(this._curIndex);if(!plan){return}var me=this;var total=plan.getNumLines()*2;if(index==0||index==total+1){var d=index===0?this._results.getStart():this._results.getEnd();var iw=createTransInfoWnd({content:"<b>"+d.title+"</b>",total:total,curIndex:index,nextTransCbk:function(i){me._select(i)},type:TRANS_INFO_WND_TRANSIT});iw.addEventListener("open",function(){me._triggerCbk(BaseSearch.CBK_INFO_HTML_SET,d,getInfoWindowDom(map))});var oindex=index===0?0:1;this._overlays[oindex].openInfoWindow(iw)}else{var curLine=plan.getLine(Math.floor((index+1)/2)-1);var curStop;var desc;if(index%2===1){curStop=curLine.getGetOnStop();desc="<b>"+curStop.title+"\u7ad9\u4e0a\u8f66</b>"}else{curStop=curLine.getGetOffStop();desc="<b>"+curStop.title+"\u7ad9\u4e0b\u8f66</b>"}var iw=createTransInfoWnd({content:desc,total:total,curIndex:index,nextTransCbk:function(i){me._select(i)},type:TRANS_INFO_WND_TRANSIT});iw.addEventListener("open",function(){me._triggerCbk(BaseSearch.CBK_INFO_HTML_SET,curStop,getInfoWindowDom(map))});curStop.marker.openInfoWindow(iw)}}},_selectLast:function(){if(this._results&&this._curIndex>-1){var plan=this._results.getPlan(this._curIndex);if(!plan){return}var total=plan.getNumLines()*2;this._select(total+1)}},_selectPlan:function(index){if(!this._results&&!this._result.getPlan(index)){return}var plan=this._results.getPlan(index);var map=this._opts.renderOptions.map;if(map){map.closeInfoWindow();this._clearOverlays();this._renderPlan(index)}if(this._opts.renderOptions.panel){var table=this._opts.renderOptions.panel.getElementsByTagName("table")[0];if(!table){return}var trs=table.getElementsByTagName("tr");if(this._curIndex>=0&&trs[this._curIndex]){trs[this._curIndex].style.background=""}if(index>=0&&trs[index]){trs[index].style.background="#f0f0f0"}}this._curIndex=index},_clearOverlays:function(){for(var i=0;i<this._overlays.length;i++){if(this._overlays[i]._p){this._overlays[i]._p.remove();this._overlays[i]._p.dispose();this._overlays[i]._p=null}this._overlays[i].remove();this._overlays[i].dispose();this._overlays[i]=null}this._overlays.length=0},_getLineType:function(type){return TransitRoute.LINE_TYPE_MAPPING[type]},setPageCapacity:function(cp){if(typeof cp=="string"){cp=parseInt(cp);if(isNaN(cp)){this._opts.pageCapacity=TransitRoute.MAX_PAGE_CAPACITY;return}}if(typeof cp!="number"){this._opts.pageCapacity=TransitRoute.MAX_PAGE_CAPACITY;return}if(cp>=1&&cp<=TransitRoute.MAX_PAGE_CAPACITY){this._opts.pageCapacity=Math.round(cp)}else{this._opts.pageCapacity=TransitRoute.MAX_PAGE_CAPACITY}},toString:function(){return"TransitRoute"}});function TransitRoutePlan(opts){RoutePlan.call(this,opts);this._lines=opts.lines;this._description=opts.description;this._duration=opts.duration||0}baidu.inherits(TransitRoutePlan,RoutePlan,"TransitRoutePlan");baidu.extend(TransitRoutePlan.prototype,{getNumLines:function(){return this._lines.length},getLine:function(i){if(this._lines[i]){return this._lines[i]}},getDescription:function(includeHtml){if(includeHtml===false){return this._description.replace(/<(\/)?b>/g,"")}else{return this._description}},getDuration:function(format){if(format===false){return this._duration}else{return formatTime(this._duration,"bustime")}}});function Step(opts){this._point=opts.point;this._index=opts.index;this._description=opts.description;this._distance=opts.distance||0;this._routeIndex=opts.routeIndex||0;this._planIndex=opts.planIndex||0}baidu.extend(Step.prototype,{getPoint:function(){return this._point},getIndex:function(){return this._index},getDescription:function(includeHtml){if(includeHtml===false){return this._description.replace(/<\/?b>/g,"")}else{return this._description}},getDistance:function(format){if(format===false){return this._distance}else{return formatDistance(this._distance)}},getRouteIndex:function(){return this._routeIndex},getPlanIndex:function(){return this._planIndex}});var DWRoute=function(location,opts){BaseRoute.call(this,location,opts);this._overlays=[];this._curIndex=-1};DWRoute.ROAD_TYPE=["","\u73af\u5c9b","\u65e0\u5c5e\u6027\u9053\u8def","\u4e3b\u8def","\u9ad8\u901f\u8fde\u63a5\u8def","\u4ea4\u53c9\u70b9\u5185\u8def\u6bb5","\u8fde\u63a5\u9053\u8def","\u505c\u8f66\u573a\u5185\u90e8\u9053\u8def","\u670d\u52a1\u533a\u5185\u90e8\u9053\u8def","\u6865","\u6b65\u884c\u8857","\u8f85\u8def","\u531d\u9053","\u5168\u5c01\u95ed\u9053\u8def","\u672a\u5b9a\u4e49\u4ea4\u901a\u533a\u57df","POI\u8fde\u63a5\u8def","\u96a7\u9053","\u6b65\u884c\u9053","\u516c\u4ea4\u4e13\u7528\u9053","\u63d0\u524d\u53f3\u8f6c\u9053"];baidu.inherits(DWRoute,BaseRoute,"DWRoute");baidu.extend(DWRoute.prototype,{search:function(start,end){if(BaseRoute.prototype.search.call(this,start,end)==true){var me=this;this._getIdByLoc(this._loc,function(id){id=id||1;var params={qt:me.QUERY_TYPE,c:id,sc:id,ec:id,sn:me._formatDestQuery(start),en:me._formatDestQuery(end),sy:me._opts.policy||0};DataMgr.request(function(json,userData){me._rawDataCbk(json,userData)},params,{start:start,end:end})})}},_rawDataCbk:function(json,userData){this.clearResults();this._json=json;var r=json.result;this._ud=userData;if(r.error!=0||r.type!=this.RETURN_TYPE){this._results=this._createResults({city:json.current_city.name,plans:[],policy:r.sy});this._setStatus(BMAP_STATUS_UNKNOWN_ROUTE);this._triggerCbk(BaseSearch.CBK_SEARCH_COMPLETE,this._results);return}this._processRaw();this._renderMap();this._renderList()},_processRaw:function(){var r=this._json.result;var c=this._json.content;var cc=this._json.current_city;var kps=c.kps;var rss=c.rss;var start={};var end={};if(typeof this._ud.start=="object"&&!this._ud.start instanceof BMap.Point){baidu.extend(start,this._ud.start)}else{start.title=r.start.wd||"\u8d77\u70b9";start.uid=r.start.uid;start.url=BaseSearch._getPoiUrl(start.uid,r.start_city.code);start.point=parseGeo(r.start.pt,true,this._opts.coordType).point;start.city=r.start_city.cname}if(typeof this._ud.end=="object"&&!this._ud.end instanceof BMap.Point){baidu.extend(end,this._ud.end)}else{end.title=r.end[0].wd||"\u7ec8\u70b9";end.uid=r.end[0].uid;if(end.uid=="null"){end.uid=""}end.url=BaseSearch._getPoiUrl(end.uid,r.end_city[0].code);end.point=parseGeo(r.end[0].pt,true,this._opts.coordType).point;end.city=r.end_city[0].cname}var steps=[];var polylinePoints=[];this._boundsPoints=[];for(var i=0,l=kps.length-1;i<l;i++){var curKps=kps[i];var curRss=rss[i];var preRss=rss[i-1]||{};var nxtRss=rss[i+1];var pt=parseGeo(curKps.pt,true,this._opts.coordType).point;var dis=parseInt(curRss.d);var des=this._getDescription(curKps,curRss,nxtRss,i,l,preRss);steps.push(new Step({point:pt,index:i,description:des,distance:nxtRss.d}));var cur=parseGeo(curRss.g,true,this._opts.coordType);if(cur){for(var j=0,ll=cur.points.length;j<ll;j++){polylinePoints.push(cur.points[j])}var bpts=getPointsByBounds(cur.bounds,this._opts.coordType,this._opts.renderOptions.map?this._opts.renderOptions.map.config.coordType:this._opts.coordType);this._boundsPoints.push(bpts[0],bpts[1])}}var route=new Route({steps:steps,distance:c.dis,index:0,points:polylinePoints,rt:this.ROUTE_TYPE});var time=c.time;if(this.QUERY_TYPE==QUERY_TYPE_WALKING){time=Math.round(c.dis/1.35)}var rp=new RoutePlan({routes:[route],distance:c.dis,duration:time});var url=MAP_URL+"?s="+encodeURIComponent(this.QUERY_TYPE+"&c="+cc.code+"&sc="+r.start_city.code+"&ec="+r.end_city[0].code+"&sy="+r.sy+"&sn="+this._formatDestQuery(this._ud.start)+"&en="+this._formatDestQuery(this._ud.end)+"&sq="+(this._ud.start.title?this._ud.start.title:this._ud.start)+"&eq="+(this._ud.end.title?this._ud.end.title:this._ud.end))+"&sr=1";if(this._ud.start.toString()=="Point"&&this._ud.start.toString()=="Point"){url=""}this._results=this._createResults({city:cc.name,plans:[rp],start:start,end:end,url:url,policy:r.sy});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(BaseSearch.CBK_SEARCH_COMPLETE,this._results)},_getDescription:function(curKps,curRss,nxtRss,i,l,preRss){var des="";var dis=parseInt(curRss.d);var poi=curRss.poi;if(poi){dis=dis-poi.pd}var disstr=formatDistance(dis);var pnm=this._getRoadName(preRss.t,preRss.n);var rnm=this._getRoadName(curRss.t,curRss.n);var nnm=this._getRoadName(curRss.t,nxtRss.n);var dw=this._getDwType(curKps.dw)||"";var dr=curKps.dr?(dw+"<b>"+curKps.dr+"</b>\uff0c"):"";var act=((rnm!=""&&pnm==rnm)?"\u7ee7\u7eed":"")+this._getRoadAct(curRss.t,curRss.n);var tips=this._getPoiInfo(curRss);var tic=this._getTicInfo(curKps);var ret=(rnm==nnm)?"":(this._getRetAct(nxtRss.t,nxtRss.n)+"<b>"+nnm+"</b>");des=act+"<b>"+rnm+"</b>"+this._getRetType(curKps.rt)+disstr+"\uff0c"+tips+tic+dr;if(i==0){des="\u4ece<b>\u8d77\u70b9</b>\u5411"+this._getTurnType(curKps.ett||curKps.tt)+"\u51fa\u53d1"}else{if(i>0&&i<l-1){des=des+"<b>"+this._getTurnType(curKps.ett||curKps.tt)+"</b>"+ret}else{des=des+"\u5230\u8fbe<b>\u7ec8\u70b9</b>"}}return des},_renderMap:function(){var map=this._opts.renderOptions.map;if(map&&this._results){var plan=this._results.getPlan(0);var route=plan.getRoute(0);var startPoi=this._results.getStart();var endPoi=this._results.getEnd();var me=this;var polyline=addRoute(map,route.getPoints(),route.getRouteType(),this._opts.coordType);route._polyline=polyline;this._overlays.push(polyline);var staMkr=addDestPoi(map,startPoi.point,startPoi.title,DEST_START,this._opts.coordType);startPoi.marker=staMkr;staMkr.addEventListener("click",function(){me._select(0)});this._overlays.push(staMkr);var endMkr=addDestPoi(map,endPoi.point,endPoi.title,DEST_END,this._opts.coordType);endPoi.marker=endMkr;this._overlays.push(endMkr);endMkr.addEventListener("click",function(){me._select(route.getNumSteps()+1)});if(this._opts.renderOptions.autoViewport){map.setViewport(this._boundsPoints,{margins:[30,30,30,30]})}this._triggerCbk(BaseSearch.CBK_POLYLINES_SET,plan._routes);this._triggerCbk(BaseSearch.CBK_MARKERS_SET,[startPoi,endPoi])}},_select:function(index){var preIndex=this._curIndex;if(this._opts.renderOptions.panel){var table=this._opts.renderOptions.panel.getElementsByTagName("table")[0];var trs=table.getElementsByTagName("tr");if(preIndex-1>=0&&trs[preIndex-1]){trs[preIndex-1].style.background=""}if(index-1>=0&&trs[index-1]){trs[index-1].style.background="#f0f0f0"}}var map=this._opts.renderOptions.map;if(map){var plan=this._results.getPlan(0);var route=plan.getRoute(0);var total=route.getNumSteps();var me=this;map.closeInfoWindow();if(index==0||index==total+1){var d=index===0?this._results.getStart():this._results.getEnd();var iw=createTransInfoWnd({content:"<b>"+d.title+"</b>",total:total,curIndex:index,nextTransCbk:function(i){me._select(i)},type:this.TRANS_INFO_WND_TYPE});iw.addEventListener("open",function(){me._triggerCbk(BaseSearch.CBK_INFO_HTML_SET,d,getInfoWindowDom(map))});iw.addEventListener("close",function(){if(me._opts.renderOptions.panel){var table=me._opts.renderOptions.panel.getElementsByTagName("table")[0];var trs=table.getElementsByTagName("tr");if(me._curIndex-1>=0&&trs[me._curIndex-1]){trs[me._curIndex-1].style.background=""}}me._curIndex=-1});var oindex=index===0?1:2;this._overlays[oindex].openInfoWindow(iw)}else{var curStep=route.getStep(index-1);var iw=createTransInfoWnd({content:curStep.getDescription(),total:total,curIndex:index,nextTransCbk:function(i){me._select(i)},type:this.TRANS_INFO_WND_TYPE});iw.addEventListener("open",function(){me._triggerCbk(BaseSearch.CBK_INFO_HTML_SET,curStep,getInfoWindowDom(map))});iw.addEventListener("close",function(){if(me._opts.renderOptions.panel){var table=me._opts.renderOptions.panel.getElementsByTagName("table")[0];var trs=table.getElementsByTagName("tr");if(me._curIndex-1>=0&&trs[me._curIndex-1]){trs[me._curIndex-1].style.background=""}}me._curIndex=-1});var pt=convertCoord(curStep.getPoint(),this._opts.coordType,map.config.coordType);map.openInfoWindow(iw,pt)}}this._curIndex=index},_clearOverlays:function(){for(var i=0,l=this._overlays.length;i<l;i++){this._overlays[i].remove();this._overlays[i].dispose();this._overlays[i]=null}this._overlays.length=0},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._results&&this._results.getNumPlans()>0){var plan=this._results.getPlan(0);var route=plan.getRoute(0);var container=create("div",{style:"font-size:12px;font-family:arial, sans-serif;background:#fff"});var divSta=BaseRoute._genTitle(this._results.getStart().title,'Instance("'+this.guid+'")._select(0)',0);var tables=["<table style='font:12px arial,simsun,sans-serif;border-collapse:collapse' cellpadding='0' cellspacing='0' border='0'>"];for(var i=0,l=route.getNumSteps();i<l;i++){var bg="";if(this._curIndex==i+1){bg=";background:#f0f0f0"}tables.push("<tr style='cursor:pointer"+bg+"' onclick='Instance(\""+this.guid+'")._select('+(i+1)+")'>");tables.push("<td style='border-bottom:1px solid #ccc;width:20px;vertical-align:top;text-align:right;padding:4px 3px' >"+(i+1)+".</td>");tables.push("<td style='border-bottom:1px solid #ccc;padding:2px;line-height:18px' >"+route.getStep(i).getDescription()+"</td>");tables.push("</tr>")}tables.push("</table>");var divEnd=BaseRoute._genTitle(this._results.getEnd().title,'Instance("'+this.guid+'")._select('+(route.getNumSteps()+1)+")",1);var control="<div style='border-bottom:1px solid #ccc;margin-bottom:10px;color:#7777cc;background:#e5ecf9;overflow:hidden;padding:2px;text-align:right'><span style='float:left;padding-left:6px'>\u5168\u7a0b\uff1a"+plan.getDistance().replace(/(\d+(?:.\d+)?)/,"$1 ")+" / "+plan.getDuration().replace(/(\d+)/,"$1 ")+"</span>";if(this._results.moreResultsUrl){control+="<a style='color:#7777cc' href='"+this._results.moreResultsUrl+"' target='_blank'>\u5230\u767e\u5ea6\u5730\u56fe\u67e5\u770b&#187;</a>"}control+="&nbsp;</div>";container.innerHTML=divSta+tables.join("")+divEnd+control;this._opts.renderOptions.panel.appendChild(container);this._triggerCbk(BaseSearch.CBK_RESULTS_HTML_SET,container)}},_getRoadName:function(roadType,roadName){if(roadName==""||!roadName){if(roadType==9||roadType==12||roadType==1||roadType==16){roadName=DWRoute.ROAD_TYPE[roadType]}}return roadName},_getPoiInfo:function(rss){var tips="";var poi=rss.poi;if(poi){var ps=this._getPsType(poi.ps)||"",pw=this._getPwType(poi.pw)||"";var ds=poi.pd<((rss.t==13||rss.t==4)?1000:50)?"":"\u7ea6"+formatDistance(poi.pd)+"\u540e";tips=pw+ps+"<b>"+poi.pn+"</b>"+ds+(ps==""?"":"\uff0c")}return tips},_getTicInfo:function(kps){var kiw=kps.iw;return !kps.ic?"":((this._getIwGo(kiw)||"")+"<b>"+kps.ic+"</b>"+(this._getIwTo(kiw)||""))},_getRoadAct:function(roadType,roadName){var act="\u6cbf";if(roadType==0||(!roadName&&roadType!=1&&roadType!=16&&roadType!=9&&roadType!=12)){act=""}return act},_getRetAct:function(roadType,roadName){var ret="\u8fdb\u5165";if(!roadName&&(roadType==9||roadType==12)){ret="\u4e0a"}else{if(roadType==0||(!roadName&&roadType!=1&&roadType!=16)){ret=""}}return ret}});window.BMAP_DRIVING_POLICY_LEAST_TIME=0;window.BMAP_DRIVING_POLICY_LEAST_DISTANCE=1;window.BMAP_DRIVING_POLICY_AVOID_HIGHWAYS=2;function DrivingRoute(location,opts){DWRoute.call(this,location,opts);opts=opts||{};this.setPolicy(opts.policy);this.QUERY_TYPE=QUERY_TYPE_DRIVING;this.RETURN_TYPE=RETURN_TYPE_DRIVING;this.ROUTE_TYPE=BMAP_ROUTE_TYPE_DRIVING;this.TRANS_INFO_WND_TYPE=TRANS_INFO_WND_DRIVING}baidu.inherits(DrivingRoute,DWRoute,"DrivingRoute");DrivingRoute.TURN_TYPE=["","\u76f4\u884c","\u53f3\u524d\u65b9\u8f6c\u5f2f","\u53f3\u8f6c","\u53f3\u540e\u65b9\u8f6c\u5f2f","\u8c03\u5934","\u5de6\u540e\u65b9\u8f6c\u5f2f","\u5de6\u8f6c","\u5de6\u524d\u65b9\u8f6c\u5f2f","\u7a0d\u5411\u5de6\u8f6c","\u76f4\u884c","\u7a0d\u5411\u53f3\u8f6c","\u6b63\u5317\u65b9\u5411","\u4e1c\u5317\u65b9\u5411","\u6b63\u4e1c\u65b9\u5411","\u4e1c\u5357\u65b9\u5411","\u6b63\u5357\u65b9\u5411","\u897f\u5357\u65b9\u5411","\u6b63\u897f\u65b9\u5411","\u897f\u5317\u65b9\u5411"];DrivingRoute.RET_TYPE=["","\u4ece\u8d77\u70b9\u51fa\u53d1","\u5230\u8fbe\u76ee\u7684\u5730","\u9014\u7ecf\u70b9","\u884c\u9a76"];DrivingRoute.IWGO=["\u5728","\u4ece","\u4ece"];DrivingRoute.IWTO=["","","\u79bb\u5f00"];DrivingRoute.PWTYPE=["\u8fc7","\u5728"];DrivingRoute.PSTYPE=["\u5de6\u4fa7\u7684","\u53f3\u4fa7\u7684",""];DrivingRoute.DWTYPE=["","\u671d"];baidu.extend(DrivingRoute.prototype,{setPolicy:function(policy){if(policy>=BMAP_DRIVING_POLICY_LEAST_TIME&&policy<=BMAP_DRIVING_POLICY_AVOID_HIGHWAYS){this._opts.policy=policy}else{this._opts.policy=BMAP_DRIVING_POLICY_LEAST_TIME}},_createResults:function(opts){return new DrivingRouteResult(opts)},_getTurnType:function(tt){return DrivingRoute.TURN_TYPE[tt]},_getRetType:function(rt){return DrivingRoute.RET_TYPE[rt]},_getIwGo:function(i){return DrivingRoute.IWGO[i]},_getIwTo:function(i){return DrivingRoute.IWTO[i]},_getPwType:function(i){return DrivingRoute.PWTYPE[i]},_getPsType:function(i){return DrivingRoute.PSTYPE[i]},_getDwType:function(i){return DrivingRoute.DWTYPE[i]},toString:function(){return"DrivingRoute"}});function WalkingRoute(location,opts){DWRoute.call(this,location,opts);this.QUERY_TYPE=QUERY_TYPE_WALKING;this.RETURN_TYPE=RETURN_TYPE_WALKING;this.ROUTE_TYPE=BMAP_ROUTE_TYPE_WALKING;this.TRANS_INFO_WND_TYPE=TRANS_INFO_WND_WALKING}baidu.inherits(WalkingRoute,DWRoute,"WalkingRoute");WalkingRoute.TURN_TYPE=["","\u76f4\u8d70","\u5411\u53f3\u524d\u65b9\u8f6c","\u53f3\u8f6c","\u5411\u53f3\u540e\u65b9\u8f6c","\u5411\u540e\u8f6c","\u5411\u5de6\u540e\u65b9\u8f6c","\u5de6\u8f6c","\u5411\u5de6\u524d\u65b9\u8f6c","\u5de6\u8f6c\u7a7f\u8fc7\u9a6c\u8def\u5e76\u7ee7\u7eed\u5411\u524d","\u53f3\u8f6c\u7a7f\u8fc7\u9a6c\u8def\u5e76\u7ee7\u7eed\u5411\u524d","\u5de6\u8f6c\u7a7f\u8fc7\u9a6c\u8def\u5e76\u5f80\u56de\u8d70","\u53f3\u8f6c\u7a7f\u8fc7\u9a6c\u8def\u5e76\u5f80\u56de\u8d70","\u6b63\u5317\u65b9\u5411","\u4e1c\u5317\u65b9\u5411","\u6b63\u4e1c\u65b9\u5411","\u4e1c\u5357\u65b9\u5411","\u6b63\u5357\u65b9\u5411","\u897f\u5357\u65b9\u5411","\u6b63\u897f\u65b9\u5411","\u897f\u5317\u65b9\u5411","","","",""];WalkingRoute.RET_TYPE=["","\u4ece\u8d77\u70b9\u51fa\u53d1","\u5230\u8fbe\u76ee\u7684\u5730","\u9014\u7ecf\u70b9","\u8d70"];WalkingRoute.IWGO=["\u5728","\u4ece","\u4ece"];WalkingRoute.IWTO=["","","\u79bb\u5f00"];WalkingRoute.PWTYPE=["\u8fc7","\u5728"];WalkingRoute.PSTYPE=["\u5de6\u4fa7\u7684","\u53f3\u4fa7\u7684",""];WalkingRoute.DWTYPE=["","\u671d"];baidu.extend(WalkingRoute.prototype,{_createResults:function(opts){delete opts.url;return new WalkingRouteResult(opts)},_getTurnType:function(tt){return WalkingRoute.TURN_TYPE[tt]},_getRetType:function(rt){return WalkingRoute.RET_TYPE[rt]},_getIwGo:function(i){return WalkingRoute.IWGO[i]},_getIwTo:function(i){return WalkingRoute.IWTO[i]},_getPwType:function(i){return WalkingRoute.PWTYPE[i]},_getPsType:function(i){return WalkingRoute.PSTYPE[i]},_getDwType:function(i){return WalkingRoute.DWTYPE[i]},toString:function(){return"WalkingRoute"}});function Line(opts){this.title=opts.title;this.uid=opts.uid;this.type=opts.type;this._stops=opts.stops.slice(0);this._points=opts.points.slice(0);this._distance=opts.distance||0;this._numViaStops=opts.numViaStops||0}baidu.extend(Line.prototype,{getNumViaStops:function(){return this._numViaStops},getGetOnStop:function(){return this._stops[0]},getGetOffStop:function(){return this._stops[1]},getPoints:function(){return this._points},getPolyline:function(){return this._polyline},getDistance:function(format){if(format===false){return this._distance}else{return formatDistance(this._distance)}}});function Popup(opts){baidu.lang.Class.call(this);this.visible=false;this.config=opts;if(!this.config){return}this.config.addDom=this.config.addDom?baidu.G(this.config.addDom):document.body;if(opts.clickClose!=null&&opts.clickClose==false){this.config.clickClose=false}else{this.config.clickClose=true}this.connectDom=new Array()}baidu.extend(Popup.prototype,{render:function(){var config=this.config;this.main=create("div",{style:"position:absolute;z-index:20;width:390px;display:none;font-size:12px;font-family:arial,sans-serif"});this.popBox=create("div",{style:"border:1px solid #8ba4d8;z-index:2;position:absolute;width:100%;height:100%;background:#FFF;overflow:hidden"});this.main.appendChild(this.popBox);if(config.isTitle!=false){this.title=create("div",{style:"background:url("+API_URL+"img/popup_title.gif);height:24px;line-height:25px;font-size:12px;font-weight:bold;color:#6688cc;padding-left:7px"});this.popBox.appendChild(this.title)}this.content=create("div");this.popBox.appendChild(this.content);this.button=create("button",{style:"position:absolute;top:6px;right:4px;width:12px;height:12px;background:url("+API_URL+"img/popup_close.gif) no-repeat;border:0;cursor:pointer",id:"popup_close"});this.popBox.appendChild(this.button);this.shadow=create("div",{style:"width:100%; height:100%; background:#505050;border:1px solid #505050; position:absolute;left:2px; top:3px;z-index:1;opacity:0.4;filter:alpha(opacity=40)"});this.main.appendChild(this.shadow);this.config.addDom.appendChild(this.main);this.addConnectDom(this.main);this.initialize()},initialize:function(){var config=this.config;this.setTitle(config.title);this.setContent(config.content);this.setWidth(config.width);this.setHeight(config.height);this.show();var me=this;var popClose=function(e){var ee=e.srcElement||e.target;while(ee){var dom=me.connectDom;for(var i=0;i<dom.length;i++){if(ee==dom[i]){return}}if(ee==document.body){me.close();return}ee=ee.parentNode}};if(this.config.clickClose){baidu.on(document.body,"mousedown",popClose)}baidu.on(this.button,"click",function(e){if(me.config.clickClose){baidu.un(document.body,"mousedown",popClose)}me.main.parentNode.removeChild(me.main);me.visible=false;if(me.config.close&&typeof(me.config.close)=="function"){me.config.close()}if(this.resizeTimer){window.clearInterval(this.resizeTimer);this.resizeTimer=null}if(baidu.G("imgLogo")){baidu.G("imgLogo").style.display="";baidu.G("imgLogo").style.display="inline"}});if(config.open&&typeof(config.open)=="function"){config.open()}},setTitle:function(title){if(title&&this.title){this.title.innerHTML=title;this.config.title=title}},setContent:function(content){if(content){if(typeof(content)=="string"){this.content.innerHTML=content}else{this.content.innerHTML="";this.content.appendChild(content)}this.config.content=content}},setWidth:function(w){if(w){this.main.style.width=(w-8)+"px";this.config.width=w}},setHeight:function(h){if(this.resizeTimer){window.clearInterval(this.resizeTimer);this.resizeTimer=null}if(h){this.main.style.height=this.shadow.style.height=(h-9)+"px";this.config.height=h;if(this.config.isTitle==false){this.content.style.height=(h-2)+"px"}else{this.content.style.height=(h-24-9)+"px"}this.content.style.overflowY="auto"}else{this.content.style.height="auto";this.resize()}},hide:function(){this.main.style.display="none";this.visible=false},show:function(){this.main.style.display="block";this.popBox.scrollTop=0;this.visible=true},getDom:function(){return this.main},resize:function(){var me=this;var resizeHeight=function(){var h=me.content.offsetHeight+24;if(me.mainHeight){if(me.mainHeight!=h){me.mainHeight=h}}me.popBox.style.height=me.shadow.style.height=me.main.style.height=h+"px";me.popBox.scrollTop=0};if(this.resizeTimer){window.clearInterval(this.resizeTimer);this.resizeTimer=null}this.resizeTimer=window.setInterval(resizeHeight,50)},close:function(){this.button.click()},addConnectDom:function(dom){this.connectDom.push(dom)}});function RouteResult(opts){this.city=opts.city;this._start=opts.start;this._end=opts.end;this._plans=opts.plans;this.moreResultsUrl=opts.url}baidu.extend(RouteResult.prototype,{getStart:function(){return this._start},getEnd:function(){return this._end},getNumPlans:function(){return this._plans.length},getPlan:function(i){if(this._plans[i]){return this._plans[i]}}});function DrivingRouteResult(opts){RouteResult.call(this,opts);this.policy=opts.policy}baidu.inherits(DrivingRouteResult,RouteResult,"DrivingRouteResult");function WalkingRouteResult(opts){RouteResult.call(this,opts)}baidu.inherits(WalkingRouteResult,RouteResult,"WalkingRouteResult");function TransitRouteResult(opts){RouteResult.call(this,opts);this.policy=opts.policy}baidu.inherits(TransitRouteResult,RouteResult,"TransitRouteResult");function Geolocation(opts){this._opts={coordType:BMAP_COORD_LNGLAT};baidu.extend(this._opts,opts)}baidu.extend(Geolocation.prototype,{getCurrentPosition:function(callback,opts){this._callback=callback||function(){};if(!navigator.geolocation){this._onErrorCallback(BMAP_STATUS_SERVICE_UNAVAILABLE);return}var me=this;navigator.geolocation.getCurrentPosition(function(position){me._onSuccessCallback(position)},function(positionError){me._onErrorCallback(positionError.code+5)},opts)},_onSuccessCallback:function(position){var coord=position.coords,me=this,reqParams={x:coord.longitude,y:coord.latitude,from:"0",to:"4"};DataMgr.request(function(json){var point=(json&&json.error==0)?new BMap.Point(json.x,json.y):new BMap.Point(coord.longitude,coord.latitude);point=convertCoord(point,BMAP_COORD_LNGLAT,me._opts.coordType);me._status=BMAP_STATUS_SUCCESS;var result={point:point,accuracy:coord.accuracy};me._callback(result)},reqParams,null,"ag/coord/convert")},_onErrorCallback:function(code){this._status=code;this._callback(null)},getStatus:function(){return this._status}});Geolocation.prototype.toString=function(){return"Geolocation"};var TrafficControl=function(opts){BMap.Control.call(this);this.hashCode=TrafficControl._guid++;TrafficControl._instances[this.hashCode]=this;BMap.MapType.B_LiveTraffic_MAP={tileUrls:["http://p0.map.baidu.com/traffic/","http://p1.map.baidu.com/traffic/","http://p2.map.baidu.com/traffic/","http://p3.map.baidu.com/traffic/","http://p4.map.baidu.com/traffic/","http://p5.map.baidu.com/traffic/","http://p6.map.baidu.com/traffic/","http://p7.map.baidu.com/traffic/"],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:18,errorUrl:API_URL+"bmap/blank.gif",bounds:new BMap.Bounds(-21364736,-10616832,23855104,15859712),imgExtend:"png"};BMap.MapType.B_ForecastTraffic_MAP={tileUrls:["http://p0.map.baidu.com/traffic/","http://p1.map.baidu.com/traffic/","http://p2.map.baidu.com/traffic/","http://p3.map.baidu.com/traffic/","http://p4.map.baidu.com/traffic/","http://p5.map.baidu.com/traffic/","http://p6.map.baidu.com/traffic/","http://p7.map.baidu.com/traffic/"],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:18,errorUrl:API_URL+"bmap/blank.gif",bounds:new BMap.Bounds(-21364736,-10616832,23855104,15859712),imgExtend:"png"};this.opened=false;this.anchorFixed=true;this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT;this.defaultOffset=new BMap.Size(10,10);this.type="default";this.now="";this.timer=null;this.weeks=["\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"];this.week=0;this.hour=0;this._opts=this._opts||{};baidu.extend(this._opts,{offset:this.defaultOffset,panelOffset:new BMap.Size(this.defaultOffset.width+3,this.defaultOffset.height+24)});this.markers=[];this.city={beijing:{bound:new BMap.Bounds(13024002.48,4865927.36,12896002.48,4800007.36),point:new BMap.Point(12959415.04,4825643.77)},shanghai:{bound:new BMap.Bounds(13586486.26,3671676.37,13458486.26,3605756.37),point:new BMap.Point(13525431,3642155)},guangzhou:{bound:new BMap.Bounds(12673391.11,2664430.08,12545391.11,2598510.08),point:new BMap.Point(12612023,2630443)},shenzhen:{bound:new BMap.Bounds(12725451.44,2575402.35,12661451.44,2545962.35),point:new BMap.Point(12689847,2569003)},changzhou:{bound:new BMap.Bounds(13346437,3697277,13363737,3729174),point:new BMap.Point(13355087,3713225)},chengdu:{bound:new BMap.Bounds(11575175,3557689,11597068,3577705),point:new BMap.Point(11586121,3567697)},dalian:{bound:new BMap.Bounds(13524453,4672572,13546187,4698377),point:new BMap.Point(13535320,4685474)},chongqing:{bound:new BMap.Bounds(11846022,3408422,11868701,3438052),point:new BMap.Point(11857361,3423237)}};baidu.extend(this._opts,opts||{});this.setOffset(this._opts.offset);this.setPanelOffset(this._opts.panelOffset)};TrafficControl._guid=0;window.TI=TrafficControl._I=function(guid){return TrafficControl._instances[guid]};TrafficControl._instances=[];TrafficControl.prototype=new BMap.Control();TrafficControl.time=3000*60;baidu.extend(TrafficControl.prototype,{initialize:function(map){this._map=map;var me=this;var div=document.createElement("div");baidu.extend(div.style,{background:"transparent url("+API_URL+"images/mapctrls.gif) no-repeat scroll 0 -86px",cursor:"pointer",height:"22px",top:"10px",width:"73px",zIndex:"800"});div.title="\u663e\u793a\u4ea4\u901a\u6d41\u91cf";map.getContainer().appendChild(div);this.bind(div);function showMarker(e){if(me._map){var mapBounds=me._map.getBounds();var cityName=null;var isquanguo=0;for(var key in me.city){if(mapBounds.containsBounds(me.city[key].bound)){isquanguo++}}for(var key in me.city){if(isquanguo<=1&&mapBounds.intersects(me.city[key].bound)!=null){cityName=key;break}}if(me._map.getZoom()>9){if(cityName==null){}if(e.type.indexOf("zoom")>0){if(me.ishide&&me.ishide==1){me.show();me.ishide=0}}me.removeMarker()}else{if(e.type.indexOf("zoom")>0){if(me.opened==1){me.ishide=1;me.addMarker()}}me.hide()}}}map.addEventListener("load",function(e){showMarker(e)});map.addEventListener("moveend",function(e){showMarker(e)});map.addEventListener("mapcontainerresize",function(e){showMarker(e)});map.addEventListener("dragend",function(e){showMarker(e)});map.addEventListener("zoomend",function(e){showMarker(e)});map.addEventListener("zoomstart",function(e){showMarker(e)});return div},bind:function(c){var me=this;c.onmousedown=function(){me.markers=[];this.style.backgroundPosition="0 -108px"};c.onclick=function(){me._toggle()}},setWeek:function(obj){for(var i=0;i<7;i++){baidu.G("week_"+this.hashCode+"_"+i).className="";if(baidu.G("week_"+this.hashCode+"_"+i)==obj){this.week=i;obj.className="on";baidu.G("font_"+this.hashCode).innerHTML="\u661f\u671f"+obj.innerHTML+"&nbsp;";this.setForecast()}}},_genHtml:function(){var guid=this.hashCode;var weekName=["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u65e5"];var htmls=['<div class="traffic_Panel" style="height:30px;padding:5px;-moz-user-select:none" onselectstart="return false">'];htmls.push('<div style="background:url('+API_URL+'img/tools_menu.gif) no-repeat 130px -85px;font-weight:bold" id="title_'+guid+'">\u5b9e\u65f6\u8def\u51b5</div>');htmls.push('<div style="margin-top:5px;height:20px"><span id="font_'+guid+'" style="float:left;color:#666">\u5f53\u524d\u65f6\u95f4\uff1a&nbsp;</span>');htmls.push('<span id="time_'+guid+'" style="float:left;color:#666"></span>');htmls.push('<span class="update" style="float:left;width:13px;height:14px;background:url('+API_URL+'img/tools_menu.gif) no-repeat -12px -18px;margin-left:5px;cursor:pointer" id="bt_'+guid+'" onclick="TI(\''+guid+'\').setPanel(this)" title="\u66f4\u65b0" ></span>');htmls.push('<a style="outline:none;float:right;color:#00f;text-decoration:none;line-height:15px;*line-height:18px" href="javascript:void(0)" onclick = "TI(\''+guid+"').switchInfo(this)\">\u67e5\u770b\u6d41\u91cf\u9884\u6d4b</a></div>");htmls.push('<table id="forecast_'+guid+'" width="233" style="font-size:12px;display:none;color:#6688ca; margin-top:5px"><tr>');htmls.push('<td style="width:35px">\u661f\u671f</td>');for(var i=0;i<7;i++){htmls.push('<td style="width:23px"><span style="padding:3px;cursor:pointer" id="week_'+guid+"_"+i+'" onclick = "TI(\''+guid+"').setWeek(this)\">"+weekName[i]+"</span></td>")}htmls.push("</tr><tr>");htmls.push('<td style="height:42px;width:35px"><div style="padding-top:16px;*padding-top:18px">\u65f6\u95f4</div></td>');htmls.push('<td colspan="7" style="188px">');htmls.push('<div style="background:url('+API_URL+'img/bar.gif) no-repeat 0 10px;width:193px;height:40px;overflow:hidden">');htmls.push('<div><div id="timeBox_'+guid+'" style="color:#6688cc;margin-left:74px;font-size:11px;overflow:hidden">12:00</div></div>');htmls.push('<div style="height:34px">');htmls.push('<div id="bar_prev_'+guid+'" style="overflow:hidden;width:9px;height:9px;cursor:pointer;float:left;margin-top:5px" onclick="TI(\''+guid+"').setBarBut('prev')\"></div>");htmls.push('<div id="bar_'+guid+'" style="width:9px;height:18px;background:url('+API_URL+'img/tools_menu.gif) no-repeat 0 -32px;float:left;margin-top:0;cursor:pointer;margin-left:74px;_margin-left:42px;margin-top:0px;"></div>');htmls.push('<div id="bar_next_'+guid+'" style="overflow:hidden;width:11px;*width:10px;height:9px;cursor:pointer;float:right;margin-top:5px" onclick="TI(\''+guid+"').setBarBut('next')\"></div>");htmls.push("</div></div></td></tr></table>");htmls.push('<div style="text-align:center;color:#9a9a9a;display:none" id="info_'+guid+'">\uff08\u57fa\u4e8e\u5386\u53f2\u6d41\u91cf\u7edf\u8ba1\u9884\u6d4b \u4ec5\u4f9b\u53c2\u8003\uff09</div></div>');return htmls.join("")},_launch:function(){var me=this;this._getTime();if(me.trafficTimer){clearInterval(me.trafficTimer)}me.trafficTimer=setInterval(function(){me._getTime()},TrafficControl.time);this.setBar();this.setBarTime(12)},_getTime:function(){if(this.type!="default"){return}var me=this;var aid=[{code:131,name:"beijing"},{code:289,name:"shanghai"},{code:257,name:"guangzhou"}];var k=true;var mType=BMap.MapType.B_LiveTraffic_MAP;this._getCityCode(function(code){for(var i=0;i<aid.length;i++){if(code==aid[i].code){scriptRequest(mType.tileUrls[0]+aid[i].name+".js?newmap=1",function(){me.updateTime(aid[i].name)},"traffic_js");return}}scriptRequest(mType.tileUrls[0]+"beijing.js?newmap=1",function(){me.updateTime("beijing")},"traffic_js")})},setPanel:function(obj){if(obj.className=="update"){this._getTime();return}else{if(obj.className=="update2"){obj.className="update1";baidu.G("forecast_"+this.hashCode).style.display=baidu.G("info_"+this.hashCode).style.display="none";this.pop.setHeight(53)}else{obj.className="update2";baidu.G("forecast_"+this.hashCode).style.display=baidu.G("info_"+this.hashCode).style.display="";this.pop.setHeight(150)}}},switchInfo:function(obj){var title=baidu.G("title_"+this.hashCode);var info=baidu.G("font_"+this.hashCode);var updeteBut=baidu.G("bt_"+this.hashCode);var font=["\u67e5\u770b\u6d41\u91cf\u9884\u6d4b","\u67e5\u770b\u5b9e\u65f6\u8def\u51b5"];if(obj.innerHTML==font[0]){this.type="forecast";obj.innerHTML=font[1];this.pop.setHeight(150);baidu.G("forecast_"+this.hashCode).style.display=baidu.G("info_"+this.hashCode).style.display="";title.innerHTML="\u6d41\u91cf\u9884\u6d4b";var week=new Date(this.now).getDay();info.innerHTML=this.weeks[week]+"&nbsp;";if(this.now){var t=new Date(this.now);baidu.G("time_"+this.hashCode).innerHTML=t.getHours()+":00";this.setWeek(baidu.G("week_"+this.hashCode+"_"+t.getDay()));this.week=t.getDay();this.hour=t.getHours()}this.setBarTime(this.hour);updeteBut.className="update2"}else{this.type="default";this._getTime();obj.innerHTML=font[0];baidu.G("time_"+this.hashCode).innerHTML="";this.pop.setHeight(53);baidu.G("forecast_"+this.hashCode).style.display=baidu.G("info_"+this.hashCode).style.display="none";title.innerHTML="\u5b9e\u65f6\u8def\u51b5";info.innerHTML="\u5f53\u524d\u65f6\u95f4\uff1a&nbsp;";updeteBut.className="update";this.addTrafficLay("B_LiveTraffic_MAP")}},addTrafficLay:function(type){var map=this._map;if(this.currentTrafficLay){map.removeTileLayer(this.currentTrafficLay)}var bounds=new BMap.Bounds(-21364736,-10616832,23855104,15859712);var copyright=new BMap.Copyright(bounds,"",type);var tilelayer=new BMap.TileLayer({mapType:type,transparentPng:true});tilelayer.getTilesUrl=function(point,level){var mapType=BMap.MapType[this.mapType];if(typeof mapType!="object"){return null}var zoomUnits=mapType.baseUnits*Math.pow(2,(mapType.zoomLevelMax-level));var row=point.x;var column=point.y;var px=Math.floor(row/200);var py=Math.floor(column/200);var url="";var timekey=new Date().getTime();url=mapType.tileUrls[Math.abs(row+column)%mapType.tileUrls.length]+level+"/"+px+"/"+py+"/"+row+"_"+column+".png?t="+timekey;url=url.replace(/-(\d+)/gi,"M$1");return url};map.addTileLayer(tilelayer);this.currentTrafficLay=tilelayer},clearTrafficLay:function(){if(this.currentTrafficLay){this._map.removeTileLayer(this.currentTrafficLay)}},setMarker:function(){var me=this;var icon=new BMap.Icon(API_URL+"img/traffic.png",new BMap.Size(28,35),{offset:new BMap.Size(6,35)});for(var k in me.city){var point=me.city[k].point;if(me._map.config.coordType==BMAP_COORD_LNGLAT){point=BMap.Projection.convertMC2LL(point)}if(!me.markers){me.markers=[]}var marker=new BMap.Marker(point,{icon:icon});me.markers.push(marker)}},addMarker:function(){var me=this;var mks=me.markers;for(var k in mks){if(mks[k].domElement==null){mks[k].addEventListener("click",function(){me._map.centerAndZoom(this.point,11);me.show()});me._map.addOverlay(mks[k]);mks[k].domElement.setAttribute("type","system");mks[k].siblingElement.setAttribute("type","system");mks[k].domElement.title="\u70b9\u51fb\u67e5\u770b\u4ea4\u901a\u6d41\u91cf"}mks[k].show()}},removeMarker:function(){var mks=this.markers;try{for(var k in mks){mks[k].hide()}}catch(e){}},updateTime:function(name){if(name==""||name==null||this.type!="default"){return}var newTime=window["_Lukuang_"+name];var t=new Date(newTime);baidu.G("time_"+this.hashCode).innerHTML=(t.getHours()<10?("0"+t.getHours()):t.getHours())+":"+(t.getMinutes()<10?("0"+t.getMinutes()):t.getMinutes());if(newTime&&newTime>this.now){this.now=newTime;this.updateTile()}},updateTile:function(){this.addTrafficLay("B_LiveTraffic_MAP")},_getCityCode:function(cbk){var pt=this._map.getCenter();var level=this._map.getZoom();if(this._map.config.coordType==BMAP_COORD_LNGLAT){pt=BMap.Projection.convertLL2MC(pt)}DataMgr.request(function(json){if(json&&json.result&&json.result.type==RETURN_TYPE_CENTER){cbk&&cbk(json.content.uid)}},{qt:QUERY_TYPE_CENTER,b:pt.lng+","+pt.lat+";"+pt.lng+","+pt.lat,l:level})},setBar:function(){var me=this;var bt=baidu.G("bar_"+this.hashCode);function dragStart(){baidu.on(document,"onmousemove",dragIng);baidu.on(document,"onmouseup",dragEnd)}function dragIng(e){var x=e.clientX||e.x;var left=getPosition(baidu.G("bar_prev_"+me.hashCode)).left+9;var margin=x-left-4;if(margin<0){margin=0}if(margin>165){margin=165}if(FeBrowser.ie<=6&&FeBrowser.ie>0){bt.style.marginLeft=(margin*0.53)+"px"}else{bt.style.marginLeft=margin+"px"}baidu.G("timeBox_"+me.hashCode).style.marginLeft=(margin)+"px";me.setTimeBox()}function dragEnd(){baidu.un(document,"onmousemove",dragIng);baidu.un(document,"onmouseup",dragEnd);me.setForecast()}baidu.on(bt,"onmousedown",dragStart)},setBarTime:function(n){if(n<0){n=0}if(n>24){n=24}this.hour=n;var margin=n*(165/24);baidu.G("timeBox_"+this.hashCode).style.marginLeft=margin+"px";var bt=baidu.G("bar_"+this.hashCode);if(FeBrowser.ie<=6&&FeBrowser.ie>0){bt.style.marginLeft=(margin*0.53)+"px"}else{bt.style.marginLeft=margin+"px"}this.setTimeBox()},setTimeBox:function(){var box=baidu.G("timeBox_"+this.hashCode);var box2=baidu.G("time_"+this.hashCode);var margin=parseInt(box.style.marginLeft);var n=Math.ceil((margin-4)*24/165);this.hour=n;if(n<10){n="0"+n}box2.innerHTML=box.innerHTML=n+":00"},setBarBut:function(key){var box=baidu.G("timeBox_"+this.hashCode);var margin=parseInt(box.style.marginLeft);var n=Math.ceil((margin-4)*24/165);this.setBarTime(key=="next"?(n+1):(n-1));this.setForecast()},setForecast:function(){var hour=this.hour;if(hour==24){hour=0}var forecastUrl=[];var mForeType=BMap.MapType.B_ForecastTraffic_MAP;var mLiveType=BMap.MapType.B_LiveTraffic_MAP;for(var i=0;i<mLiveType.tileUrls.length;i++){mForeType.tileUrls[i]=mLiveType.tileUrls[i]+"history/"+this.week+"/"+hour+"/"}this.addTrafficLay("B_ForecastTraffic_MAP")},setPanelOffset:function(size){if(!size||size.toString()!="Size"){return}this._opts.panelOffset=new BMap.Size(size.width,size.height);if(this.pop&&this.pop.getDom()){this.pop.getDom().style.right=size.width+"px";this.pop.getDom().style.top=size.height+"px"}},show:function(){if(this.opened){return}var me=this;this.setMarker();this.opened=true;this._container.style.backgroundPosition="0 -108px";this._container.title="\u9690\u85cf\u4ea4\u901a\u6d41\u91cf";var opts={height:53,width:251,addDom:me._map.getContainer(),clickClose:false,isTitle:false,close:function(){me.hide()}};var pop=me.pop=new Popup(opts);pop.render();pop.hide();pop.content.innerHTML=me._genHtml();pop.getDom().style.right=me._opts.panelOffset.width+"px";pop.getDom().style.top=me._opts.panelOffset.height+"px";pop.getDom()._anchor=me.defaultAnchor;pop.getDom()._offset=me._opts.panelOffset;pop.show();var popclose=baidu.G("popup_close");popclose.onmouseup=function(){if(me.markers){mks=me.markers;for(var k in mks){mks[k].remove()}}me.markers=null};me._launch()},hide:function(){if(!this.opened){return}this.opened=false;this.now="";this.type="default";this.pop.close();if(this._container){this._container.style.backgroundPosition="0 -86px";this._container.title="\u663e\u793a\u4ea4\u901a\u6d41\u91cf"}if(this.trafficTimer){clearInterval(this.trafficTimer)}this.clearTrafficLay()},_toggle:function(){if(this.opened){this.hide()}else{this.show()}}});function scriptRequest(url,echo,id,charset){var isIe=/msie/i.test(window.navigator.userAgent);if(isIe&&baidu.G("_script_"+id)){var script=baidu.G("_script_"+id)}else{if(baidu.G("_script_"+id)){baidu.G("_script_"+id).parentNode.removeChild(baidu.G("_script_"+id))}var script=document.createElement("script");if(charset!=null){script.charset=charset}if(id!=null&&id!=""){script.setAttribute("id","_script_"+id)}script.setAttribute("type","text/javascript");document.body.appendChild(script)}var t=new Date();if(url.indexOf("?")>-1){url+="&t="+t.getTime()}else{url+="?t="+t.getTime()}var _complete=function(){if(!script.readyState||script.readyState=="loaded"||script.readyState=="complete"){if(typeof(echo)=="function"){echo()}else{eval(echo)}}};if(isIe){script.onreadystatechange=_complete}else{script.onload=_complete}script.setAttribute("src",url)}function getBPoints(bounds){if(!bounds||bounds.length==0){return}var points=[];for(var i=0;i<bounds.length;i++){if(bounds[i]){var pts=bounds[i].split(";");for(var j=0;j<pts.length;j++){var point=getPointByStr(pts[j]);points.push(point)}}}return points}function getPosition(obj){var pos={left:0,top:0};while(obj&&obj.offsetParent){pos.left+=obj.offsetLeft;pos.top+=obj.offsetTop;obj=obj.offsetParent}return pos}function LocalCity(opts){this._opts={coordType:BMAP_COORD_LNGLAT,renderOptions:{map:null}};baidu.extend(this._opts,opts)}baidu.inherits(LocalCity,baidu.lang.Class,"LocalCity");baidu.extend(LocalCity.prototype,{get:function(callback){var me=this;DataMgr.request(function(json){if(json&&json.result&&json.result.type==RETURN_TYPE_CURRENT_CITY){var result=json.result,content=json.content;if(result){if(result.error==0){var map=me._opts.renderOptions.map;var level=content.level;var cname=content.cname;var code=content.code;var point=parseGeo(content.geo,true,me._opts.coordType).point;level=getBestLevel(level,map);if(map){map.centerAndZoom(point,level)}}}callback&&callback({center:point,level:level,name:cname,code:code})}},{qt:QUERY_TYPE_LOCALCITY})},toString:function(){return"LocalCity"}});function Geocoder(opts){this._opts={coordType:BMAP_COORD_LNGLAT};baidu.extend(this._opts,opts)}baidu.inherits(Geocoder,baidu.lang.Class,"Geocoder");baidu.extend(Geocoder.prototype,{getPoint:function(address,callback,city){var me=this;city=city||"\u5317\u4eac\u5e02";DataMgr.request(function(json){if(json&&json.result&&json.result.type==RETURN_TYPE_GEOCODER){var result=json.result,content=json.content,point=null,detailInfo=null;if(result){if(result.error==0){var x=content.coord.x,y=content.coord.y;point=new BMap.Point(x,y);if(me._opts.coordType==BMAP_COORD_LNGLAT){point=BMap.Projection.convertMC2LL(point)}me.point=point;me.city=content.cn;me.citycode=content.sc;me.address=content.wd;me.precision=content.precision;detailInfo={city:content.cn,address:content.wd,citycode:content.sc}}}callback&&callback(point,detailInfo)}},{qt:QUERY_TYPE_GEOCODER,wd:address,cn:city})},getLocation:function(point,callback,opts){if(!point||point.toString()!="Point"&&callback){callback(null);return}var me=this,point=this._opts.coordType==BMAP_COORD_LNGLAT?BMap.Projection.convertLL2MC(point):point,x=point.lng,y=point.lat,opts=opts||{},poiRadius=opts.poiRadius||100,numPois=opts.numPois||10;DataMgr.request(function(json){var geocoderResult=null;if(json&&json.result&&json.result.type==RETURN_TYPE_REVERSE_GEOCODER){var result=json.result,content=json.content,addr,components={},resultPois=[],rpoint;if(result.error==0){var detail=content.address_detail,city=detail.city;if(detail){components.streetNumber=detail.street_number;components.street=detail.street;components.district=detail.district;components.city=city;components.province=detail.province}rpoint=content.point;var rpt=new BMap.Point(rpoint.x,rpoint.y);if(me._opts.coordType==BMAP_COORD_LNGLAT){rpt=BMap.Projection.convertMC2LL(rpt)}var surrounds=content.surround_poi;if(surrounds&&surrounds.length){for(var i=0,l=surrounds.length;i<l;i++){var localPoi={},surround_poi=surrounds[i];localPoi.title=surround_poi.name;localPoi.uid=surround_poi.uid;var pt=new BMap.Point(surround_poi.point.x,surround_poi.point.y);if(me._opts.coordType==BMAP_COORD_LNGLAT){pt=BMap.Projection.convertMC2LL(pt)}localPoi.point=pt;localPoi.city=city;localPoi.type=BMAP_POI_TYPE_NORMAL;localPoi.address=surround_poi.addr;localPoi.postcode=surround_poi.zip||null;localPoi.phoneNumber=surround_poi.tel||null;resultPois.push(localPoi)}}geocoderResult={point:rpt,address:content.address,addressComponents:components,surroundingPois:resultPois}}}callback&&callback(geocoderResult)},{qt:QUERY_TYPE_REVERSE_GEOCODER,x:x,y:y,dis_poi:poiRadius,poi_num:numPois})},toString:function(){return"Geocoder"}});function mg(name,value){if(!window.BMap){window.BMap={}}window.BMap[name]=value}function jsonToQuery(json,encode){var s=[];encode=encode||function(v){return v};for(var n in json){s.push(n+"="+encode(json[n]))}return s.join("&")}function create(tag,attr){var e=document.createElement(tag);attr=attr||{};for(var name in attr){name={"for":"htmlFor","class":"cssClass"}[name]||name;if(name=="style"){e.style.cssText=attr[name];continue}if(e.setAttribute){e.setAttribute(name,attr[name])}else{try{e[name]=attr[name]}catch(e){}}}return e}function unique(a){var found=false;var r=[],o={};for(var i=0,l=a.length;i<l;i++){if(!o[a[i]]){o[a[i]]=true;r.push(a[i])}}return r}function getBestLevel(level,map){if(map){var ratio=Math.min(map.width/1100,map.height/660);level=Math.round(level+(Math.log(ratio)/Math.log(2)))}if(level<1){level=1}if(level>18){level=18}return level}var STAT_APPJS_EXECUTE=5100;window._addStat(STAT_APPJS_EXECUTE);window.BMAP_STATUS_SUCCESS=0;window.BMAP_STATUS_CITY_LIST=1;window.BMAP_STATUS_UNKNOWN_LOCATION=2;window.BMAP_STATUS_UNKNOWN_ROUTE=3;window.BMAP_STATUS_INVALID_KEY=4;window.BMAP_STATUS_INVALID_REQUEST=5;window.BMAP_STATUS_PERMISSION_DENIED=6;window.BMAP_STATUS_SERVICE_UNAVAILABLE=7;window.BMAP_STATUS_TIMEOUT=8;window.BMAP_ROUTE_TYPE_WALKING=2;window.BMAP_ROUTE_TYPE_DRIVING=3;var QUERY_TYPE_CURRENT_CITY="cur";var QUERY_TYPE_CENTER="cen";var QUERY_TYPE_POI_SEARCH="s";var QUERY_TYPE_SEARCH_INBOUNDS="bd";var QUERY_TYPE_SEARCH_NEARBY="nb";var QUERY_TYPE_TRANSIT="bt";var QUERY_TYPE_DRIVING="nav";var QUERY_TYPE_WALKING="walk";var QUERY_TYPE_GEOCODER="gc";var QUERY_TYPE_REVERSE_GEOCODER="rgc";var QUERY_TYPE_LOCALCITY="dec";var RETURN_TYPE_CURRENT_CITY=2;var RETURN_TYPE_CENTER=4;var RETURN_TYPE_CITY_LIST=7;var RETURN_TYPE_POI_SEARCH=11;var RETURN_TYPE_SEARCH_NEARBY=12;var RETURN_TYPE_TRANSIT=14;var RETURN_TYPE_DRIVING=20;var RETURN_TYPE_SEARCH_INBOUNDS=21;var RETURN_TYPE_SPECIAL_REGION=26;var RETURN_TYPE_NODATA_REGION=28;var RETURN_TYPE_WALKING=31;var RETURN_TYPE_GEOCODER=35;var RETURN_TYPE_REVERSE_GEOCODER=44;var LOC_TYPE_UNKNOWN=-1;var LOC_TYPE_MAP=0;var LOC_TYPE_POINT=1;var LOC_TYPE_STRING=2;var GEO_TYPE_AREA=0;var GEO_TYPE_LINE=1;var GEO_TYPE_POINT=2;var MAP_URL="http://map.baidu.com/";var API_URL="http://api.map.baidu.com/";function parseGeo(geo,usePoint,coordType){if(typeof geo!="string"||!geo){return}var temp=geo.split("|");var r;var bdpt0;var bdpt1;if(temp.length==1){r=decode_geo_diff(geo)}else{r=decode_geo_diff(temp[2]);bdpt0=decode_geo_diff(temp[0]);bdpt1=decode_geo_diff(temp[1])}var ret={type:r.geoType};if(usePoint){switch(ret.type){case GEO_TYPE_POINT:ret.point=new BMap.Point(r.geo[0][0],r.geo[0][1]);ret.points=[ret.point];if(typeof coordType=="number"&&coordType==BMAP_COORD_LNGLAT){var npt=BMap.Projection.convertMC2LL(ret.point);ret.point=npt;ret.points=[npt]}break;case GEO_TYPE_LINE:ret.points=[];var curGeo=r.geo[0];for(var i=0,l=curGeo.length-1;i<l;i+=2){var pt=new BMap.Point(curGeo[i],curGeo[i+1]);if(typeof coordType=="number"&&coordType==BMAP_COORD_LNGLAT){pt=BMap.Projection.convertMC2LL(pt)}ret.points.push(pt)}bdpt0=new BMap.Point(bdpt0.geo[0][0],bdpt0.geo[0][1]);bdpt1=new BMap.Point(bdpt1.geo[0][0],bdpt1.geo[0][1]);if(typeof coordType=="number"&&coordType==BMAP_COORD_LNGLAT){bdpt0=BMap.Projection.convertMC2LL(bdpt0);bdpt1=BMap.Projection.convertMC2LL(bdpt1)}ret.bounds=new BMap.Bounds(bdpt0.lng,bdpt0.lat,bdpt1.lng,bdpt1.lat);break;default:break}}return ret}var _EXT_CHARS_=["=",".","-","*"];var _MAX_DELTA_=1<<23;function decode_geo_diff(coded){var geo_type=_decode_type(coded.charAt(0));var code=coded.substr(1);var pos=0;var code_len=code.length;var part_vec=[];var geo_vec=[];var ret=[];while(pos<code_len){if(code.charAt(pos)==_EXT_CHARS_[0]){if((code_len-pos)<13){return 0}ret=_decode_6byte_(code.substr(pos,13),part_vec);if(ret<0){return 0}pos+=13}else{if(code.charAt(pos)==";"){geo_vec.push(part_vec.slice(0));part_vec.length=0;++pos}else{if((code_len-pos)<8){return 0}ret=_decode_4byte_(code.substr(pos,8),part_vec);if(ret<0){return 0}pos+=8}}}for(var i=0,l=geo_vec.length;i<l;i++){for(var j=0,ll=geo_vec[i].length;j<ll;j++){geo_vec[i][j]/=100}}return{geoType:geo_type,geo:geo_vec}}function _decode_type(c){var r=-1;if(c==_EXT_CHARS_[1]){r=GEO_TYPE_POINT}else{if(c==_EXT_CHARS_[2]){r=GEO_TYPE_LINE}else{if(c==_EXT_CHARS_[3]){r=GEO_TYPE_AREA}}}return r}function _decode_6byte_(code,ret){var x=0;var y=0;var buff=0;for(var i=0;i<6;i++){buff=_char2num_(code.substr(1+i,1));if(buff<0){return -1-i}x+=buff<<(6*i);buff=_char2num_(code.substr(7+i,1));if(buff<0){return -7-i}y+=buff<<(6*i)}ret.push(x);ret.push(y);return 0}function _decode_4byte_(code,ret){var l=ret.length;if(l<2){return -1}var x=0;var y=0;var buff=0;for(var i=0;i<4;i++){buff=_char2num_(code.substr(i,1));if(buff<0){return -1-i}x+=buff<<(6*i);buff=_char2num_(code.substr(4+i,1));if(buff<0){return -5-i}y+=buff<<(6*i)}if(x>_MAX_DELTA_){x=_MAX_DELTA_-x}if(y>_MAX_DELTA_){y=_MAX_DELTA_-y}ret.push(ret[l-2]+x);ret.push(ret[l-1]+y);return 0}function _char2num_(c){var n=c.charCodeAt(0);if(c>="A"&&c<="Z"){return n-"A".charCodeAt(0)}else{if(c>="a"&&c<="z"){return(26+n-"a".charCodeAt(0))}else{if(c>="0"&&c<="9"){return(52+n-"0".charCodeAt(0))}else{if(c=="+"){return 62}else{if(c=="/"){return 63}}}}}return -1}function formatDistance(dis){if(typeof dis=="string"){dis=parseFloat(dis)}var ret;if(!dis||dis<0){ret="0\u7c73"}else{if(dis<=10){ret="10\u7c73"}else{ret=dis<1000?Math.round(dis/10)*10+"\u7c73":(dis/1000).toFixed(1)+"\u516c\u91cc"}}if(ret=="1000\u7c73"){ret="1.0\u516c\u91cc"}return ret}function formatTime(seconds,mode){if(!seconds||isNaN(seconds)){return""}var stime="",m=60,d=m*24;var minutes=Math.ceil(seconds/m);if(mode=="bustime"){var a=minutes%10,b=parseInt(minutes/10);minutes=a!=0?(a>5?(++b*10):b?(b*10):5):minutes}var days=parseInt(minutes/d);minutes%=d;var hours=parseInt(minutes/m);minutes%=m;if(days>=1){stime+=days+"\u5929"}if(hours>=1){stime+=hours+"\u5c0f\u65f6"}if(minutes>=1){if(mode&&mode=="nav"&&days>=1){return stime}else{stime+=minutes+"\u5206\u949f"}}return stime}function convertCoord(point,fromCoord,toCoord){var ret=point;switch(fromCoord){case BMAP_COORD_MERCATOR:switch(toCoord){case BMAP_COORD_LNGLAT:ret=BMap.Projection.convertMC2LL(point);break;default:break}break;case BMAP_COORD_LNGLAT:switch(toCoord){case BMAP_COORD_MERCATOR:ret=BMap.Projection.convertLL2MC(point);break;default:break}break;default:break}return ret}function getPointsByBounds(bounds,fromCoordType,toCoordType){var pt0=new BMap.Point(bounds.minX,bounds.minY);var pt1=new BMap.Point(bounds.maxX,bounds.maxY);if(typeof fromCoordType!="undefined"&&typeof toCoordType!="undefined"){pt0=convertCoord(pt0,fromCoordType,toCoordType);pt1=convertCoord(pt1,fromCoordType,toCoordType)}return[pt0,pt1]}function parseGeoStr(str,coord){var pts=str.split(",");var pt=new BMap.Point(pts[0],pts[1]);return convertCoord(pt,BMAP_COORD_MERCATOR,coord)}window.Instance=baidu.lang.instance;function Page(container,callback,opts){baidu.lang.Class.call(this);if(!container){return}this.container=(typeof(container)=="object")?container:baidu.G(container);this.page=1;this.pageCount=100;this.argName="pg";this.pagecap=4;this.callback=callback;this.update=true;var _config={page:1,totalCount:100,pageCount:100,pagecap:4,argName:"pg",update:true};if(!opts){opts=_config}for(var p in opts){if(typeof(opts[p])!="undefined"){this[p]=opts[p]}}this.render()}baidu.extend(Page.prototype,{render:function(){this.initialize()},initialize:function(){this.checkPages();this.container.innerHTML=this.createHtml()},checkPages:function(){if(isNaN(parseInt(this.page))){this.page=1}if(isNaN(parseInt(this.pageCount))){this.pageCount=1}if(this.page<1){this.page=1}if(this.pageCount<1){this.pageCount=1}if(this.page>this.pageCount){this.page=this.pageCount}this.page=parseInt(this.page);this.pageCount=parseInt(this.pageCount)},getPage:function(){var args=location.search;var reg=new RegExp("[?&]?"+this.argName+"=([^&]*)[&$]?","gi");var chk=args.match(reg);this.page=RegExp.$1},createHtml:function(){var strHtml=[],prevPage=this.page-1,nextPage=this.page+1;strHtml.push('<p style="margin:0;padding:0;white-space:nowrap">');if(prevPage<1){}else{if(this.page>=this.pagecap){strHtml.push('<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="Instance(\''+this.guid+"').toPage(1);\">\u9996\u9875</a></span>")}strHtml.push('<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="Instance(\''+this.guid+"').toPage("+prevPage+');">\u4e0a\u4e00\u9875</a></span>')}if(this.page<this.pagecap){if(this.page%this.pagecap==0){var startPage=this.page-this.pagecap-1}else{var startPage=this.page-this.page%this.pagecap+1}var endPage=startPage+this.pagecap-1}else{var spt=Math.floor(this.pagecap/2);var mod=this.pagecap%2-1;if(this.pageCount>this.page+spt){var endPage=this.page+spt;var startPage=this.page-spt-mod}else{var endPage=this.pageCount;var startPage=this.page-spt-mod}}if(this.page>this.pageCount-this.pagecap&&this.page>=this.pagecap){var startPage=this.pageCount-this.pagecap+1;var endPage=this.pageCount}for(var i=startPage;i<=endPage;i++){if(i>0){if(i==this.page){strHtml.push('<span style="margin-right:3px">'+i+"</span>")}else{if(i>=1&&i<=this.pageCount){strHtml.push('<span><a style="color:#7777cc;margin-right:3px" href="javascript:void(0)" onclick="Instance(\''+this.guid+"').toPage("+i+');">['+i+"]</a></span>")}}}}if(nextPage>this.pageCount){}else{strHtml.push('<span><a style="color:#7777cc" href="javascript:void(0)" onclick="Instance(\''+this.guid+"').toPage("+nextPage+');">\u4e0b\u4e00\u9875</a></span>')}strHtml.push("</p>");return strHtml.join("")},toPage:function(page){var turnTo=page?page:1;if(typeof(this.callback)=="function"){this.callback(turnTo);this.page=turnTo}if(this.update){this.render()}}});mg("LocalSearch",LocalSearch);mg("TransitRoute",TransitRoute);mg("DrivingRoute",DrivingRoute);mg("WalkingRoute",WalkingRoute);mg("TrafficControl",TrafficControl);mg("Geocoder",Geocoder);mg("LocalCity",LocalCity);mg("Geolocation",Geolocation)})();var _key="";