Jmap=function(i){var b={},a,g={},c={},e,d,f=[],h={addSkipOvList:function(j){f.push(j);},init:function(k){window.mapData={};window.mapData.base={};window.mapData.entity={};window.mapData.sign={};window.map={};Jock.extend(c,Jock.map.options||{});Jock.extend(c,k||{});if(c.d&&typeof console!="undefined"){console.log(c);}Jock.extend(g,Jock.map.icOpts||{});if(!c.elm||typeof BMap!=="object"){return;}c.elm=document.getElementById(c.elm);c.elm.style.background="none";this.setWH();this.createMap();var j=this;Jock.event.add(window,"resize",function(){j.setWH(true);});},setWH:function(j){var k=c.elm.style;if(j||!k.width){k.width="auto";}if(j||!k.height){k.height=(Jock.getHeight()-c.top)+"px";}},getCdn:function(){return c.cdn;},createMap:function(){b=new BMap.Map(c.elm,{mapType:!!c.u3d&&c.city!=""?BMAP_PERSPECTIVE_MAP:BMAP_NORMAL_MAP});var j=b.getSize();e=j.width;d=j.height;if(!!c.u3d&&c.city!=""){b.setCurrentCity(c.city);}b.enableContinuousZoom();b.centerAndZoom(new BMap.Point(c.lng,c.lat),c.zoom);if(!!c.mark){var k=this.addMarker(c.lng,c.lat,g);this.addSkipOvList(k);}if(!!c.ezoom){b.enableScrollWheelZoom(true);}this.addNavControl();},getMap:function(){return b||{};},reset:function(){b.reset();},inBounds:function(j,l){var k=b.pointToPixel(new BMap.Point(j,l));if(k.x>0&&k.x<e&&k.y>0&&k.y<d){return true;}else{return false;}},clearMarkers:function(){b.clearOverlays();},addMarker:function(k,m,l){if(this.inBounds(k,m)){var j=new BMap.Marker(new BMap.Point(k,m),{icon:this.getMarkerIcon(l||g)});if(!l.title||!g.title){j.setTitle(l.title||g.title);}b.addOverlay(j);return j;}},addNavControl:function(){var j=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:!!c.ctype?BMAP_NAVIGATION_CONTROL_LARGE:BMAP_NAVIGATION_CONTROL_ZOOM});b.addControl(j);},getMarkerIcon:function(j){return new BMap.Icon(j.icon,new BMap.Size(j.size.w,j.size.h),{offset:new BMap.Size(j.offset.x,j.offset.y),imageOffset:new BMap.Size(j.imgOffset.x,j.imgOffset.y)});},sw3d:function(){var j={};this.extend(j,opts||{});this.extend(j,i||{});this.extend(j,{u3d:1,zoom:17}||{});this.init(j);},sw2d:function(){var j={};this.extend(j,opts||{});this.extend(j,i||{});this.extend(j,{u3d:0}||{});this.init(j);},openWindow:function(k){var j=new BMap.InfoWindow(k.popInfo);b.openInfoWindow(j,new BMap.Point(k.lng,k.lat));},mapAddOverlay:function(j){b.addOverlay(j);},mapRemoveOverlay:function(o,k){var n=b.getOverlays();for(var m=0,j=n.length;m<j;m++){if((o==this.mOverlay.All||o===n[m].toString())&&!Jock.inArray(n[m],f)&&(!!k&&!this.vOverlay(n[m],k))){b.removeOverlay(n[m]);}}},vOverlay:function(k,j){if(!!j.length){return Jock.inArray(k,j);}if(typeof j==="object"&&k===j){return true;}return false;},mOverlay:{All:"",Marker:"Marker",Overlay:"Overlay"},localSearch:function(j,n,o,l){var k={onSearchComplete:function(q){if(m.getStatus()==BMAP_STATUS_SUCCESS){var r=[],p=q.getCurrentNumPois();while(p--){r.push(q.getPoi(p));}if(n&&o){o.call(n,r,l);}}}},m=new BMap.LocalSearch(b,k);m.searchInBounds(j,b.getBounds());}};h.init(i);return h;};